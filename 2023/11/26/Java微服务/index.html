<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;zh-tw&quot;,&quot;en&quot;,&quot;default&quot;]" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Java微服务 | 个人博客</title><meta name="author" content="Docker"><meta name="copyright" content="Docker"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="架构演进：一、开发环境&amp;生成环境1. 开发环境平时在写代码时，大多都在是win10&#x2F;win7&#x2F;Mac，这些系统都可以称呼开发环境，我们会为了更高效的开发应用程序，安装很多的软件，会导致操作系统不安全，稳定性降低。 2. 生成环境在生产环境中，操作系统不会采用win10&#x2F;Mac,这种操作系统相对不安全，生成环境要面向全体用户的,生产环境是要面向用户的，一般会采用">
<meta property="og:type" content="article">
<meta property="og:title" content="Java微服务">
<meta property="og:url" content="http://example.com/2023/11/26/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/index.html">
<meta property="og:site_name" content="个人博客">
<meta property="og:description" content="架构演进：一、开发环境&amp;生成环境1. 开发环境平时在写代码时，大多都在是win10&#x2F;win7&#x2F;Mac，这些系统都可以称呼开发环境，我们会为了更高效的开发应用程序，安装很多的软件，会导致操作系统不安全，稳定性降低。 2. 生成环境在生产环境中，操作系统不会采用win10&#x2F;Mac,这种操作系统相对不安全，生成环境要面向全体用户的,生产环境是要面向用户的，一般会采用">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg">
<meta property="article:published_time" content="2023-11-26T12:23:18.000Z">
<meta property="article:modified_time" content="2023-11-26T12:38:22.085Z">
<meta property="article:author" content="Docker">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Java框架">
<meta property="article:tag" content="Java微服务">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/11/26/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Java微服务',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2023-11-26 20:38:22'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-share"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="个人博客"><span class="site-name">个人博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-share"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Java微服务</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-11-26T12:23:18.000Z" title="发表于 2023-11-26 20:23:18">2023-11-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-26T12:38:22.085Z" title="更新于 2023-11-26 20:38:22">2023-11-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/">Java微服务</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/Java%E6%A1%86%E6%9E%B6/">Java框架</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Java微服务"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="架构演进："><a href="#架构演进：" class="headerlink" title="架构演进："></a>架构演进：</h2><h3 id="一、开发环境-生成环境"><a href="#一、开发环境-生成环境" class="headerlink" title="一、开发环境&amp;生成环境"></a>一、开发环境&amp;生成环境</h3><h4 id="1-开发环境"><a href="#1-开发环境" class="headerlink" title="1. 开发环境"></a>1. 开发环境</h4><p>平时在写代码时，大多都在是win10&#x2F;win7&#x2F;Mac，这些系统都可以称呼开发环境，我们会为了更高效的开发应用程序，安装很多的软件，会导致操作系统不安全，稳定性降低。</p>
<h4 id="2-生成环境"><a href="#2-生成环境" class="headerlink" title="2. 生成环境"></a>2. 生成环境</h4><p>在生产环境中，操作系统不会采用win10&#x2F;Mac,这种操作系统相对不安全，生成环境要面向全体用户的,生产环境是要面向用户的，一般会采用专业操作系统。<br>大多市面上使用的都是基于Linux版本的服务器操作系统Windows 2003 service</p>
<h3 id="二、WEB1-0-WEB2-0阶段"><a href="#二、WEB1-0-WEB2-0阶段" class="headerlink" title="二、WEB1.0&amp;WEB2.0阶段"></a>二、WEB1.0&amp;WEB2.0阶段</h3><h4 id="2-1web1-0时期"><a href="#2-1web1-0时期" class="headerlink" title="2.1web1.0时期"></a>2.1web1.0时期</h4><p>在WEB1.0时期，由于带宽不足，这是的项目大多是内容少，用户量也不多，甚至一些项目不需要对外开放，对安全性和稳定性的要求是不高的。<br>单体架构就足以应对，</p>
<h4 id="2-WEB2-0时期"><a href="#2-WEB2-0时期" class="headerlink" title="2.WEB2.0时期"></a>2.WEB2.0时期</h4><p>2.1、随之到来的web2.0，实现下ADSL拨号上网，宽带提速，最高可以达到8M，用户量也就不断增加，一些门户网站也开始活跃，项目就需要考虑安全性和稳定性。<br>2.2、在基于上面的单体架构图中，无法满足WEB2.0对项目的需求。<br>在单体架构的基础上去构建集群。<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108130202773.png" alt="在这里插入图片描述"><br>2.3、搭架集群后发生的问题<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/2020110813052351.png"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108163048427.png" alt="单体架构图"></p>
<h3 id="三、垂直架构"><a href="#三、垂直架构" class="headerlink" title="三、垂直架构"></a>三、垂直架构</h3><p>比如项目包含了三个模块，用户模块，商品模块，订单模块<br>商品模块压力过大，一般最直接有效的方式就是搭建集群，在单体架构的集群上去搭建，效果相对比较差。<br>随着项目的不断更新，项目中的功能越来越多，最严重可能会导致项目无法启动。<br>关于单体架构中，完美的体现了低内聚，高耦合。<br>为了解决上诉各种问题，演进出了垂直架构。<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108164145385.png" alt="垂直架构图"></p>
<h3 id="四、分布式架构"><a href="#四、分布式架构" class="headerlink" title="四、分布式架构"></a>四、分布式架构</h3><h4 id="4-1项目迭代"><a href="#4-1项目迭代" class="headerlink" title="4.1项目迭代"></a>4.1项目迭代</h4><p>随着项目的不断迭代，新考功能之间需要相互交互，服务器和服务器之间是需要通讯的。<br>项目一般是分为三层的，Controller，Service，Dao，导致程序变慢的重灾区，一般是Service和Dao，在搭建集群时，确实针对三层都搭建集群，效果不是很好。<br>架构从垂直架构演变到了分布式架构。<br>国内通讯的方式有两种：<br>Dubbo							RPC<br>SpringCloud				HTTP<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108165115275.png" alt="分布式架构图"></p>
<h3 id="五、分布式架构常见问题"><a href="#五、分布式架构常见问题" class="headerlink" title="五、分布式架构常见问题"></a>五、分布式架构常见问题</h3><h4 id="5-1服务之间的异步通讯"><a href="#5-1服务之间的异步通讯" class="headerlink" title="5.1服务之间的异步通讯"></a>5.1服务之间的异步通讯</h4><p>使用分布式架构之后，服务之间的通讯都是同步的。<br>在一些不是核心业务的功能上，我们希望可以实现异步通讯（如：日志）。<br>为了实现服务之间的异步通讯，需要学些MQ-RabbitMQ（RabbitMQ：消息队列）。</p>
<p>分布式架构下，实现异步通讯：</p>
<p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108173506613.png" alt="在这里插入图片描述"></p>
<h4 id="5-2服务之间通讯地址的维护"><a href="#5-2服务之间通讯地址的维护" class="headerlink" title="5.2服务之间通讯地址的维护"></a>5.2服务之间通讯地址的维护</h4><p>由于服务越来越多，每个服务的访问地址多是一样的。<br>协议：&#x2F;&#x2F;地址:端口号<br>由于模块繁多，并且模块搭建的集群数量增加，会导致其他模块需要维护各种ip地址等信息，导致项目的维护性急需要使用一个技术来解决当前问题：<br>Eureka注册中心帮助我们管理服务信息。<br>Robbin可以帮我们实现服务之间的负载均衡</p>
<p>Erueka实现通讯地址维护<br>Robbin实现服务之间的负载均衡<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108175722967.png" alt="在这里插入图片描述"></p>
<h4 id="5-3服务降级"><a href="#5-3服务降级" class="headerlink" title="5.3服务降级"></a>5.3服务降级</h4><p>在上述的架构中，如果说订单模块出现了问题。<br>只要是涉及到订单模块的功能，全部都无法使用。<br>可能会导致服务器提供的线程池耗尽。<br>为了解决上述的问题，使用Hystrix处理。<br>Hystrix提供了线程池隔离的方式，避免服务器线程池耗尽在一个服务无法使用时，可以提供断路器的方式来解决。</p>
<p>使用Hystrix帮我们实现断路器和隔壁，并最终服务降级<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108184745793.png" alt="在这里插入图片描述"><br>Eureka，Robbin，Hystrix都是SpringCloud中的组件</p>
<h4 id="海量数据"><a href="#海量数据" class="headerlink" title="海量数据"></a>海量数据</h4><p> 海量数据会导致数据库无法存储全部的内容。<br> 即便数据库可以存储海量的数据，在查询数据时，数据库的响应时及其缓慢的。<br> 在用户高并发的情况下，数据库也时无法承受住的。<br> 为了解决上述的问题，可以基于MyCat实现数据库的分库分表。<br> <img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108201827595.png" alt="在这里插入图片描述"></p>
<h3 id="六、微服务架构"><a href="#六、微服务架构" class="headerlink" title="六、微服务架构"></a>六、微服务架构</h3><p>虽然已经将每个模块独立的做开发，比如商品模块，压力最大的时商品的查询。<br>在单独模块中再次拆分项目的方式就可以称之为微服务架构。<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108203339633.png" alt="在这里插入图片描述"></p>
<h4 id="6-2模块过多，运维成本增加"><a href="#6-2模块过多，运维成本增加" class="headerlink" title="6.2模块过多，运维成本增加"></a>6.2模块过多，运维成本增加</h4><p>为了解决模块过多，运维成本增加的问题。<br>采用Docker容器化技术来帮助我们管理。<br>后期在学习的时候，也需要大量的软件，可以使用Docker来帮助我们安装软件。<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108210041626.png" alt="在这里插入图片描述"></p>
<h4 id="6-3分布式架构下的其他问题"><a href="#6-3分布式架构下的其他问题" class="headerlink" title="6.3分布式架构下的其他问题"></a>6.3分布式架构下的其他问题</h4><p>分布式架构帮助我们解决了很多的问题，但是随之也带来了很多问题。<br>1、分析事事务：<br>    最传统的操作事务的方式，是通过Connection链接对象的方式操作，Spring也提供了声明式事务的操作。为了解决事务的问题，后续会使用到RabbitMQ|LCN方式来解决。<br>2、分布式锁：<br>传统的锁方式，synchronized|Lock锁，基于对象；在分布式环境下，传统的锁是没有效果的，为了解决锁的问题，后续会使用到Redis|Zookeeper来解决。<br>3、分布式任务：<br>在传统的定时任务下，由于分布式环境的问题，可能会造成任务重复执行，一个比较大的任务，需要可以拆分。<br>为了解决这个问题，后续会使用到Redis+Quartz|Elastic-Job。</p>
<p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108211223626.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108211303399.png" alt="在这里插入图片描述"></p>
<h1 id="Linux介绍"><a href="#Linux介绍" class="headerlink" title="Linux介绍"></a>Linux介绍</h1><h2 id="一、Linux介绍"><a href="#一、Linux介绍" class="headerlink" title="一、Linux介绍"></a>一、Linux介绍</h2><h3 id="1-1引言"><a href="#1-1引言" class="headerlink" title="1.1引言"></a>1.1引言</h3><p>在学习Linux之前，大家先了解开发环境，生成，测试环境。<br>    1、开发环境：平时大家大多是在Windows或者Mac操作系统下去编写代码进行开发，在开发环境中安装大量的软件，这样导致环境的稳定性和安全性降低。<br>    2、生成环境：是将程序运行在此环境中，供用户去使用，这个环境是有专业的人员去维护，一般人是没有权限去操作生产环境的。<br>    3、测试环境：一般克隆一份生产环境，会将开发环境中的程序部署到环境中，这个环境的主要目的是去程序进程检测，收集程序中的各种问题，并交给开发人员进行修改。<br>生产环境中，常用的操作系统比如有Windows 2003 service，Linux，Unix等等。<br>Linux操作系统，在生产环境中占据了大量的市场份额，Linux主要以稳定，可靠，免费的特点成为全球使用最多的服务器操作系统。<br>Linux操作系统现在已经成为后待开发人员必备的技能，并且后期学习的各种知识都会涉及到Linux操作系统。</p>
<h3 id="Linux介绍-1"><a href="#Linux介绍-1" class="headerlink" title="Linux介绍"></a>Linux介绍</h3><p>在Linux操作系统出现之前，还有一个操作系统叫做Minix，Minix操作系统是由Andrew的大学教授研发出来的，当时大学教授是为了给学生上课，买了一套Unix操作系统，参考Unix自己写了一个操作系统，并且命名为Minix。同时将Minix开源，供学校内部的研究和教学，到了2000年，Andrew将Minix操作系统完全对外开源。<br>Minix由于完全对外开源之后，在互联网上迅速的传播，但是大家在使用时，发现Minix不是很完美，内部存在各种各样问题。用户将问题解决后，编写了一个补丁，将补丁以邮件的方式发给Andrew，但是Andrew教室最初的目的只是为了教学和研究。<br>于此同时，一位芬兰的大学生出现了，叫Linus，在Minix操作系统基础上，自己添加了一些补丁和插件，并将其命名为Linux操作系统，并且完全对外开源，而且开始维护Linux操作系统。<br>之前学习的Git也是Linus研发的。</p>
<p>Linus Torvalds 和 Linux<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108213103748.png" alt="在这里插入图片描述"></p>
<h3 id="1-3Linux的版本"><a href="#1-3Linux的版本" class="headerlink" title="1.3Linux的版本"></a>1.3Linux的版本</h3><p>1、Linux的内核版本。<br>    <a target="_blank" rel="noopener" href="https://www.kernel.org/">https://www.kernel.org/</a><br>2、Linux的发行版本。<br>我们需要学习的发行版本就是CentO S<br>Linux的发行版本<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108214034736.png" alt="在这里插入图片描述"></p>
<h3 id="1-4Linux和Windows区别"><a href="#1-4Linux和Windows区别" class="headerlink" title="1.4Linux和Windows区别"></a>1.4Linux和Windows区别</h3><p>1、Linux是严格区分大小写的，Windows无所谓。<br>2、Linux中一切皆是文件。<br>3、Linux中文件是没有后缀的，但是他有一些约定俗成的后缀<br>4、Windows下的软件一般是无法直接运行的Linux中。<br>我们在学习Linux时，参考Windows下做了什么，就在Linux中做什么。</p>
<h2 id="二、Linux安装"><a href="#二、Linux安装" class="headerlink" title="二、Linux安装"></a>二、Linux安装</h2><p>1、安装Linux，我们需要一个虚拟机，为了安装虚拟环境：VMware或者Virtual Box(采用VMware)<br>VMware官网：<a target="_blank" rel="noopener" href="https://www.vmware.com/">https://www.vmware.com</a><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108215629765.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108215652839.png" alt="在这里插入图片描述"><br>2、为了安装Linux，需要一个Linux的镜像文件：CentOS7版本<br>下载地址：<a target="_blank" rel="noopener" href="http://mirrors.163.com/centos/7/isos/x86_64/CentOS-7-x86_64-Minimal-2003.iso">http://mirrors.163.com/centos/7/isos/x86_64&#x2F;CentOS-7-x86_64-Minimal-2003.iso</a></p>
<p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108220003375.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/2020110822002718.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108220047829.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/2020110822022748.png" alt="在这里插入图片描述"></p>
<p>3、安装一个连接Linux的图形化界面：Xterm，SSH，XShell(Xterm)<br>Xterm：<a target="_blank" rel="noopener" href="https://mobaxterm.mobatek.net/download.html">https://mobaxterm.mobatek.net/download.html</a><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/2020110822044813.png" alt="在这里插入图片描述"></p>
<h3 id="2-1安装VMware"><a href="#2-1安装VMware" class="headerlink" title="2.1安装VMware"></a>2.1安装VMware</h3><p> 傻瓜式安装。</p>
<h3 id="2-2安装Xterm"><a href="#2-2安装Xterm" class="headerlink" title="2.2安装Xterm"></a>2.2安装Xterm</h3><p>解压既可以使用</p>
<h3 id="2-3在Vmware安装Linux"><a href="#2-3在Vmware安装Linux" class="headerlink" title="2.3在Vmware安装Linux"></a>2.3在Vmware安装Linux</h3><p>1、选择典型，下一步<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108220856644.png" alt="选择经典版"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108220923560.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108221057147.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/2020110822113493.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108221240796.png" alt="在这里插入图片描述"><br>安装好以后配置一下虚拟机右击虚拟机：<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108221357773.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108221450337.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108221557847.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108221614242.png" alt="在这里插入图片描述"><br>启动<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/2020110822172939.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108221840360.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201108222056147.png" alt="在这里插入图片描述"><br>然后输入账号密码就好了。</p>
<h3 id="2-4使用Xterm连接Linux"><a href="#2-4使用Xterm连接Linux" class="headerlink" title="2.4使用Xterm连接Linux"></a>2.4使用Xterm连接Linux</h3><p>通过ip a命令查看当前Linux的ip地址，通过Xterm连接。<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201109190433599.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201109190654338.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201109190657548.png" alt="在这里插入图片描述"><br>打开Xtrem，选择左上角的Session，并且输入Linux操作系统的ip地址，在输入用户名root，确定即可。</p>
<p>连接上Linux</p>
<p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201109190908421.png" alt="在这里插入图片描述"></p>
<h2 id="三、Linux基本操作"><a href="#三、Linux基本操作" class="headerlink" title="三、Linux基本操作"></a>三、Linux基本操作</h2><p>Windows的目录结构是带有盘符的。D: 	E: 	C:<br>在Xterm中输入ls &#x2F;查看Linux的顶级目录。<br><img src="https://img-blog.csdnimg.cn/20201109194315971.png#pic_center" alt="在这里插入图片描述"><br>Linux目录树状图<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201109194625686.png" alt="在这里插入图片描述"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、root：该目录为系统管理员HOME目录</span><br><span class="line"><span class="number">2</span>、bin：这个目录下放着经常使用的命令</span><br><span class="line"><span class="number">3</span>、boot：这里存放的是启动Linux是的一些核心文件</span><br><span class="line"><span class="number">4</span>、etc：存放系统管理所需要的配置文件和子目录</span><br><span class="line"><span class="number">5</span>、home：普通用户的HOME目录</span><br><span class="line"><span class="number">6</span>、usr：默认安装软件的目录，类似Windows中的Program Files目录</span><br><span class="line"><span class="number">7</span>、opt：是主机额外安装软件拜访的目录；</span><br></pre></td></tr></table></figure>

<h3 id="3-2获取Linux中的信息"><a href="#3-2获取Linux中的信息" class="headerlink" title="3.2获取Linux中的信息"></a>3.2获取Linux中的信息</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、我是谁</span><br><span class="line">who an i</span><br><span class="line"><span class="number">2</span>、我在哪</span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line"><span class="number">3</span>、查看ip地址</span><br><span class="line">ip a</span><br><span class="line"><span class="number">4</span>、清屏</span><br><span class="line"><span class="built_in">clear</span></span><br><span class="line"><span class="number">5</span>、ping域名|ip</span><br><span class="line">ping 地址</span><br><span class="line"><span class="number">6</span>、强制停止</span><br><span class="line">Ctrl+C</span><br></pre></td></tr></table></figure>

<h2 id="四、Linux命令"><a href="#四、Linux命令" class="headerlink" title="四、Linux命令"></a>四、Linux命令</h2><p>Linux中命令的基本格式：命令【选项】【参数】<br>需要注意，个别命令是不遵循这个格式<br>当命令中有多个选项时，可以写在一起的，并且选项也是由简写方式的  命令 -选项A选项B</p>
<h3 id="4-1目录的命令"><a href="#4-1目录的命令" class="headerlink" title="4.1目录的命令"></a>4.1目录的命令</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#l.	列出目录</span></span><br><span class="line"><span class="built_in">ls</span> [-<span class="type">ald</span>] [目录名]</span><br><span class="line"><span class="comment">#目录名不填写，默认为当前目录</span></span><br><span class="line"><span class="comment">#-a：列出的全部的文件，包括隐藏文件</span></span><br><span class="line"><span class="comment">#-l：列举出全部的信息</span></span><br><span class="line"><span class="comment">#-d：仅查看目录本身</span></span><br></pre></td></tr></table></figure>

<p><strong>#Linux中的隐藏文件是以. 开头的，当前目录使用.表示，上一级目录使用..表示</strong></p>
<h3 id="4-2切换目录"><a href="#4-2切换目录" class="headerlink" title="4.2切换目录"></a>4.2切换目录</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#切换目录</span></span><br><span class="line"><span class="built_in">cd</span> 路径 | 符号</span><br><span class="line"><span class="comment">#路径可以填写的内容</span></span><br><span class="line">| 符号 | 表达的路径 |</span><br><span class="line">|-.-|-当前目录-|</span><br><span class="line">| .. | 上一级目录 |</span><br><span class="line">| / | 根目录 |</span><br><span class="line">| ~ | 当前登录用户的HOME目录 |</span><br><span class="line">| - | 返回 |</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3、创建目录</span></span><br><span class="line">mkdir [-<span class="type">p</span>] 目录名</span><br><span class="line"><span class="comment">#-p:代表创建多级目录时，使用</span></span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4、删除目录</span></span><br><span class="line"><span class="built_in">rmdir</span> 目录名</span><br><span class="line"><span class="comment">#只能删除空目录</span></span><br><span class="line"><span class="built_in">rm</span> [-<span class="type">rf</span>] 目录名</span><br><span class="line"><span class="comment">#删除非空目录</span></span><br><span class="line"><span class="comment">#-r：代表递归删除目录下的全部内容</span></span><br><span class="line"><span class="comment">#-f：不询问，直接删除</span></span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#5、复制目录</span></span><br><span class="line"><span class="built_in">cp</span> <span class="literal">-r</span> 来源目录	目标目录</span><br><span class="line"><span class="comment">#-r：递归复制全部内容</span></span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#6、移动、重命名目录</span></span><br><span class="line"><span class="built_in">mv</span>	目录名 新目录名</span><br><span class="line"><span class="built_in">mv</span> 目录名 路径</span><br><span class="line"><span class="comment">#如果第二个参数不存在，就是重命名，如果第二个参数的路径存在，就是移动。</span></span><br></pre></td></tr></table></figure>
<h3 id="4-2文件的命令"><a href="#4-2文件的命令" class="headerlink" title="4.2文件的命令"></a>4.2文件的命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、创建文件</span></span><br><span class="line"><span class="built_in">touch</span> 文件名</span><br><span class="line"><span class="built_in">touch</span> 文件名1 文件名2</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2、编辑文件</span></span><br><span class="line">vi 文件名	<span class="comment">#查看文件、（查看模式）</span></span><br><span class="line">i|a|o		<span class="comment">#进入编辑模式，（编辑模式）</span></span><br><span class="line"><span class="comment">#i：在当前光标处，进入编辑模式；	a：在当前光标后一格，进入编辑模式；	o:在当前光标下一行，进入编辑模式。</span></span><br><span class="line">esc			<span class="comment">#退出编辑模式，回到查看模式。</span></span><br><span class="line">:			<span class="comment">#从查看模式进入到底行命令模式。（底运行命令模式）</span></span><br><span class="line"><span class="comment">#在底行命令模式下，输入wq: 保存并退出。输入q!: 不保存并退出。</span></span><br><span class="line"><span class="comment">#在查看模式下，按ZZ，可以快速保存并退出。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3、在编辑文件时的其他操作</span></span><br><span class="line">在底行命令模式下，可以输入的内容</span><br><span class="line"><span class="built_in">set</span> nu		<span class="comment">#查看文件的行号</span></span><br><span class="line">to 行号		<span class="comment">#快速的跳转到指定行</span></span><br><span class="line"><span class="built_in">set</span> nonu	<span class="comment">#取消行号</span></span><br><span class="line"><span class="comment">#直接在查看模式下输入</span></span><br><span class="line">/具体内容	<span class="comment">#类似Windows的Ctrl+F搜索文件中的具体内容所在位置，查看下一个可以输入字母n</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4、查看文件</span></span><br><span class="line"><span class="built_in">cat</span> 文件名</span><br><span class="line"><span class="comment">#从第一行开始查看文件内容，展示全部</span></span><br><span class="line"><span class="built_in">tac</span> 文件名</span><br><span class="line"><span class="comment">#从最好一行开始展示</span></span><br><span class="line"><span class="built_in">nl</span> 文件名</span><br><span class="line"><span class="comment">#显示文件的时候，展示行号</span></span><br><span class="line">more 文件名</span><br><span class="line"><span class="comment">#查看大文件时，可以一页一页的向下翻</span></span><br><span class="line"><span class="comment">#按space向上翻页，退出时按q</span></span><br><span class="line">less 文件名</span><br><span class="line"><span class="comment">#查看大文件时，可以任意的向上或向下翻</span></span><br><span class="line"><span class="comment">#向上或向下翻页按PageUp和PageDown，一行一行查看，按光标的↑↓</span></span><br><span class="line"><span class="built_in">head</span> 文件名</span><br><span class="line"><span class="comment">#只查看前几行</span></span><br><span class="line"><span class="built_in">tail</span> 文件名</span><br><span class="line"><span class="comment">#只查看后几行</span></span><br><span class="line"><span class="comment">#tail -f 日志 监控日志</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#5、移动、重命名文件</span></span><br><span class="line"><span class="built_in">mv</span> 文件名 新文件名</span><br><span class="line"><span class="built_in">mv</span> 文件名 目录</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#6、复制文件</span></span><br><span class="line"><span class="built_in">cp</span> 文件 目录</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#7、删除文件</span></span><br><span class="line"><span class="built_in">rm</span> [-f] 文件名</span><br><span class="line"><span class="comment">#[-f]是否询问</span></span><br><span class="line"><span class="comment">#8、删除文件夹</span></span><br><span class="line"><span class="built_in">rm</span> -rf 目录名</span><br></pre></td></tr></table></figure>
<h3 id="4-3针对压缩包的操作"><a href="#4-3针对压缩包的操作" class="headerlink" title="4.3针对压缩包的操作"></a>4.3针对压缩包的操作</h3><p>Linux中常用的压缩包，大多是.tar，.tar.gz，taz的。<br>但是Linux不仅仅针对tar类型的压缩包，也支持zip，rar这种Windows下的压缩包。</p>
<h4 id="4-3-1针对tar命令"><a href="#4-3-1针对tar命令" class="headerlink" title="4.3.1针对tar命令"></a>4.3.1针对tar命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#针对tar类型的压缩包操作</span></span><br><span class="line"><span class="comment">#1、解压压缩包</span></span><br><span class="line">tar -[zxvf]压缩包名称[-C 路径]</span><br><span class="line"><span class="comment"># -z：代表压缩包后缀是.gz的</span></span><br><span class="line"><span class="comment"># -x: 代表解压</span></span><br><span class="line"><span class="comment"># -v: 解压时，打印详细信息</span></span><br><span class="line"><span class="comment"># -f： -f选项必须放在所有选项的最后，代表指定文件名称</span></span><br><span class="line"><span class="comment"># -C 路径： 代表将压缩包内容解压到指定路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2、打包压缩包。</span></span><br><span class="line">tar [-zcvf] 压缩包名称 文件1 文件2 目录1 目录2</span><br></pre></td></tr></table></figure>
<h4 id="4-3-2针对zip压缩包"><a href="#4-3-2针对zip压缩包" class="headerlink" title="4.3.2针对zip压缩包"></a>4.3.2针对zip压缩包</h4><p>Linux默认不支持zip压缩包格式的。<br>安装两个软件：<br>    zip，unzip<br>    yum -y install zip<br>    yum -y install unzip</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#解压</span></span><br><span class="line">unzip 压缩包名称</span><br><span class="line"></span><br><span class="line"><span class="comment">#打包 </span></span><br><span class="line">zip 压缩包名称 文件1 文件2 目录1 目录2 ....</span><br></pre></td></tr></table></figure>
<h3 id="4-4用户-用户组的操作"><a href="#4-4用户-用户组的操作" class="headerlink" title="4.4用户&amp;用户组的操作"></a>4.4用户&amp;用户组的操作</h3><p>Linux是一个多用户的操作系统，任何一个用户想要操作Linux操作系统，必须向系统管理员申请一个账号才可以，以这个账号的身份去操作Linux。<br>用户的账号一方面可以帮助系统管理员追踪当前用户的操作，另一方面可以控制当前用户对系统资源访问。</p>
<h4 id="4-4-1-用户的操作"><a href="#4-4-1-用户的操作" class="headerlink" title="4.4.1 用户的操作"></a>4.4.1 用户的操作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、创建用户</span></span><br><span class="line">useradd 用户名</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2、设置密码</span></span><br><span class="line">passwd 用户名</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3、切换用户</span></span><br><span class="line">su 用户名</span><br><span class="line"><span class="comment">#[root@localhost ~]#  -&gt;root用户在本地登录，并且当前在~目录下，#代表是超级管理员</span></span><br><span class="line"><span class="comment">#[liuwenzhen@localhost ~]$	-&gt;liuwenzhen用户在本地</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4、删除用户</span></span><br><span class="line">userdel [-r] 用户名</span><br><span class="line"><span class="comment"># -r :代表删除用户的同时，删除该用户的HOME目录</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#5、修改用户（了解）</span></span><br><span class="line">usermod [-cgd] [选项指定的具体内容] 用户名</span><br><span class="line"><span class="comment"># -c：代表comment，给用户添加一段注释</span></span><br><span class="line"><span class="comment"># -g:代表group，可以修改用户的所在组</span></span><br><span class="line"><span class="comment"># -d：代表指定用户的HOME目录</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-2用户组的操作"><a href="#4-4-2用户组的操作" class="headerlink" title="4.4.2用户组的操作"></a>4.4.2用户组的操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、创建用户组</span></span><br><span class="line">groupadd 用户组名</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2、修改用户组</span></span><br><span class="line">groupmod [-n] 用户组名</span><br><span class="line"><span class="comment">#-n:修改用户组名称</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3、删除用户组</span></span><br><span class="line">groupdel 用户组名称</span><br><span class="line"><span class="comment">#只能删除不存在用户的用户组</span></span><br></pre></td></tr></table></figure>
<h3 id="4-5文件权限的修改"><a href="#4-5文件权限的修改" class="headerlink" title="4.5文件权限的修改"></a>4.5文件权限的修改</h3><p>在Linux中输入ls -l或者ll查看文件和目录的详细信息。<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/202011151750003.png" alt="在这里插入图片描述"></p>
<p>实例中，a目录的第一个属性用“d”标识这个a是一个目录<br>anacinda-ks.cfg第一个属性用“-”标识他是一个文件<br>在Linux文件详情的后面属性需要分为三组查看<br>    - rwx：代表文件拥有者的权限<br>    - rwx：代表文件所属组用户的权限<br>    - rwx：代表其他用户对当前文件的操作权限<br>    - r:daibiaoread，读的权限<br>    - w:代表write，写的权限<br>    - x：代表execute，代表执行权限<br>后续的第一个root：代表当前文件的拥有者<br>后续的第二个root：代表当前文件的所属组<br>或许分别为：文件的大小和最好修改时间</p>
<h3 id="4-5-1对文件的权限修改"><a href="#4-5-1对文件的权限修改" class="headerlink" title="4.5.1对文件的权限修改"></a>4.5.1对文件的权限修改</h3><p>使用chmod对文件的权限进行修改，一种使用数字，一种使用符号。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、数字方式</span></span><br><span class="line"><span class="built_in">chmod</span> [-R] 777 文件|目录</span><br><span class="line"><span class="comment"># rwx在这三个权限中r:4，w：2，x：1</span></span><br><span class="line"><span class="comment"># -R：当修改一个目录权限时，可以添加-R，将目录下的全部内容，都修改权限。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2、符号方式</span></span><br><span class="line"><span class="comment">#user：u，group：g，other:o,all:a</span></span><br><span class="line"><span class="comment">#read:r,write:w,execute:x</span></span><br><span class="line"><span class="comment">#赋予权限的方式</span></span><br><span class="line">	<span class="comment"># 添加：+，减掉：-，设定：=</span></span><br><span class="line"><span class="built_in">chmod</span> [-R] a+r,a+w 文件|目录</span><br></pre></td></tr></table></figure>
<h3 id="4-5-2对文件的拥有者和所属组修改"><a href="#4-5-2对文件的拥有者和所属组修改" class="headerlink" title="4.5.2对文件的拥有者和所属组修改"></a>4.5.2对文件的拥有者和所属组修改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改文件的拥有者和所属组</span></span><br><span class="line"><span class="built_in">chown</span> [-R] 拥有者：所属组 文件|目录</span><br><span class="line"><span class="comment">#修改文件的拥有者</span></span><br><span class="line"><span class="built_in">chown</span> [-R] 拥有者 文件|目录</span><br><span class="line"><span class="comment">#修改文件的所属组</span></span><br><span class="line"><span class="built_in">chgrp</span> [-R] 所属组 文件|目录</span><br></pre></td></tr></table></figure>
<h3 id="4-6Linux的其他操作命令"><a href="#4-6Linux的其他操作命令" class="headerlink" title="4.6Linux的其他操作命令"></a>4.6Linux的其他操作命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、进程的操作</span></span><br><span class="line">ps -ef</span><br><span class="line"><span class="comment"># 查看全部正在运行的进程</span></span><br><span class="line">ps -ef|grep 搜索的内容</span><br><span class="line"><span class="comment">#杀死进程</span></span><br><span class="line"><span class="built_in">kill</span> -9 Pid</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2、服务的操作</span></span><br><span class="line"><span class="comment">#针对服务的启动，停止，重启，开机自动启动，禁止开机自动启动，查看服务状态。</span></span><br><span class="line">systemctl start|stop|restart|<span class="built_in">enable</span>|<span class="built_in">disable</span>|status 服务名称</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3、查看端口号占用情况</span></span><br><span class="line"><span class="comment">#向使用指定的命令需要实现下载netstat</span></span><br><span class="line">yum -y install net-tools</span><br><span class="line"><span class="comment">#查看端口号占用情况</span></span><br><span class="line">netstat -naop | grep 端口号</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4、访问地址</span></span><br><span class="line">curl 访问地址</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#5、查找文件</span></span><br><span class="line">find 路径 -tyep f|grep profile</span><br></pre></td></tr></table></figure>
<h2 id="五-Linux下安装软件"><a href="#五-Linux下安装软件" class="headerlink" title="五.Linux下安装软件"></a>五.Linux下安装软件</h2><h3 id="5-1安装JDK"><a href="#5-1安装JDK" class="headerlink" title="5.1安装JDK"></a>5.1安装JDK</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、下载JDK的压缩包</span></span><br><span class="line">https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html<span class="comment">#license-lightbox</span></span><br><span class="line"><span class="comment">#需要去登陆后，才可以下载</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2、将下载好的jdk压缩包拉取到Linux操作系统中</span></span><br><span class="line"><span class="comment"># 通过Xterm或FileZilla携带的Sftp将jdk压缩包拖拽到Linux操作系统</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3、将jdk的压缩包解压到/usr/local</span></span><br><span class="line">tar -zxvf jdk-8u241-linux-x64.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4、将jdk的目录名修改一下</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local</span><br><span class="line"><span class="built_in">mv</span> jdk1.8.1_241 jdk</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#5、配置环境变量</span></span><br><span class="line"><span class="comment">#Linux提供了两种环境变量的文件</span></span><br><span class="line"><span class="comment">#第一个是用户级别的环境变量，存放在：~/.bashrc</span></span><br><span class="line"><span class="comment">#第二个是系统级别的环境变量，存放在：/etc/profile</span></span><br><span class="line"><span class="comment">#如果想运行当前目录下的可执行文件，需要输入：./可执行文件</span></span><br><span class="line"><span class="comment">#在环境变量文件中，添加如下内容</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/jdk	（/user/local/jdk：jdk的路径）</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment">#重新加载环境变量文件</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment">#将/etc/profile文件如何还原</span></span><br><span class="line"><span class="built_in">export</span> PATH=/bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line"><span class="comment">#最终测试</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20201124212353542.png#pic_center" alt="在这里插入图片描述"></p>
<h3 id="5-2安装MySQL"><a href="#5-2安装MySQL" class="headerlink" title="5.2安装MySQL"></a>5.2安装MySQL</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、安装MySQL的YUM存储库</span></span><br><span class="line"><span class="comment">#首先通过ym下载wget命令</span></span><br><span class="line">yum -y install wget</span><br><span class="line"><span class="comment">#通过wget下载MySQL存储库</span></span><br><span class="line">wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2、安装下载好的rpm包</span></span><br><span class="line"><span class="comment">#安装rpm包</span></span><br><span class="line">rpm -Uvh rpm包（rpm包:mysql80-community-release-el7-3.noarch.rpm）</span><br><span class="line"><span class="comment">#查看rpm包</span></span><br><span class="line">rpm -qa |grep 内容</span><br><span class="line"><span class="comment">#卸载rpm</span></span><br><span class="line">rpm -e --nodeps rpm名称</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3、选择发行版本</span></span><br><span class="line"><span class="comment">#查看一下默认选择的发行版本</span></span><br><span class="line">yum repolist all | grep mysql</span><br><span class="line"><span class="comment">#通过编辑/etc/yum.repos.d/mysql-community.repo文件，去修改发行版本</span></span><br><span class="line"><span class="comment">#80的enabled更改为0，将57的enabled更改为1，保存即可，再次通过yum repolist all | grep mysql查看</span></span><br><span class="line"><span class="comment">#效果如下：</span></span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20201124215936549.png#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4、安装MySQL社区版服务</span></span><br><span class="line">yum -y install mysql-community-server</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#5、启动MySQL服务器，并连接</span></span><br><span class="line"><span class="comment">#启动MySQL服务</span></span><br><span class="line">systemctl start mysqld.service</span><br><span class="line"><span class="comment">#查看初始化密码</span></span><br><span class="line">grep <span class="string">&#x27;temporary password&#x27;</span> /var/log/mysqld.log</span><br><span class="line"><span class="comment">#通过使用生成的临时密码登录并尽快为超级用户帐户设置自定义密码，以更改root密码：</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line">Enter password：随机密码</span><br><span class="line"><span class="comment">#修改密码</span></span><br><span class="line">mysql&gt;ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;Lwz1234@&#x27;</span>;</span><br><span class="line"><span class="comment">#这将要求密码至少包含一个大写字母，一个小写字母，一位数字和一个特殊字符，并且密码总长度至少为8个字符。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#6、开启远程连接，并使用图形化界面操作</span></span><br><span class="line"><span class="comment">#创建一个账号	名称：erid 密码：Lwz1234@	%：无论在那都可以连接</span></span><br><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;erid&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;Lwz1234@&#x27;</span> WITH GRANT OPTION;</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line"><span class="comment">#使用图形化界面连接linux系统上的mysql数据库时需要将linux系统的防火墙关闭</span></span><br><span class="line"><span class="comment">#关闭防火墙</span></span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line"><span class="comment">#关闭防火墙开启自启</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service</span><br></pre></td></tr></table></figure>

<h3 id="5-3安装Tomcat"><a href="#5-3安装Tomcat" class="headerlink" title="5.3安装Tomcat"></a>5.3安装Tomcat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、下载Tomcat的压缩包（[apcche官网下载](https://tomcat.apache.org/download-80.cgi)）</span></span><br><span class="line">wget https://mirror.bit.edu.cn/apache/tomcat/tomcat-8/v8.5.60/bin/apache-tomcat-8.5.60.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2、解压压缩包到/usr/local</span></span><br><span class="line">tar -zxvf apache-tomcat-8.5.53.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3、启动Tomcat并监听日志</span></span><br><span class="line"><span class="comment">#跳转到tomcat的bin目录</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/apache-tomcat-8.5.53/bin</span><br><span class="line"><span class="comment">#启动</span></span><br><span class="line">。/startup.sh</span><br><span class="line"><span class="comment">#监控日志</span></span><br><span class="line"><span class="built_in">cd</span> ./logs</span><br><span class="line"><span class="built_in">tail</span> -f catalina.out</span><br><span class="line"><span class="comment">#启动成功如下：</span></span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20201126003455802.png#pic_center" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201126003726823.png" alt="在这里插入图片描述"></p>
<h2 id="六、部署SSM工程"><a href="#六、部署SSM工程" class="headerlink" title="六、部署SSM工程"></a>六、部署SSM工程</h2><p>部署项目到Linux中需要注意一下内容：<br>１、项目要保证在Ｗｉｎｄｏｗｓ下时没有问题的，再考虑部署到Linux。<br>２、将开发环境中的内容更改为测试环境。<br>    １、连接数据库的信息<br>    ２、存放文件的路径<br>    ３、日志文件存放的位置<br>    ４、项目路径问题<br>３、将Ｍａｖｅｎ项目打包。<br>４、根据项目路径的不同，将项目部署到Ｔｏｍｃａｔ中。<br>５、在部署到Linux操作系统中后，一定要查看日志。</p>
<p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201128004422526.png" alt="在这里插入图片描述"></p>
<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201128201149566.png" alt="在这里插入图片描述"></p>
<h2 id="一、Docker介绍"><a href="#一、Docker介绍" class="headerlink" title="一、Docker介绍"></a>一、Docker介绍</h2><h3 id="1-1引言-1"><a href="#1-1引言-1" class="headerlink" title="1.1引言"></a>1.1引言</h3><p>1、我本地运行没问题啊<br>      环境不一致<br>2、那个哥们又写死循环了，怎么这么卡<br>      在多用户的操作系统下，会相互影响。<br>3、淘宝在双11的时候，用户量暴增。<br>      运维成本过高的问题<br>4、学习一门技术，学习安装成本过高。<br>      关于安装软件成本过高。</p>
<h3 id="1-2Docker的由来"><a href="#1-2Docker的由来" class="headerlink" title="1.2Docker的由来"></a>1.2Docker的由来</h3><p>一帮年轻人创业，创办了一家公司，2010年的专门做PAAS平台。<br>到了2013年的时候，像亚马逊，微软，Google都开始做PAAS平台。<br>2013年，将公司内的核心技术对外开源，核心技术就是Docker。<br>到了2014年的时候，得到了C轮的融资，$4000W<br>到了2015年的时候，得到了D轮融资，$9500W<br>全神贯注的维护Docker。<br>所罗门主要作者之一。<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201128201946205.png" alt="在这里插入图片描述"><br>Docker的作者已经离开了维护Docker的团队<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201128202412227.png" alt="在这里插入图片描述"></p>
<h3 id="1-4Docker的思想"><a href="#1-4Docker的思想" class="headerlink" title="1.4Docker的思想"></a>1.4Docker的思想</h3><p>1、集装箱：<br>    会将所有需要的内容放到不同的集装箱中，谁需要这些环境就直接拿到这个集装箱就可以了。<br>2、标准化：<br>    1.运输的标准化：Docker有一个码头，所有上传的集装箱都放在了这个码头上，当谁需要某一个环境，就直接指派大海豚去搬运这个集装箱就可以了。<br>    2.命令的标准化：Docker提供了一些列的命令，帮助我们去获取集装箱等等操作。<br>    3.提供了REST的API：衍生出了很多的图形化界面，Rancher。<br>3、隔离性：<br>    Docker在运行集装箱内的内容时，会在Linux的内核中，单独的开辟一片空间不会影响到其他程序。<br>    <img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201128203317861.png" alt="在这里插入图片描述"></p>
<ul>
<li>注册中心。（超级码头，上面放的就是集装箱）</li>
<li>镜像。（集装箱）</li>
<li>容器。（运行起来的镜像）</li>
</ul>
<h2 id="二、Docker的基本操作"><a href="#二、Docker的基本操作" class="headerlink" title="二、Docker的基本操作"></a>二、Docker的基本操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、下载关于Docker的依赖环境</span></span><br><span class="line">yum -y install yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2、设置一下下载Docker的镜像源</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3、安装Docker</span></span><br><span class="line">yum makacache fast</span><br><span class="line">yum -y install docker-ce</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4、启动，并设置为开机自动启动，测试</span></span><br><span class="line"><span class="comment">#启动Docker服务</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="comment">#设置开机自动启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>
<h3 id="2-2Docker的中央仓库"><a href="#2-2Docker的中央仓库" class="headerlink" title="2.2Docker的中央仓库"></a>2.2Docker的中央仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、Docker官方的中央仓库：这个仓库时镜像最全的，但是下载速度较慢。</span><br><span class="line">https://hub.docker.com</span><br><span class="line">2、国内的镜像网站：网易蜂巢，daoCloud...</span><br><span class="line">https://c.163.com/hub<span class="comment">#/home</span></span><br><span class="line">http://hub.daocloud.io</span><br><span class="line">3、在公司内部会采用私服的方式拉去镜像。 </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在公司内部会采用私服的方式拉去镜像</span></span><br><span class="line"><span class="comment">#需要在/etc/docker/daemon.json</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;registry-mirrors&quot;</span>:[<span class="string">&quot;https://registry.docker-cn.com&quot;</span>],</span><br><span class="line">	<span class="string">&quot;insecure-registries&quot;</span>:[<span class="string">&quot;ip:port&quot;</span>]<span class="comment"># ip：公司的ip；port：公司的端口号</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#重启两个服务</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>
<h3 id="2-3镜像的操作"><a href="#2-3镜像的操作" class="headerlink" title="2.3镜像的操作"></a>2.3镜像的操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#拉去镜像到本地</span></span><br><span class="line">docker pull 镜像名称[:tag]</span><br><span class="line"><span class="comment">#举个例子</span></span><br><span class="line"><span class="comment">#daocloud.io/library/tomcat:8.5.16-jre8 拉取的东西</span></span><br><span class="line">docker pull daocloud.io/library/tomcat:8.5.16-jre8</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2、查看全部本地的镜像</span></span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3、删除本地镜像 镜像的标识:IMAGE ID</span></span><br><span class="line">docker rmi 镜像的标识</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#镜像的导入导出（不规范）</span></span><br><span class="line"><span class="comment">#将本地的镜像导出</span></span><br><span class="line">docker save -o 导出的路径 镜像<span class="built_in">id</span></span><br><span class="line"><span class="comment">#加载本地的镜像文件</span></span><br><span class="line">docker load -i 镜像文件</span><br><span class="line"><span class="comment">#修改镜像名称</span></span><br><span class="line">docker tag 镜像<span class="built_in">id</span> 新镜像名称:版本号</span><br></pre></td></tr></table></figure>
<h3 id="2-4-容器的操作"><a href="#2-4-容器的操作" class="headerlink" title="2.4 容器的操作"></a>2.4 容器的操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、运行容器</span></span><br><span class="line"><span class="comment">#简单操作</span></span><br><span class="line">docker run 镜像的标识|镜像名称[:tag]</span><br><span class="line"><span class="comment">#常用的参数</span></span><br><span class="line">docker run -d -p 宿主机端口:容器端口 --name 容器名称 镜像的标识|镜像名称[:tag]</span><br><span class="line"><span class="comment">#-d：表示后台运行容器</span></span><br><span class="line"><span class="comment">#-p 宿主机端口:容器端口：为了映射当前Linux的端口和容器的端口</span></span><br><span class="line"><span class="comment">#--name 容器名称：指定容器的名称</span></span><br></pre></td></tr></table></figure>
<p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201128214122832.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201128214146445.png" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2、查看你正在运行的容器</span></span><br><span class="line">docker ps [-qa]</span><br><span class="line"><span class="comment">#-a：查看全部的容器，包括没有运行</span></span><br><span class="line"><span class="comment">#-q：只查看容器得到标识</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3、查看容器的日志</span></span><br><span class="line">docker logs -f 容器<span class="built_in">id</span></span><br><span class="line"><span class="comment">#-f：可以滚动查看日志的最后几行</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4、进入到容器内部</span></span><br><span class="line">docker <span class="built_in">exec</span> -it 容器<span class="built_in">id</span> bash</span><br></pre></td></tr></table></figure>
<p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201128215306369.png" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#5、删除容器</span></span><br><span class="line">docker stop 容器<span class="built_in">id</span></span><br><span class="line"><span class="comment">#停止指定的容器</span></span><br><span class="line">docker stop $(docker ps -qa)</span><br><span class="line"><span class="comment">#停止全部容器</span></span><br><span class="line">docker <span class="built_in">rm</span> 容器<span class="built_in">id</span></span><br><span class="line"><span class="comment">#删除指定容器</span></span><br><span class="line">docker <span class="built_in">rm</span> $(docker ps -qa)</span><br><span class="line"><span class="comment">#删除全部容器</span></span><br></pre></td></tr></table></figure>
<p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20201128215942654.png" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#6、启动容器</span></span><br><span class="line">docker start 容器<span class="built_in">id</span></span><br></pre></td></tr></table></figure>
<h2 id="三、Docker应用"><a href="#三、Docker应用" class="headerlink" title="三、Docker应用"></a>三、Docker应用</h2><h3 id="3-1准备SSM工程"><a href="#3-1准备SSM工程" class="headerlink" title="3.1准备SSM工程"></a>3.1准备SSM工程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#MySql数据库的连接用户名和密码改变了，修改db.properties</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2准备MySQL容器"><a href="#3-2准备MySQL容器" class="headerlink" title="3.2准备MySQL容器"></a>3.2准备MySQL容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#运行MySQL容器</span></span><br><span class="line">docker run -d -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=root daocloud.io/library/mysql:5.7.4</span><br></pre></td></tr></table></figure>
<h3 id="3-3准备Tomcat容器"><a href="#3-3准备Tomcat容器" class="headerlink" title="3.3准备Tomcat容器"></a>3.3准备Tomcat容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#运行Tomcat容器，前面已经搞定，只需要将SSM项目war包容器内部即可</span></span><br><span class="line"><span class="comment">#可以通过命令将宿主机的内容服务到容器内部</span></span><br><span class="line">docker <span class="built_in">cp</span> 文件名称 容器<span class="built_in">id</span>:容器内部路径</span><br><span class="line"><span class="comment">#举例</span></span><br><span class="line">docker <span class="built_in">cp</span> jobs.war fe:usr/local/tomcat/webapps/</span><br></pre></td></tr></table></figure>
<h3 id="3-4-数据库"><a href="#3-4-数据库" class="headerlink" title="3.4 数据库"></a>3.4 数据库</h3><p>为了部署SSM的工程，需要使用到cp的命令将指定宿主机的ssm.war文件复制到容器内部<br>数据卷：将宿主机的一个目录映射到容器的一个目录中。<br>可以在宿主机中操作目录中的内容，那么容器内部映射的文件，也会跟着一起改变。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、创建数据卷</span></span><br><span class="line">docker volume create 数据卷名称</span><br><span class="line"><span class="comment">#创建数据卷之后，默认会存放在一个目录下 /var/lib/docker/volumes/数据卷名称/_data</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2、查看数据卷的详细信息</span></span><br><span class="line">docker volume inspect 数据卷名称</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3、查看全部数据卷</span></span><br><span class="line">docker volume <span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4、删除数据卷</span></span><br><span class="line">docker volume <span class="built_in">rm</span> 数据卷名称</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#5、应用数据卷</span></span><br><span class="line"><span class="comment">#当你映射数据卷时，如果数据卷不存在。Docker会帮你帮你自动创建，会将容器内部自动的文件，存储在默认的存放路径中</span></span><br><span class="line">docker run -v 数据卷名称:容器内部的路径 镜像<span class="built_in">id</span></span><br><span class="line"><span class="comment">#直接指定一个路径作为数据卷的存放位置。这个路径下是空的。</span></span><br><span class="line">docker run -v 路径:容器内部的路径 镜像<span class="built_in">id</span></span><br></pre></td></tr></table></figure>
<h2 id="四、Dcker自定义镜像"><a href="#四、Dcker自定义镜像" class="headerlink" title="四、Dcker自定义镜像"></a>四、Dcker自定义镜像</h2><p>中央仓库上的镜像，也是Docker的用户自己上传过去的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、创建一个Dockerfile文件，并且指定自定义镜像信息</span></span><br><span class="line"><span class="comment">#Dockerfile文件中常用的内容</span></span><br><span class="line">from：指定当前自定义镜像依赖的环境</span><br><span class="line">copy:将相对路径下的内容复制到自定义镜像中</span><br><span class="line">workdir：声明镜像的默认工作目录</span><br><span class="line">cmd：需要执行的命令（在workdir下执行的，cmd可以写多的，只以最后一个为准）</span><br><span class="line"><span class="comment">#举个例子，自定义一个tomcat镜像，并且将jobs.war部署到tomcat中，</span></span><br><span class="line">from daocloud.io/library/tomcat:8.5.19-jre8</span><br><span class="line">copy jobs.war /usr/local/tomcat/webapps</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2、将准备好的Dockerfile和相应的文件拖拽到Linux操作系统中，通过Docker的命令制作镜像, 后面刚的 点 是指当前目录，可以自己指定</span></span><br><span class="line">docker build -t 镜像名称:[tag] .</span><br></pre></td></tr></table></figure>

<h2 id="六、Dockers-Compose"><a href="#六、Dockers-Compose" class="headerlink" title="六、Dockers-Compose"></a>六、Dockers-Compose</h2><p>之前运行一个镜像，需要添加大量的参数<br>可以通过Dockers-Composes编写这些参数。<br>Docker-Compose可以帮助我们批量的管理容器<br>只需要通过一个docker-compose.yml文件去维护即可</p>
<h3 id="6-1下载Docker-Compose"><a href="#6-1下载Docker-Compose" class="headerlink" title="6.1下载Docker-Compose"></a>6.1下载Docker-Compose</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、去github官网搜索docker-compose,下载1.24.1版本的Docker-Compose</span></span><br><span class="line">https://github.com/docker/compose/releases/download/1.24.1/docker-compose-Linux-x86_64</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2、将下载好的文件，拖拽到Linux操作系统中</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3、需要将DockerCompose文件的名称修改一下，基于DockerCompose文件一个可执行的权限</span></span><br><span class="line"><span class="built_in">mv</span> docker-compose-Linux-x86_64 docker-compose</span><br><span class="line"><span class="built_in">chmod</span> 777 docker-compose</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方便后期操作，配置一个环境变量</span></span><br><span class="line"><span class="comment">#将docker-compose文件移动到/usr/local/bin,修改了/etc/profile文件，给/usr/local/bin配置到了PATH中</span></span><br><span class="line"><span class="built_in">mv</span> docker-compose /usr/local/bin</span><br><span class="line">vi /etc/profile</span><br><span class="line">	<span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>:/usr/local/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#5、测试一下</span></span><br><span class="line">在任意目录下输入docker-compose</span><br></pre></td></tr></table></figure>
<p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/2020120100115776.png" alt="在这里插入图片描述"></p>
<h3 id="6-2Docker-compose管理MySQL和Tomcat容器"><a href="#6-2Docker-compose管理MySQL和Tomcat容器" class="headerlink" title="6.2Docker-compose管理MySQL和Tomcat容器"></a>6.2Docker-compose管理MySQL和Tomcat容器</h3><ul>
<li>yml文件以key: value方式来指定配置信息</li>
<li>多个配置信息以换行+缩进的方式来区分</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span>                <span class="comment"># 服务的名称                </span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span>     <span class="comment"># 代表只要docker启动，那么这个容器就跟着一起启动</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/mysql:5.7.4</span>  <span class="comment"># 指定镜像路径</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span>     <span class="comment"># 指定容器名称</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3306</span><span class="string">:3306</span>    <span class="comment"># 指定端口号的映射</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_RASSWORD:</span> <span class="string">root</span>   <span class="comment"># 指定MySQL的ROOT用户登录密码</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span>           <span class="comment"># 指定时区</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/docker_mysql_tomcat/data:/var/lib/mysql</span>   <span class="comment"># 映射数据卷</span></span><br><span class="line">  <span class="attr">tomcat:</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/tomcat:8.5.16-jre8</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">tomcat</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8080</span><span class="string">:8080</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/docker_mysql_tomcat/tomcat_webapps:/usr/local/tomcat/webapps</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/docker_mysql_tomcat/tomcat_logs:/usr/local/logs</span></span><br></pre></td></tr></table></figure>
<h3 id="6-3使用docker-compose命令管理容器"><a href="#6-3使用docker-compose命令管理容器" class="headerlink" title="6.3使用docker-compose命令管理容器"></a>6.3使用docker-compose命令管理容器</h3><p>在使用docker-compose的命令时，默认会在当前目录下找docker-compose.yml文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、基于docker-compose.yml启动管理的容器</span></span><br><span class="line">docker-compose up -d</span><br><span class="line"><span class="comment">#如果自定义镜像不存在，会帮助我们构建出自定义镜像，如果自定义镜像已经存在，会直接运行这个自定义镜像</span></span><br><span class="line"><span class="comment"># 重新构建的话。</span></span><br><span class="line"><span class="comment"># 重新构建自定义镜像</span></span><br><span class="line">docker-compose build</span><br><span class="line"><span class="comment">#运行前，重新构建</span></span><br><span class="line">docker-compose up -d --build</span><br></pre></td></tr></table></figure>


<h2 id="七、Docker-DI、CD"><a href="#七、Docker-DI、CD" class="headerlink" title="七、Docker DI、CD"></a>七、Docker DI、CD</h2><h3 id="7-1项目部署"><a href="#7-1项目部署" class="headerlink" title="7.1项目部署"></a>7.1项目部署</h3><pre><code>1、将项目通过maven进行编译打包
2、将文件上传到指定的服务器中
3、将war包放到tomcat的目录中
4、通过Dockerfile将Tomcat和war包转成一个镜像，由DockerCompose去运行容器
</code></pre>
<p>项目更新了<br>    将上述流程再次的从头到尾的执行一次</p>
<h3 id="7-2CI介绍"><a href="#7-2CI介绍" class="headerlink" title="7.2CI介绍"></a>7.2CI介绍</h3><p>Ci（continuous intergration）持续集成<br>持续集成：编写代码时，完成了一个功能后，立即提交代码到Git仓库中，将项目重新的构建并且测试。<br>    快速发现错误<br>    防止代码偏离主分支</p>
<h3 id="7-3实现持续集成"><a href="#7-3实现持续集成" class="headerlink" title="7.3实现持续集成"></a>7.3实现持续集成</h3><h4 id="7-3-1搭建Gitlab服务器"><a href="#7-3-1搭建Gitlab服务器" class="headerlink" title="7.3.1搭建Gitlab服务器"></a>7.3.1搭建Gitlab服务器</h4><p>1、创建一个全新的虚拟机，并且至少指定4G运行内存<br>2、安装docker以及docker-compose<br>3、 将ssh的默认22端口，修改为60022</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、打开：vi /etc/ssh/sshd_config</span><br><span class="line">2、修改：RORT 22-&gt;60022</span><br><span class="line">3、重启服务：systemctl restart sshd</span><br></pre></td></tr></table></figure>
<p>4、docker-compose.yml文件去安装gitlab（下载和运行的是时间比较长的）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"> <span class="attr">gitlab:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">&#x27;twang2218/gitlab-ce-zh:11.1.4&#x27;</span></span><br><span class="line">  <span class="attr">container_name:</span> <span class="string">&quot;gitlab&quot;</span></span><br><span class="line">  <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">hostname:</span> <span class="string">&#x27;gitlab&#x27;</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">   <span class="attr">TZ:</span> <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line">   <span class="attr">GITLAB_OMNIBUS_CONFIG:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    external_url &#x27;http://192.168.199.110&#x27;</span></span><br><span class="line"><span class="string">    gitlab_rails[&#x27;time_zone&#x27;] = &#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"><span class="string">    gitlab_rails[&#x27;smtp_enable&#x27;] = true</span></span><br><span class="line"><span class="string">    gitlab_rails[&#x27;gitlab_shell_ssh_port&#x27;] = 22</span></span><br><span class="line"><span class="string"></span>  <span class="attr">ports:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">&#x27;80:80&#x27;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">&#x27;443:443&#x27;</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">&#x27;60022:60022&#x27;</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">/opt/docker_gitlab/config:/etc/gitlab</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">/opt/docker_gitlab/data:/var/opt/gitlab</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">/opt/docker_gitlab/logs:/var/log/gitlab</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="7-3-2搭建Git-ab-Runner"><a href="#7-3-2搭建Git-ab-Runner" class="headerlink" title="7.3.2搭建Git.ab-Runner"></a>7.3.2搭建Git.ab-Runner</h4><h4 id="7-3-3整合项目入门测试"><a href="#7-3-3整合项目入门测试" class="headerlink" title="7.3.3整合项目入门测试"></a>7.3.3整合项目入门测试</h4><p>1、创建maven工程，编写html页面<br>2、编写gitlab-ci.yml文件<br>3、将maven工程推送到gitlab中<br>4、可以在gitlab中查看到gitlab-ci.yml编写的内容</p>
<h2 id="八、安装Jenkins"><a href="#八、安装Jenkins" class="headerlink" title="八、安装Jenkins"></a>八、安装Jenkins</h2><h3 id="8-1-安装Jenkins"><a href="#8-1-安装Jenkins" class="headerlink" title="8.1 安装Jenkins"></a>8.1 安装Jenkins</h3><p><a target="_blank" rel="noopener" href="https://www.jenkins.io/">Jenkins官网地址</a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.1&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">jenkins:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">jenkins/jenkins</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">jenkins</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8888</span><span class="string">:8080</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">5000</span><span class="string">:5000</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/var/Jenkins_home</span></span><br></pre></td></tr></table></figure>
<p>注意：第一次运行时，会因为data目录没有权限，导致启动失败</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 777 data</span><br></pre></td></tr></table></figure>
<h4 id="8-1-1-访问http-ip-8888"><a href="#8-1-1-访问http-ip-8888" class="headerlink" title="8.1.1 访问http://ip:8888"></a>8.1.1 访问<a target="_blank" rel="noopener" href="http://ip:8888/">http://ip:8888</a></h4><p>访问熟读很慢….</p>
<h4 id="8-1-2-查看日志，输入密码登陆Jenkins："><a href="#8-1-2-查看日志，输入密码登陆Jenkins：" class="headerlink" title="8.1.2 查看日志，输入密码登陆Jenkins："></a>8.1.2 查看日志，输入密码登陆Jenkins：</h4><p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210217000925410.png" alt="在这里插入图片描述"></p>
<h4 id="8-1-3-手动指定插件安装："><a href="#8-1-3-手动指定插件安装：" class="headerlink" title="8.1.3 手动指定插件安装："></a>8.1.3 手动指定插件安装：</h4><p>publish ssh…<br>git param…</p>
<h4 id="8-1-4-等待安装完成，指定下列插件即可："><a href="#8-1-4-等待安装完成，指定下列插件即可：" class="headerlink" title="8.1.4 等待安装完成，指定下列插件即可："></a>8.1.4 等待安装完成，指定下列插件即可：</h4><p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210217002623957.png" alt="在这里插入图片描述"></p>
<h4 id="8-1-5-安装成功后，需要指定上用户名和密码"><a href="#8-1-5-安装成功后，需要指定上用户名和密码" class="headerlink" title="8.1.5 安装成功后，需要指定上用户名和密码"></a>8.1.5 安装成功后，需要指定上用户名和密码</h4><p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210217013155483.png" alt="在这里插入图片描述"></p>
<h3 id="8-2-配置目标服务器及GitLab免密登录"><a href="#8-2-配置目标服务器及GitLab免密登录" class="headerlink" title="8.2 配置目标服务器及GitLab免密登录"></a>8.2 配置目标服务器及GitLab免密登录</h3><ul>
<li>GitLab-&gt;Jenkins-&gt;目标服务器<br>1、jenkins去连接目标服务器<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210217163935766.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210217165533678.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210217170443342.png" alt="在这里插入图片描述"></li>
</ul>
<h3 id="8-3-配置GitLab免密码登录（后期使用后补充笔记）"><a href="#8-3-配置GitLab免密码登录（后期使用后补充笔记）" class="headerlink" title="8.3 配置GitLab免密码登录（后期使用后补充笔记）"></a>8.3 配置GitLab免密码登录（后期使用后补充笔记）</h3><p>1、登录Jenkins容器内部<br>2、输入生成SSH密钥命令<br>3、复制GitLab的SSH中</p>
<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210218173650327.png" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Author：Eric</span><br><span class="line">Version：9.0.1</span><br></pre></td></tr></table></figure>

<h3 id="一、-Nginx介绍"><a href="#一、-Nginx介绍" class="headerlink" title="一、 Nginx介绍"></a>一、 Nginx介绍</h3><ul>
<li>为什么要学习Nginx</li>
<li>问题1：客户端到底要将请求发送给哪台服务器</li>
<li>问题2：如果所有客户端的请求都发送给了服务器1.</li>
<li>问题3：客户端发送的请求可能是申请动态资源的，也有申请静态资源的。</li>
</ul>
<p>1、服务器搭建集群后<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210218230823988.png" alt="在这里插入图片描述"><br>2、在搭建集群后，使用Nginx做反向代理服务器<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210218231134182.png" alt="在这里插入图片描述"></p>
<h4 id="1-1-Nginx介绍"><a href="#1-1-Nginx介绍" class="headerlink" title="1.1 Nginx介绍"></a>1.1 Nginx介绍</h4><ul>
<li>Nginx是由俄罗斯人研发的，应对Rambler的网站，并且2004年发布的第一个版本。<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210218231555286.png" alt="在这里插入图片描述"></li>
<li>Nginx的特点：<ul>
<li>1、稳定性极强。7*24小时不间断运行。</li>
<li>2、Nginx提供了非常丰富的配置实例。</li>
<li>3、占用内存小，并发能力强。</li>
</ul>
</li>
</ul>
<h3 id="一、Nginx的安装"><a href="#一、Nginx的安装" class="headerlink" title="一、Nginx的安装"></a>一、Nginx的安装</h3><h4 id="2-1安装Nginx"><a href="#2-1安装Nginx" class="headerlink" title="2.1安装Nginx"></a>2.1安装Nginx</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/nginx:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">80</span><span class="string">:80</span></span><br></pre></td></tr></table></figure>
<p>验证：浏览器中出入ip地址访问</p>
<h4 id="2-2Nginx的配置文件"><a href="#2-2Nginx的配置文件" class="headerlink" title="2.2Nginx的配置文件"></a>2.2Nginx的配置文件</h4><ul>
<li>关于Nginx的核心配置文件Nginx.conf</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">user  nginx;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log warn;</span><br><span class="line"><span class="comment"># 以上统称为全局快</span></span><br><span class="line"><span class="comment"># worker_processes他的数值越大，Nginx的并发能力越强</span></span><br><span class="line"><span class="comment"># error_log 代表Nginx的错误日志存放的位置</span></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># events块</span></span><br><span class="line"><span class="comment"># worker_connections他的数值越大，Ningx并发能力越强</span></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    </span><br><span class="line">    server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    listen  [::]:80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    </span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># location块</span></span><br><span class="line">    <span class="comment"># root： 将接收到的请求根据/usr/share/nginx/html去查找静态资源</span></span><br><span class="line">    <span class="comment"># index:：默认去上述的路径中找到index.html或者index.htm</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># server块</span></span><br><span class="line"><span class="comment"># listen：代表Nginx监听的端口号</span></span><br><span class="line"><span class="comment"># localhost: 代表Nginx接收请求的ip</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># http块</span></span><br><span class="line"><span class="comment"># include 代表引入一个外部的文件 ——&gt; /mime.types中存着大量的媒体类型</span></span><br><span class="line"><span class="comment"># include /etc/nginx/conf.d/*.conf; ——&gt; 引入了conf.d目录下的.conf为结尾的配置文件</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="2-3修改docker-compose文件"><a href="#2-3修改docker-compose文件" class="headerlink" title="2.3修改docker-compose文件"></a>2.3修改docker-compose文件</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/nginx:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">80</span><span class="string">:80</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/docker_nginx/conf.d/:/etc/nginx/conf.d</span></span><br></pre></td></tr></table></figure>
<h3 id="一、Nginx的反向代理"><a href="#一、Nginx的反向代理" class="headerlink" title="一、Nginx的反向代理"></a>一、Nginx的反向代理</h3><h4 id="1-1正向代理"><a href="#1-1正向代理" class="headerlink" title="1.1正向代理"></a>1.1正向代理</h4><p>1、正向代理服务时由客户端设立的。<br>2、客户端了解代理服务器和目标服务器都是谁。<br>3、帮助咱们实现突破访问权限，提高访问的速度，对目标服务器隐藏客户端的ip地址<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210321130028361.png" alt="在这里插入图片描述"></p>
<h4 id="1-2反向代理"><a href="#1-2反向代理" class="headerlink" title="1.2反向代理"></a>1.2反向代理</h4><p>1、反向代理服务器是配置在服务端的。<br>2、客户端是不知道访问的到底是哪一台服务器。<br>3、达到负载均衡，并且可以隐藏服务器真正的ip地址。<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210321131555864.png" alt="在这里插入图片描述"></p>
<h4 id="1-3基于Nginx实现反向代理"><a href="#1-3基于Nginx实现反向代理" class="headerlink" title="1.3基于Nginx实现反向代理"></a>1.3基于Nginx实现反向代理</h4><p>1、准备一个目标服务器：启动一个tomcat服务器<br>2、编写nginx的配置文件，通过nginx访问tomcat服务器</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">server&#123;x</span></span><br><span class="line">  <span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line">  <span class="string">server_name</span> <span class="string">localhost;</span></span><br><span class="line">  <span class="comment"># 基于反向代理访问到Tomcat服务器</span></span><br><span class="line">  <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">    <span class="string">proxy_pass</span> <span class="string">http://192.168.2.191:8080/;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="1-4关于Nginx的location路径映射"><a href="#1-4关于Nginx的location路径映射" class="headerlink" title="1.4关于Nginx的location路径映射"></a>1.4关于Nginx的location路径映射</h4><p>优先级关系：<br>(location &#x3D; ) &gt; (location &#x2F;xxx) &gt; (location ^~ &#x2F;images&#x2F;) &gt; (location ~，location ~*) &gt; （location &#x2F;起始路径）&gt; （location &#x2F;）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、 = 匹配</span></span><br><span class="line"><span class="string">location</span> <span class="string">=</span> <span class="string">/</span> &#123;</span><br><span class="line">  <span class="comment"># 精准匹配，主机名后面不能带任何的字符串</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2、通用匹配</span></span><br><span class="line"><span class="string">location</span> <span class="string">/xxx</span> &#123;</span><br><span class="line">  <span class="comment"># 匹配所有以/xxx开头的路径</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3、正则匹配</span></span><br><span class="line"><span class="string">location</span> <span class="string">~</span> <span class="string">/xxx</span> &#123;</span><br><span class="line">  <span class="comment"># 匹配所有以/xxx开头的路径，高于通用匹配</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4、正则匹配</span></span><br><span class="line"><span class="string">location</span> <span class="string">^~</span> <span class="string">/images/</span> &#123;</span><br><span class="line">  <span class="comment"># 匹配所有以/images开头的路径，高于正则匹配</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5、~*\.(gif|jpg|png) &#123;</span></span><br><span class="line">  <span class="comment"># 匹配以gif或者jpg或者png为结尾的路径</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="二、Nginx负载均衡"><a href="#二、Nginx负载均衡" class="headerlink" title="二、Nginx负载均衡"></a>二、Nginx负载均衡</h3><p>Nginx为我们默认提供了三种负载均衡的策略：<br>    1、轮询：<br>        将客户端发起的请求，平均的分配给每一台服务器<br>    2、权重：<br>        会将客户端的请求，根据服务器的权重值不同，分配不同的数据<br>    3、ip_hash:<br>        基于发起请求的客户端的ip地址不同，他始终将请求发送到指定的服务器上</p>
<h4 id="2-1-轮询"><a href="#2-1-轮询" class="headerlink" title="2.1 轮询"></a>2.1 轮询</h4><p>想实现Nginx轮询负载均衡机制只需要在配置文件中添加以下内容。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">upstream</span> <span class="string">名字&#123;</span></span><br><span class="line">  <span class="string">server</span> <span class="string">ip:prot;</span></span><br><span class="line">  <span class="string">server</span> <span class="string">ip:prot;</span></span><br><span class="line">  <span class="string">……</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">server&#123;</span></span><br><span class="line">  <span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line">  <span class="string">server_name</span> <span class="string">localhost;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">    <span class="string">proxy_pass</span> <span class="string">http://upstream的名字;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-权重"><a href="#2-2-权重" class="headerlink" title="2.2 权重"></a>2.2 权重</h4><p>实现权重的方法</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">upstream</span> <span class="string">名字&#123;</span></span><br><span class="line">  <span class="string">server</span> <span class="string">ip:prot</span> <span class="string">weight=权重比例;</span></span><br><span class="line">  <span class="string">server</span> <span class="string">ip:prot</span> <span class="string">weight=权重比例;</span></span><br><span class="line">  <span class="string">……</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">server&#123;</span></span><br><span class="line">  <span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line">  <span class="string">server_name</span> <span class="string">localhost;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">    <span class="string">proxy_pass</span> <span class="string">http://upstream的名字;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-ip-hash"><a href="#2-3-ip-hash" class="headerlink" title="2.3 ip_hash"></a>2.3 ip_hash</h4><p>ip_hash实现</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">upstream</span> <span class="string">名字&#123;</span></span><br><span class="line">  <span class="string">ip_hash;</span></span><br><span class="line">  <span class="string">server</span> <span class="string">ip:prot</span> <span class="string">weight=权重比例;</span></span><br><span class="line">  <span class="string">server</span> <span class="string">ip:prot</span> <span class="string">weight=权重比例;</span></span><br><span class="line">  <span class="string">……</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">server&#123;</span></span><br><span class="line">  <span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line">  <span class="string">server_name</span> <span class="string">localhost;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">    <span class="string">proxy_pass</span> <span class="string">http://upstream的名字;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="三、Nginx动静分离"><a href="#三、Nginx动静分离" class="headerlink" title="三、Nginx动静分离"></a>三、Nginx动静分离</h3><p>Nginx的并发能力公式：<br>    worker_processes  *worker_connections &#x2F; 4 | 2&#x3D;Nginx最终的并发能力。<br>动态资源&#x2F;4；静态资源&#x2F;2；<br>Nginx通过动静分离，来提升Nginx的并发能力，更快的给用户相应。</p>
<h4 id="3-1动态资源代理"><a href="#3-1动态资源代理" class="headerlink" title="3.1动态资源代理"></a>3.1动态资源代理</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置如下</span></span><br><span class="line"><span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">  <span class="string">proxy_pass</span> <span class="string">路径;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-2动态资源代理"><a href="#3-2动态资源代理" class="headerlink" title="3.2动态资源代理"></a>3.2动态资源代理</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置如下</span></span><br><span class="line"><span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">  <span class="string">root</span> <span class="string">静态资源路径;</span></span><br><span class="line">  <span class="string">index</span> <span class="string">默认访问路径下的生名资源；</span></span><br><span class="line">  <span class="string">autoindex</span> <span class="string">on;</span>  <span class="comment"># 表示展示静态资源下的全部内容，以列表的形式展示</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 先修改docker，添加一个数据卷，映射到Nginx的一个目录</span></span><br></pre></td></tr></table></figure>

<h3 id="四、Nginx集群"><a href="#四、Nginx集群" class="headerlink" title="四、Nginx集群"></a>四、Nginx集群</h3><h4 id="4-1-引言"><a href="#4-1-引言" class="headerlink" title="4.1 引言"></a>4.1 引言</h4><p>单点故障，避免nginx的宕机，导致整个程序的崩溃<br>准备多台Nginx<br>准备keeppalived，监听nginx的健康情况<br>准备haproxy，提供一个虚拟的路径，统一的去接收用户的请i去。<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210326011246138.png" alt="在这里插入图片描述"></p>
<h4 id="4-2-搭建Nginx集群"><a href="#4-2-搭建Nginx集群" class="headerlink" title="4.2 搭建Nginx集群"></a>4.2 搭建Nginx集群</h4><p>查看资料中的文件；全部拷贝修改IP地址到下一个目录后执行：docker-compose up -d<br>文件路径：<br>    nginx集群.zip<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210326013208155.png" alt="在这里插入图片描述"></p>
<h1 id="ES"><a href="#ES" class="headerlink" title="ES"></a>ES</h1><p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210327140100924.png" alt="在这里插入图片描述"></p>
<h3 id="1-2-ES引言"><a href="#1-2-ES引言" class="headerlink" title="1.2 ES引言"></a>1.2 ES引言</h3><p>ES是一个使用Java语言的基于Lucene编写的搜索引擎框架，他提供了分布式的全文搜索功能，提供一个统一的基于RESTful的WEB接口，官方客户端也对多种语言都提供了响应的API。<br>Lucene：Lucene本身就是一个搜索引擎的底层。<br>分布式：ES主要是为了突出他的横向扩张能力。<br>全文搜索：讲一段词语进行分词，并且将分出的单个词语统一的放到一个分词库中，在搜索时，根据关键字去粉刺库中搜索，找到匹配的内容。（倒排索引）<br>RESTful风格的WEB接口：操作ES跟简单，只需要发送一个HTTP请求，并且根据请求方式的不同，携带参数的同时，执行相应的功能。<br>应用广泛：GitHub.com，WIKI，Gold Man用ES每天维护将近10TB的数据。</p>
<h3 id="1-3-ES的由来"><a href="#1-3-ES的由来" class="headerlink" title="1.3 ES的由来"></a>1.3 ES的由来</h3><p>见官网：<a target="_blank" rel="noopener" href="http://www.elastic.cn/">http://www.elastic.cn</a></p>
<h3 id="1-4-ES和Slor"><a href="#1-4-ES和Slor" class="headerlink" title="1.4 ES和Slor"></a>1.4 ES和Slor</h3><p>1、Solr在查询死数据时，速度相对ES更快一些，但是数据如果是实时改变的，Solr的查询速度会降低很多，ES的查询的效率基本没有变化。<br>2、Solr搭建集群需要依赖Zookeeper来帮助管理，ES本身就支持集群的搭建，不需要第三方的介入。<br>3、最开始Solr的社会可以说是非常火爆，针对国内的文档不是很多，在ES出现之后，ES的社会火爆程度直线上升，ES的文档非常建全。<br>4、ES对现在云计算和大数据支持的特别好。<br>见官网：<a target="_blank" rel="noopener" href="http://www.elastic.cn/">http://www.elastic.cn</a></p>
<h3 id="1-5-倒排索引"><a href="#1-5-倒排索引" class="headerlink" title="1.5 倒排索引"></a>1.5 倒排索引</h3><p>将存放的数据，以一定方式进行分词，并且将分词的内容放到一个单独的分词库中。<br>当用户去查询数据时，会将用户的查询关键字进行分词。<br>然后去分词库中匹配内容，最终得到数据的id标识。<br>根据id标识去存放数据的位置拉取到指定数据。<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210327144231461.png" alt="**加粗样式**"></p>
<h2 id="二、ElasticSearch安装"><a href="#二、ElasticSearch安装" class="headerlink" title="二、ElasticSearch安装"></a>二、ElasticSearch安装</h2><h3 id="2-1-安装ES-Kibana"><a href="#2-1-安装ES-Kibana" class="headerlink" title="2.1 安装ES&amp;Kibana"></a>2.1 安装ES&amp;Kibana</h3><p>Kibana是ES的图形化界面，版本号需一致；</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.1&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/elasticsearch:6.5.4</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">elasticsearch</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9200</span><span class="string">:9200</span></span><br><span class="line">  <span class="attr">kibana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/kibana:6.5.4</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kibana</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">5601</span><span class="string">:5601</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elasticsearch_url=http://192.168.2.191:9200</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elasticsearch</span></span><br></pre></td></tr></table></figure>
<p>注意：<br>虚拟机内存需要至少需要262144，修改内存可见：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qzqanzc/article/details/83270679">https://blog.csdn.net/qzqanzc/article/details/83270679</a></p>
<h3 id="2-2-安装IK分词器"><a href="#2-2-安装IK分词器" class="headerlink" title="2.2. 安装IK分词器"></a>2.2. 安装IK分词器</h3><p>1、进入es容器内部安装IK，IK相当于一个插件在&#x2F;bin&#x2F;elasticsearch-plugin：docker exec -it CONTAINER ID值 bash</p>
<p>2、下载Ik分词器的地址：<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.5.4/elasticsearch-analysis-ik-6.3.0.zip">https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.5.4/elasticsearch-analysis-ik-6.3.0.zip</a><br>3、Linux系统安装：.&#x2F;bin&#x2F;elasticsearch-plugin install <a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.5.4/elasticsearch-analysis-ik-6.5.4.zip">https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.5.4/elasticsearch-analysis-ik-6.5.4.zip</a><br>    国外的有点慢可以试试这个：.&#x2F;bin&#x2F;elasticsearch-plugin install <a target="_blank" rel="noopener" href="http://tomcat01.qfjava.cn:81/elasticsearch-analysis-ik-6.3.0.zip">http://tomcat01.qfjava.cn:81/elasticsearch-analysis-ik-6.3.0.zip</a><br>4、重启ES的容器，让IK分词器生效。<br>5、测试，使用方法可见github的IK使用文档<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/2021032716064258.png" alt="在这里插入图片描述"></p>
<h2 id="三、ElasticSearch基本操作"><a href="#三、ElasticSearch基本操作" class="headerlink" title="三、ElasticSearch基本操作"></a>三、ElasticSearch基本操作</h2><h3 id="3-1-ES的结构"><a href="#3-1-ES的结构" class="headerlink" title="3.1 ES的结构"></a>3.1 ES的结构</h3><h4 id="3-1-1-索引-Index，分片和备份"><a href="#3-1-1-索引-Index，分片和备份" class="headerlink" title="3.1.1 索引 Index，分片和备份"></a>3.1.1 索引 Index，分片和备份</h4><h4 id="3-1-2-类型-Type"><a href="#3-1-2-类型-Type" class="headerlink" title="3.1.2 类型 Type"></a>3.1.2 类型 Type</h4><h4 id="3-1-3-文档-Doc"><a href="#3-1-3-文档-Doc" class="headerlink" title="3.1.3 文档 Doc"></a>3.1.3 文档 Doc</h4><h4 id="3-1-4-属性-FieId"><a href="#3-1-4-属性-FieId" class="headerlink" title="3.1.4 属性 FieId"></a>3.1.4 属性 FieId</h4><h3 id="3-2-操作ES的RESTful语法"><a href="#3-2-操作ES的RESTful语法" class="headerlink" title="3.2 操作ES的RESTful语法"></a>3.2 操作ES的RESTful语法</h3><h3 id="3-3索引的操作"><a href="#3-3索引的操作" class="headerlink" title="3.3索引的操作"></a>3.3索引的操作</h3><h4 id="3-3-1-创建一个索引"><a href="#3-3-1-创建一个索引" class="headerlink" title="3.3.1 创建一个索引"></a>3.3.1 创建一个索引</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个索引</span></span><br><span class="line"><span class="string">PUT</span> <span class="string">/person</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;settings&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;number_of_shards&quot;:</span> <span class="number">5</span>,</span><br><span class="line">    <span class="attr">&quot;number_of_replicas&quot;:</span> <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-2-查看索引信息"><a href="#3-3-2-查看索引信息" class="headerlink" title="3.3.2 查看索引信息"></a>3.3.2 查看索引信息</h4><p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210327161741156.png" alt="在这里插入图片描述"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看suoyin索引信息</span></span><br><span class="line"><span class="string">GET</span> <span class="string">/person</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-3-删除索引"><a href="#3-3-3-删除索引" class="headerlink" title="3.3.3 删除索引"></a>3.3.3 删除索引</h4><p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210327161934736.png" alt="在这里插入图片描述"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shanchu删除索引</span></span><br><span class="line"><span class="string">DELETE</span> <span class="string">/person</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-ES中field可以指定的类型"><a href="#3-4-ES中field可以指定的类型" class="headerlink" title="3.4 ES中field可以指定的类型"></a>3.4 ES中field可以指定的类型</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">字符串类型：</span><br><span class="line">	text：一把被用于全文检索。将当前Field进行分词。</span><br><span class="line">	keyword：当前Field不会被分词</span><br><span class="line">数值类型：</span><br><span class="line">	long：</span><br><span class="line">	<span class="built_in">integer</span>：</span><br><span class="line">	short：</span><br><span class="line">	byte：</span><br><span class="line">	double：</span><br><span class="line">	<span class="built_in">float</span>：</span><br><span class="line">	half_float：精度比<span class="built_in">float</span>小一半</span><br><span class="line">	scaled_float：根据一个long和scaled来表达一个浮点型，long-345，scaled-100-》3.45</span><br><span class="line">时间类型：</span><br><span class="line">	<span class="built_in">date</span>类型：针对时间类型指定具体的格式</span><br><span class="line">布尔类型：</span><br><span class="line">	boolean类型，表达<span class="literal">true</span>和<span class="literal">false</span></span><br><span class="line">二进制类型：</span><br><span class="line">	binary类型暂时支持Base64 encode string</span><br><span class="line">范围类型：</span><br><span class="line">	long_range：赋值时，无需指定具体的内容，只需要存储一个范围即可，指定gt，lt，gte，lte</span><br><span class="line">	integer_range：同上</span><br><span class="line">	double_range：同上</span><br><span class="line">	float_range：同上</span><br><span class="line">	<span class="built_in">date</span>——range：同上</span><br><span class="line">	ip_range：同上</span><br><span class="line">经纬度类型：</span><br><span class="line">	geo_point：用来存储经纬度的</span><br><span class="line">ip类型：</span><br><span class="line">	ip：可以存储IPV4或者IPV6</span><br><span class="line">其他的数据类型参考官网：https://www.elastic.co/guide/en/elasticsearch/reference/6.5/mapping-types.html</span><br></pre></td></tr></table></figure>
<h3 id="3-5-创建索引并指定数据结构"><a href="#3-5-创建索引并指定数据结构" class="headerlink" title="3.5 创建索引并指定数据结构"></a>3.5 创建索引并指定数据结构</h3><p>es版本需为6.5.4的，新版本可能有变动，需自行修改。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个索引，指定数据结构</span></span><br><span class="line">PUT /book</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="comment"># 分片数</span></span><br><span class="line">    <span class="string">&quot;number_of_shards&quot;</span>: 5,</span><br><span class="line">    <span class="comment"># 备份数</span></span><br><span class="line">    <span class="string">&quot;number_of_replicas&quot;</span>: 1</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment"># 指定数据结构</span></span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="comment"># 类型Type</span></span><br><span class="line">    <span class="string">&quot;novel&quot;</span>: &#123;</span><br><span class="line">      <span class="comment"># 文档存储的Field</span></span><br><span class="line">      <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">        <span class="comment"># field属性名</span></span><br><span class="line">        <span class="string">&quot;name&quot;</span>: &#123;</span><br><span class="line">          <span class="comment"># 类型</span></span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="comment"># 指定分词器</span></span><br><span class="line">          <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span>,</span><br><span class="line">          <span class="comment"># 指定当前Field可以被作为查询的条件</span></span><br><span class="line">          <span class="string">&quot;index&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment"># 是否需要额外存储</span></span><br><span class="line">          <span class="string">&quot;store&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;author&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;count&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;on-sale&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;date&quot;</span>,</span><br><span class="line">          <span class="comment"># 时间类型的格式化方式</span></span><br><span class="line">          <span class="string">&quot;format&quot;</span>: <span class="string">&quot;yyyy-MM-dd:ss||yyyy-MM-dd||epoch_millis&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;descr&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-6-文档的操作"><a href="#3-6-文档的操作" class="headerlink" title="3.6 文档的操作"></a>3.6 文档的操作</h3><p>文档在ES服务中的唯一标识，<code>_index</code>，<code>_type</code>，<code>_id</code> 三个内容为符合，锁定一个文档。操作时，是添加还是修改。</p>
<h4 id="3-6-1-新建文档"><a href="#3-6-1-新建文档" class="headerlink" title="3.6.1 新建文档"></a>3.6.1 新建文档</h4><p><code>自动生成_id</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加文档，自动生成id</span></span><br><span class="line">POST /book/novel</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;盘龙&quot;</span>,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;我吃西红柿&quot;</span>,</span><br><span class="line">  <span class="string">&quot;on-sale&quot;</span>: <span class="string">&quot;2000-04-04&quot;</span>,</span><br><span class="line">  <span class="string">&quot;descr&quot;</span>:<span class="string">&quot;哈哈哈嘻嘻嘻&quot;</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p><code>手动指定id</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加文档，手动指定id</span></span><br><span class="line">PUT /book/novel/1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;红楼梦&quot;</span>,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;曹雪芹&quot;</span>,</span><br><span class="line">  <span class="string">&quot;on-sale&quot;</span>: <span class="string">&quot;1985-01-04&quot;</span>,</span><br><span class="line">  <span class="string">&quot;descr&quot;</span>:<span class="string">&quot;书籍123121321213212132&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-6-2-修改文档"><a href="#3-6-2-修改文档" class="headerlink" title="3.6.2 修改文档"></a>3.6.2 修改文档</h4><p><code>覆盖式修改</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加文档，手动指定id</span></span><br><span class="line">PUT /book/novel/1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;红楼梦&quot;</span>,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;曹雪芹&quot;</span>,</span><br><span class="line">  <span class="string">&quot;on-sale&quot;</span>: <span class="string">&quot;1985-01-04&quot;</span>,</span><br><span class="line">  <span class="string">&quot;descr&quot;</span>:<span class="string">&quot;书籍123121321213212132&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>doc修改方式</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改文档，基于doc方式</span></span><br><span class="line">POST /book/novel/1/_update</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;doc&quot;</span>: &#123;</span><br><span class="line">    <span class="comment"># 指定上需要修改的field和对应的值</span></span><br><span class="line">    <span class="string">&quot;count&quot;</span>: <span class="string">&quot;123456&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-6-3-删除文档"><a href="#3-6-3-删除文档" class="headerlink" title="3.6.3 删除文档"></a>3.6.3 删除文档</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据id删除文档</span></span><br><span class="line">DELETE /book/novel/_id值</span><br></pre></td></tr></table></figure>
<h2 id="四、Java操作ElasticSearch"><a href="#四、Java操作ElasticSearch" class="headerlink" title="四、Java操作ElasticSearch"></a>四、Java操作ElasticSearch</h2><h3 id="4-1-Java连接ES"><a href="#4-1-Java连接ES" class="headerlink" title="4.1 Java连接ES"></a>4.1 Java连接ES</h3><ul>
<li>创建Maven工程</li>
<li>导入依赖<ul>
<li>1、elasticsearch</li>
<li>2、elasticsearch的高级API</li>
<li>3、junit</li>
<li>4、lombok<br>  注：可通过mvn官网查看：<a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.elasticsearch.client/elasticsearch-rest-high-level-client/6.5.4">https://mvnrepository.com/artifact/org.elasticsearch.client/elasticsearch-rest-high-level-client/6.5.4</a><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1、elasticsearch --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2、elasticsearch的高级API --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3、junit --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 4、lombok --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 5、jackson --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>创建测试类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ESClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RestHighLevelClient <span class="title function_">getClient</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建HttpHost</span></span><br><span class="line">        HttpHost host=<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;192.168.2.191&quot;</span>,<span class="number">9200</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建RestClientBuilder</span></span><br><span class="line">        RestClientBuilder clientBuilder= RestClient.builder(host);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建RestHighLevelClient</span></span><br><span class="line">        RestHighLevelClient client=<span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(clientBuilder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回</span></span><br><span class="line">        <span class="keyword">return</span>  client;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2Java操作索引"><a href="#4-2Java操作索引" class="headerlink" title="4.2Java操作索引"></a>4.2Java操作索引</h3><h3 id="4-2-1-Java创建索引"><a href="#4-2-1-Java创建索引" class="headerlink" title="4.2.1 Java创建索引"></a>4.2.1 Java创建索引</h3><p><code>创建索引</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//1、准备关于索引的settings</span></span><br><span class="line">    Settings.<span class="type">Builder</span> <span class="variable">settings</span> <span class="operator">=</span> Settings.builder()</span><br><span class="line">            .put(<span class="string">&quot;number_of_shards&quot;</span>, <span class="number">3</span>)</span><br><span class="line">            .put(<span class="string">&quot;number_of_replicas&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、准备关于索引的结构mappings</span></span><br><span class="line">    <span class="type">XContentBuilder</span> <span class="variable">mappings</span> <span class="operator">=</span> JsonXContent.contentBuilder()</span><br><span class="line">            .startObject()</span><br><span class="line">              .startObject(<span class="string">&quot;properties&quot;</span>)</span><br><span class="line">                .startObject(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">                    .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;text&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">                    .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;integer&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;birthday&quot;</span>)</span><br><span class="line">                    .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;date&quot;</span>)</span><br><span class="line">                    .field(<span class="string">&quot;format&quot;</span>,<span class="string">&quot;yyyy-MM-dd&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">              .endObject()</span><br><span class="line">            .endObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3、将settings和mappings封装到一个Request对象</span></span><br><span class="line">    CreateIndexRequest request=<span class="keyword">new</span> <span class="title class_">CreateIndexRequest</span>(index)</span><br><span class="line">            .settings(settings)</span><br><span class="line">            .mapping(type,mappings);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4、通过client对象去连接ES并执行创建索引</span></span><br><span class="line">    <span class="type">CreateIndexResponse</span> <span class="variable">resp</span> <span class="operator">=</span> client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5、输出测试</span></span><br><span class="line">    System.out.println(<span class="string">&quot;resp:&quot;</span>+resp.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-2-创建索引是否存在，删除索引"><a href="#4-2-2-创建索引是否存在，删除索引" class="headerlink" title="4.2.2 创建索引是否存在，删除索引"></a>4.2.2 创建索引是否存在，删除索引</h3><p><code>检测索引是否存在</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exists</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//1、准备request对象</span></span><br><span class="line">    GetIndexRequest request=<span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>();</span><br><span class="line">    request.indices(index);</span><br><span class="line">    <span class="comment">//2、通过client对象执行</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> client.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">//3、输出</span></span><br><span class="line">    System.out.println(<span class="string">&quot;exists:&quot;</span>+exists);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="4-2-3-删除索引"><a href="#4-2-3-删除索引" class="headerlink" title="4.2.3 删除索引"></a>4.2.3 删除索引</h3><p><code>删除索引</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//准备request对象</span></span><br><span class="line">    DeleteIndexRequest request=<span class="keyword">new</span> <span class="title class_">DeleteIndexRequest</span>()</span><br><span class="line">            .indices(index);</span><br><span class="line">    <span class="comment">//通过client执行</span></span><br><span class="line">    <span class="type">AcknowledgedResponse</span> <span class="variable">delete</span> <span class="operator">=</span> client.indices().delete(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">//获取执行结构</span></span><br><span class="line">    System.out.println(<span class="string">&quot;delete:&quot;</span>+delete.isAcknowledged());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-Java操作文档"><a href="#4-3-Java操作文档" class="headerlink" title="4.3 Java操作文档"></a>4.3 Java操作文档</h3><h4 id="4-3-1-添加文档操作"><a href="#4-3-1-添加文档操作" class="headerlink" title="4.3.1 添加文档操作"></a>4.3.1 添加文档操作</h4><p><code>添加文档操作</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Deom3</span> &#123;</span><br><span class="line">    ObjectMapper mapper=<span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">RestHighLevelClient</span> <span class="variable">client</span> <span class="operator">=</span> ESClient.getClient();</span><br><span class="line">    String index=<span class="string">&quot;persion&quot;</span>;</span><br><span class="line">    String type=<span class="string">&quot;man&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、准备json数据</span></span><br><span class="line">        Persion persion=<span class="keyword">new</span> <span class="title class_">Persion</span>(<span class="number">1</span>,<span class="string">&quot;张三&quot;</span>,<span class="number">23</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        String json=mapper.writeValueAsString(persion);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、准备一个request对象</span></span><br><span class="line">        IndexRequest request=<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(index,type,persion.getId().toString());</span><br><span class="line">        request.source(json, XContentType.JSON);</span><br><span class="line">        <span class="comment">//3、通过client执行</span></span><br><span class="line">        <span class="type">IndexResponse</span> <span class="variable">index</span> <span class="operator">=</span> client.index(request, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">//4、输出返回结果</span></span><br><span class="line">        System.out.println(index.getResult().toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-1-修改文档"><a href="#4-3-1-修改文档" class="headerlink" title="4.3.1 修改文档"></a>4.3.1 修改文档</h4><p><code>修改文档</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">UpdateDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//1、创建一个Map，指定需要需改的内容</span></span><br><span class="line">    Map&lt;String,Object&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;张大帅&quot;</span>);</span><br><span class="line">    String docId=<span class="string">&quot;1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、创建request对象，封装数据</span></span><br><span class="line">    UpdateRequest request=<span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(index,type,docId);</span><br><span class="line">    request.doc(map);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3、通过client对象执行</span></span><br><span class="line">    <span class="type">UpdateResponse</span> <span class="variable">update</span> <span class="operator">=</span> client.update(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4、输出返回结果</span></span><br><span class="line">    System.out.println(update.getResult().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-1-删除文档"><a href="#4-3-1-删除文档" class="headerlink" title="4.3.1 删除文档"></a>4.3.1 删除文档</h4><p><code>删除文档</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//1、封装Request对象</span></span><br><span class="line">    DeleteRequest request=<span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(index,type,<span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、client执行</span></span><br><span class="line">    <span class="type">DeleteResponse</span> <span class="variable">delete</span> <span class="operator">=</span> client.delete(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3、输出结果</span></span><br><span class="line">    System.out.println(delete.getResult().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-4-Java批量操作文档"><a href="#4-4-Java批量操作文档" class="headerlink" title="4.4 Java批量操作文档"></a>4.4 Java批量操作文档</h3><h4 id="4-4-1-批量添加文档"><a href="#4-4-1-批量添加文档" class="headerlink" title="4.4.1 批量添加文档"></a>4.4.1 批量添加文档</h4><p><code>批量添加文档</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bulkCreateDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//1、准备多个json数据</span></span><br><span class="line">    <span class="type">Persion</span> <span class="variable">persion1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Persion</span>(<span class="number">1</span>, <span class="string">&quot;张三&quot;</span>, <span class="number">23</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">Persion</span> <span class="variable">persion2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Persion</span>(<span class="number">2</span>, <span class="string">&quot;李四&quot;</span>, <span class="number">25</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">Persion</span> <span class="variable">persion3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Persion</span>(<span class="number">3</span>, <span class="string">&quot;王五&quot;</span>, <span class="number">24</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">String</span> <span class="variable">json1</span> <span class="operator">=</span> mapper.writeValueAsString(persion1);</span><br><span class="line">    <span class="type">String</span> <span class="variable">json2</span> <span class="operator">=</span> mapper.writeValueAsString(persion2);</span><br><span class="line">    <span class="type">String</span> <span class="variable">json3</span> <span class="operator">=</span> mapper.writeValueAsString(persion3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、创建Request，将准备好的数据封装进去</span></span><br><span class="line">    BulkRequest request=<span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line">    request.add(<span class="keyword">new</span> 	<span class="title class_">IndexRequest</span>(index,type,persion1.getId().toString()).source(json1,XContentType.JSON));</span><br><span class="line">    request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(index,type,persion2.getId().toString()).source(json2,XContentType.JSON));</span><br><span class="line">    request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(index,type,persion3.getId().toString()).source(json3,XContentType.JSON));</span><br><span class="line">    <span class="comment">//3、用client执行</span></span><br><span class="line">    <span class="type">BulkResponse</span> <span class="variable">bulk</span> <span class="operator">=</span> client.bulk(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">//4、输出结果</span></span><br><span class="line">    System.out.println(bulk.toString());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="4-4-2-批量删除文档"><a href="#4-4-2-批量删除文档" class="headerlink" title="4.4.2 批量删除文档"></a>4.4.2 批量删除文档</h4><p><code>批量删除文档</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bulkDeleteDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//1、封装Request对象</span></span><br><span class="line">    BulkRequest request=<span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line">    request.add(<span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(index,type,<span class="string">&quot;1&quot;</span>));</span><br><span class="line">    request.add(<span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(index,type,<span class="string">&quot;2&quot;</span>));</span><br><span class="line">    request.add(<span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(index,type,<span class="string">&quot;3&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、client执行</span></span><br><span class="line">    <span class="type">BulkResponse</span> <span class="variable">bulk</span> <span class="operator">=</span> client.bulk(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3、输出</span></span><br><span class="line">    System.out.println(bulk);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="五、ElasticSearch练习"><a href="#五、ElasticSearch练习" class="headerlink" title="五、ElasticSearch练习"></a>五、ElasticSearch练习</h2><ul>
<li>索引：sms-logs-index</li>
<li>类型：sms-logs-type<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210329235456632.png" alt="在这里插入图片描述"></li>
</ul>
<h2 id="六、ElasticSearch的各中查询"><a href="#六、ElasticSearch的各中查询" class="headerlink" title="六、ElasticSearch的各中查询"></a>六、ElasticSearch的各中查询</h2><h3 id="6-1-term-terms查询"><a href="#6-1-term-terms查询" class="headerlink" title="6.1 term&amp;terms查询"></a>6.1 term&amp;terms查询</h3><h4 id="6-1-1-term查询"><a href="#6-1-1-term查询" class="headerlink" title="6.1.1 term查询"></a>6.1.1 term查询</h4><ul>
<li>term的查询时代表完全匹配，搜索之前不会对你搜索的关键词进行分词，对你的关键词去文档分词库中匹配内容</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># term查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span>		# limit ？</span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span>		# limit x<span class="punctuation">,</span>?</span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;province&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java代码实现方式</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">termQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、创建Request对象</span></span><br><span class="line">        SearchRequest request=<span class="keyword">new</span> <span class="title class_">SearchRequest</span>(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、指定查询条件</span></span><br><span class="line">        SearchSourceBuilder builder=<span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        builder.from(<span class="number">0</span>);</span><br><span class="line">        builder.size(<span class="number">5</span>);</span><br><span class="line">        builder.query(QueryBuilders.termQuery(<span class="string">&quot;province&quot;</span>,<span class="string">&quot;北京&quot;</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、执行查询</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">search</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、获取_source中数据，并展示</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : search.getHits().getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; asMap = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(asMap);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-1-2-terms查询"><a href="#6-1-2-terms查询" class="headerlink" title="6.1.2 terms查询"></a>6.1.2 terms查询</h4><ul>
<li>terms和term的查询机制是一样，都不会将指定的查询关键字进行分词，直接去分词库中匹配，找到相应文档内容。</li>
<li>terms是在针对一个字段包含多个值的时候使用。</li>
<li>term：where province&#x3D;”北京” ；</li>
<li>terms：where province&#x3D;“北京” or province&#x3D;？ or province&#x3D;？；</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># terms查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;province&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;北京&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;山西&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;武汉&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java代码实现方式</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">termsQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、创建Request对象</span></span><br><span class="line">        SearchRequest request=<span class="keyword">new</span> <span class="title class_">SearchRequest</span>(index);</span><br><span class="line">        request.types(type);</span><br><span class="line">        <span class="comment">//2、封装查询条件</span></span><br><span class="line">        SearchSourceBuilder builder=<span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        builder.query(QueryBuilders.termsQuery(<span class="string">&quot;province&quot;</span>,<span class="string">&quot;北京&quot;</span>,<span class="string">&quot;山西&quot;</span>,<span class="string">&quot;武汉&quot;</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、执行查询</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">search</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、输出_source</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : search.getHits().getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSourceAsMap());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-2-match查询"><a href="#6-2-match查询" class="headerlink" title="6.2 match查询"></a>6.2 match查询</h3><ul>
<li>match查询属于高层查询，他会根据你查询的字段类型不一样，采用不同的查询方式。<ul>
<li>查询的是日期或者是数值的话，它会将你基于的字符串查询内容转换为日期或者数值对待。</li>
<li>如果查询的内容是一个不能被分词的内容（keyword），match查询不会对你指定的查询关键字进行分词。</li>
<li>如果查询的内容是一个可以被分词的内容（text），match会将你指定的查询内容根据一定的方式去分词，去分词库中匹配指定的内容。</li>
</ul>
</li>
<li>match查询，实际底层就是多个term查询，将多个term查询的结果给你封装在一起。</li>
</ul>
<h4 id="6-2-1-match-all查询"><a href="#6-2-1-match-all查询" class="headerlink" title="6.2.1 match_all查询"></a>6.2.1 match_all查询</h4><ul>
<li>查询全部内容，不指定任何查询条件。</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># match_all查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java代码实现</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">matchAllQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、创建Request</span></span><br><span class="line">        SearchRequest request=<span class="keyword">new</span> <span class="title class_">SearchRequest</span>(index);</span><br><span class="line">        request.types(type);</span><br><span class="line">        <span class="comment">//2、指定查询条件</span></span><br><span class="line">        SearchSourceBuilder builder=<span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        builder.query(QueryBuilders.matchAllQuery());</span><br><span class="line">        builder.size(<span class="number">20</span>);   <span class="comment">//ES默认只查询十条数据</span></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、client执行</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">search</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">//4、输出结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : search.getHits().getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSourceAsMap());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(search.getHits().getHits().length);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-2-2-match查询"><a href="#6-2-2-match查询" class="headerlink" title="6.2.2 match查询"></a>6.2.2 match查询</h4><ul>
<li>指定一个Field作为筛选条件</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># match查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;smsContent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;收货安装&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java代码实现</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">matchQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、创建Request</span></span><br><span class="line">        SearchRequest request=<span class="keyword">new</span> <span class="title class_">SearchRequest</span>(index);</span><br><span class="line">        request.types(type);</span><br><span class="line">        <span class="comment">//2、指定查询条件</span></span><br><span class="line">        SearchSourceBuilder builder=<span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        builder.query(QueryBuilders.matchQuery(<span class="string">&quot;smsContent&quot;</span>,<span class="string">&quot;收货安装&quot;</span>));</span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、client执行</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">search</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">//4、输出结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : search.getHits().getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSourceAsMap());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(search.getHits().getHits().length);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-2-3-布尔match查询"><a href="#6-2-3-布尔match查询" class="headerlink" title="6.2.3 布尔match查询"></a>6.2.3 布尔match查询</h4><ul>
<li>基于一个Field匹配的内容，采用and或者or的方式连接。<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 布尔match查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;smsContent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国 健康&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;operator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;and&quot;</span>     # 内容包括中国并包含健康  </span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"># 布尔match查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;smsContent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国 健康&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;operator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;or&quot;</span>  # 内容包括中国或者健康  </span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java实现</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">booleanMatchQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、创建Request</span></span><br><span class="line">        SearchRequest request=<span class="keyword">new</span> <span class="title class_">SearchRequest</span>(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、指定查询条件</span></span><br><span class="line">        SearchSourceBuilder builder=<span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        builder.query(QueryBuilders.matchQuery(<span class="string">&quot;smsContent&quot;</span>,<span class="string">&quot;中国 健康&quot;</span>).operator(Operator.OR)); <span class="comment">//可以选择AND或者OR</span></span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、client执行</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">search</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、输出结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : search.getHits().getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSourceAsMap());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(search.getHits().getHits().length);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-2-4-multi-match查询"><a href="#6-2-4-multi-match查询" class="headerlink" title="6.2.4 multi_match查询"></a>6.2.4 multi_match查询</h4><ul>
<li>match针对一个field做检索，multi_match针对多个field进行检索，多个field对应一个text。</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># multi_match 查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;multi_match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;province&quot;</span><span class="punctuation">,</span><span class="string">&quot;smsContent&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代码实现</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">multiMatchQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、创建Request</span></span><br><span class="line">        SearchRequest request=<span class="keyword">new</span> <span class="title class_">SearchRequest</span>(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、指定查询条件</span></span><br><span class="line">        SearchSourceBuilder builder=<span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        builder.query(QueryBuilders.multiMatchQuery(<span class="string">&quot;北京&quot;</span>,<span class="string">&quot;province&quot;</span>,<span class="string">&quot;smsContent&quot;</span>)); </span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、client执行</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">search</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、输出结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : search.getHits().getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSourceAsMap());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(search.getHits().getHits().length);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-3-其他查询"><a href="#6-3-其他查询" class="headerlink" title="6.3 其他查询"></a>6.3 其他查询</h3><h4 id="6-3-1-id查询"><a href="#6-3-1-id查询" class="headerlink" title="6.3.1 id查询"></a>6.3.1 id查询</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># id 查询</span><br><span class="line">GET /sms-logs-index/sms-logs-type/<span class="number">21</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java代码</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findById</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、创建GetRequest</span></span><br><span class="line">        GetRequest request=<span class="keyword">new</span> <span class="title class_">GetRequest</span>(index,type,<span class="string">&quot;21&quot;</span>);</span><br><span class="line">        <span class="comment">//2、执行查询</span></span><br><span class="line">        <span class="type">GetResponse</span> <span class="variable">documentFields</span> <span class="operator">=</span> client.get(request, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">//3、获取结果</span></span><br><span class="line">        System.out.println(documentFields.getSourceAsMap());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-3-2-ids查询"><a href="#6-3-2-ids查询" class="headerlink" title="6.3.2 ids查询"></a>6.3.2 ids查询</h4><ul>
<li>根据多个id查询，类似MySQL中的where id in (id1,id2,id3…)</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># ids查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;ids&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;values&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;21&quot;</span><span class="punctuation">,</span><span class="string">&quot;22&quot;</span><span class="punctuation">,</span><span class="string">&quot;25&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java代码实现</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findByIds</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、创建SearchRequest</span></span><br><span class="line">        SearchRequest request=<span class="keyword">new</span> <span class="title class_">SearchRequest</span>(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2\指定查询条件</span></span><br><span class="line">        SearchSourceBuilder builder=<span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        builder.query(QueryBuilders.idsQuery().addIds(<span class="string">&quot;21&quot;</span>,<span class="string">&quot;22&quot;</span>,<span class="string">&quot;25&quot;</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//3、执行查询</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">documentFields</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//4、获取结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : documentFields.getHits().getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSourceAsMap());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-3-3-prefix查询"><a href="#6-3-3-prefix查询" class="headerlink" title="6.3.3 prefix查询"></a>6.3.3 prefix查询</h4><ul>
<li>前缀查询，可以通过一个关键字去指定一个Field的前缀，从而查询到指定的文档。</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># prefix 查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;corpName&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;途虎&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java代码实现</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findByPrefix</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、创建SearchRequest</span></span><br><span class="line">        SearchRequest request=<span class="keyword">new</span> <span class="title class_">SearchRequest</span>(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2\指定查询条件</span></span><br><span class="line">        SearchSourceBuilder builder=<span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        builder.query(QueryBuilders.prefixQuery(<span class="string">&quot;corpName&quot;</span>,<span class="string">&quot;途虎&quot;</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、执行查询</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">documentFields</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、获取结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : documentFields.getHits().getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSourceAsMap());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-3-4-fuzzy查询"><a href="#6-3-4-fuzzy查询" class="headerlink" title="6.3.4 fuzzy查询"></a>6.3.4 fuzzy查询</h4><ul>
<li>模糊查询，我们输入字符的大概，ES就可以去根据输入的内容大概去匹配一下结果。</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># fuzzy查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;fuzzy&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;corpName&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;盒马先生&quot;</span></span><br><span class="line">        <span class="punctuation">,</span> <span class="attr">&quot;prefix_length&quot;</span><span class="punctuation">:</span> <span class="number">2</span>	# 指定前面几个字符不错</span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java代码现实</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findByFuzzy</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、创建SearchRequest</span></span><br><span class="line">        SearchRequest request=<span class="keyword">new</span> <span class="title class_">SearchRequest</span>(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2\指定查询条件</span></span><br><span class="line">        SearchSourceBuilder builder=<span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        builder.query(QueryBuilders.fuzzyQuery(<span class="string">&quot;corpName&quot;</span>,<span class="string">&quot;盒马先生&quot;</span>).prefixLength(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、执行查询</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">documentFields</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、获取结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : documentFields.getHits().getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSourceAsMap());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-3-5-wildcard查询"><a href="#6-3-5-wildcard查询" class="headerlink" title="6.3.5 wildcard查询"></a>6.3.5 wildcard查询</h4><ul>
<li>通配查询，和MySQL中的like是一个套路，可以在查询时，在字符串中指定通配符*和占位符?</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># wildcard查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;wildcard&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;corpName&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国??&quot;</span>	# 可以使用*和? 指定通配符合占位符</span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java代码实现</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findByWildcard</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、创建SearchRequest</span></span><br><span class="line">        SearchRequest request=<span class="keyword">new</span> <span class="title class_">SearchRequest</span>(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2\指定查询条件</span></span><br><span class="line">        SearchSourceBuilder builder=<span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        builder.query(QueryBuilders.wildcardQuery(<span class="string">&quot;corpName&quot;</span>,<span class="string">&quot;中国??&quot;</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、执行查询</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">documentFields</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、获取结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : documentFields.getHits().getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSourceAsMap());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-3-6-range查询"><a href="#6-3-6-range查询" class="headerlink" title="6.3.6 range查询"></a>6.3.6 range查询</h4><ul>
<li>范围查询，只针对数值类型，对某一个Field进行大于或者小于的范围指定。</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># range 查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;fee&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;gt&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">20</span></span><br><span class="line">        	# 可以使用	gt ： &gt;，	gte ： &gt;=，	lt：&lt;，	lte <span class="punctuation">:</span> &lt;=</span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java代码实现</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findByRange</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、创建SearchRequest</span></span><br><span class="line">        SearchRequest request=<span class="keyword">new</span> <span class="title class_">SearchRequest</span>(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2\指定查询条件</span></span><br><span class="line">        SearchSourceBuilder builder=<span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        builder.query(QueryBuilders.rangeQuery(<span class="string">&quot;fee&quot;</span>).lt(<span class="number">10</span>).gte(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、执行查询</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">documentFields</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、获取结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : documentFields.getHits().getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSourceAsMap());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-3-7-regexp查询"><a href="#6-3-7-regexp查询" class="headerlink" title="6.3.7 regexp查询"></a>6.3.7 regexp查询</h4><ul>
<li>正则查询，通过你编写的正则表达式去匹配内容</li>
<li>PS：<ul>
<li>prefix，fuzzy，wildcard和repexp查询效率相对比较低，要求效率比较高时，避免使用。<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># regexp查询</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;regexp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;mobile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;180[0-9]&#123;8&#125;&quot;</span>	# 编写正则表达式</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java代码实现</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findByRegexp</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、创建SearchRequest</span></span><br><span class="line">        SearchRequest request=<span class="keyword">new</span> <span class="title class_">SearchRequest</span>(index);</span><br><span class="line">        request.types(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2\指定查询条件</span></span><br><span class="line">        SearchSourceBuilder builder=<span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        builder.query(QueryBuilders.regexpQuery(<span class="string">&quot;mobile&quot;</span>,<span class="string">&quot;139[0-9]&#123;8&#125;&quot;</span>));</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、执行查询</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">documentFields</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、获取结果</span></span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : documentFields.getHits().getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSourceAsMap());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-4-深分页Scroll"><a href="#6-4-深分页Scroll" class="headerlink" title="6.4 深分页Scroll"></a>6.4 深分页Scroll</h3><ul>
<li>ES对from + size是有限制的，from和size二者之和不能超过1W</li>
<li>原理：<ul>
<li>from+size在ES查询数据的方式：<ul>
<li>第一步将用户指定的关键字进行分词</li>
<li>第二步将词汇去分词库中进行检索，得到多个文档的id</li>
<li>第三步去各个分片中拉取指定的数据。耗时较长</li>
<li>第四步将数据根据score进行排序。耗时较长</li>
<li>第五步根据from的值，将查询到的数据舍弃一部分</li>
<li>第六步返回结果</li>
</ul>
</li>
<li>Scroll+size在ES查询数据的方式：<ul>
<li>第一步现将用户指定的关键字分词。</li>
<li>第二步将词汇去分词库中进行索引，得到多个文档的id。</li>
<li>第三步将文档的id存放在一个ES的上下文中。</li>
<li>第四步根据你指定的size的个数去ES中检索指定个数的数据，拿完数据的文档id，会从上下文中移除。</li>
<li>第五步如果需要下一页数据，直接去ES的上下文中，找后续内容。</li>
<li>第六步循环第四步和第五步。</li>
</ul>
</li>
</ul>
</li>
<li>Scroll查询方式，不适合做实时数据的查询。</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># scroll深分页</span><br><span class="line"># 执行scroll查询，返回第一页数据，并且将文档id信息存放在ES上下文中，指定生存时间<span class="number">1</span>m</span><br><span class="line">POST /sms-logs-index/sms-logs-type/_search?scroll=<span class="number">1</span>m</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>	# 排序</span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;fee&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"># 根据scroll查询第下页数据</span><br><span class="line">POST /_search/scroll</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"># 根据第一步得到的scroll_id去指定</span><br><span class="line">  <span class="attr">&quot;scroll_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DnF1ZXJ5VGhlbkZldGNoAwAAAAAAAChEFk14b3lMbG5wUTlLZjktamtrNFJJNncAAAAAAAAoQxZNeG95TGxucFE5S2Y5LWprazRSSTZ3AAAAAAAAKEUWTXhveUxsbnBROUtmOS1qa2s0Ukk2dw==&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scroll&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1m&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"># 删除scrollzai在es上下文zhong中的数据；根据第一步得到的scroll_id去指定</span><br><span class="line">DELETE /_search/scroll/DnF1ZXJ5VGhlbkZldGNoAwAAAAAAAChEFk14b3lMbG5wUTlLZjktamtrNFJJNncAAAAAAAAoQxZNeG95TGxucFE5S2Y5LWprazRSSTZ3AAAAAAAAKEUWTXhveUxsbnBROUtmOS1qa2s0Ukk2dw==</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java代码实现</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ScrollQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1、创建SearchRequest</span></span><br><span class="line">        SearchRequest request=<span class="keyword">new</span> <span class="title class_">SearchRequest</span>(index);</span><br><span class="line">        <span class="comment">//2、指定scroll信息</span></span><br><span class="line">        request.scroll(TimeValue.timeValueMillis(<span class="number">1L</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、指定查询的条件</span></span><br><span class="line">        SearchSourceBuilder builder=<span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        builder.size(<span class="number">4</span>);</span><br><span class="line">        builder.sort(<span class="string">&quot;fee&quot;</span>, SortOrder.DESC);</span><br><span class="line">        builder.query(QueryBuilders.matchAllQuery());</span><br><span class="line"></span><br><span class="line">        request.source(builder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、获取返回结果scrollId，source</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">search</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="type">String</span> <span class="variable">scrollId</span> <span class="operator">=</span> search.getScrollId();</span><br><span class="line">        System.out.println(<span class="string">&quot;---------首页---------&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : search.getHits().getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSourceAsMap());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="comment">//5、循环——创建SearchScrollRequest</span></span><br><span class="line">            SearchScrollRequest scrollRequest=<span class="keyword">new</span> <span class="title class_">SearchScrollRequest</span>(scrollId);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//6、指定scrollId的生存时间</span></span><br><span class="line">            scrollRequest.scroll(TimeValue.timeValueMillis(<span class="number">1L</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//7、执行查询获取返回结果</span></span><br><span class="line">            <span class="type">SearchResponse</span> <span class="variable">scrollResp</span> <span class="operator">=</span> client.scroll(scrollRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//8、判断是否查询到了数据，输出</span></span><br><span class="line">            SearchHit[] hits = scrollResp.getHits().getHits();</span><br><span class="line">            <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> scrollResp.getHits().getHits().length;</span><br><span class="line">            <span class="keyword">if</span> (hits !=<span class="literal">null</span>&amp;&amp; length &gt;<span class="number">0</span>)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;-----下一页-----&quot;</span>);</span><br><span class="line">                <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">                    System.out.println(hit.getSourceAsMap());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//9、判断没有查询到数据，停止——退出循环</span></span><br><span class="line">                System.out.println(<span class="string">&quot;-----结束-----&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//10、创建CLearScrollRequest</span></span><br><span class="line">        ClearScrollRequest clearScrollRequest=<span class="keyword">new</span> <span class="title class_">ClearScrollRequest</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 11、指定ScrollId</span></span><br><span class="line">        clearScrollRequest.addScrollId(scrollId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 12、删除ScrollId</span></span><br><span class="line">        <span class="type">ClearScrollResponse</span> <span class="variable">clearScrollResponse</span> <span class="operator">=</span> client.clearScroll(clearScrollRequest, RequestOptions.DEFAULT);</span><br><span class="line">        System.out.println(<span class="string">&quot;删除scroll = &quot;</span> + clearScrollResponse.isSucceeded());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h1><p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/2021062015175789.png" alt="在这里插入图片描述"></p>
<h2 id="一、SpringBoot介绍"><a href="#一、SpringBoot介绍" class="headerlink" title="一、SpringBoot介绍"></a>一、SpringBoot介绍</h2><h3 id="1-1-引言"><a href="#1-1-引言" class="headerlink" title="1.1 引言"></a>1.1 引言</h3><ul>
<li>为了使用SSM框架去开发，准备SSM框架的模板配置</li>
<li>为了Spring整合第三方框架，单独的去编写xml文件</li>
<li>导致SSM项目后期xm文件特别多，维护xml文件的成本是很高的。</li>
<li>SSM工程部署也是很麻烦，依赖第三方的容器。</li>
<li>SSM开发方式是很笨重。</li>
</ul>
<h3 id="1-2-SpringBoot介绍"><a href="#1-2-SpringBoot介绍" class="headerlink" title="1.2 SpringBoot介绍"></a>1.2 SpringBoot介绍</h3><ul>
<li>SpringBoot是由Pivotal团队研发的，SpringBoot并不是一门新技术，只是将之前常用的Spring，SpringMVC，data-jpa等常用框架封装到了一起，帮助你隐藏这些框架的整合细节，实现敏捷开发。</li>
<li>SpringBoot就是一个工具集。<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210621123832258.png" alt="在这里插入图片描述"></li>
<li>SpringBoot的特点：<ul>
<li>SpringBoot项目不需要模板化的配置。</li>
<li>在SpringBoot中整合第三方框架时，只需要导入相应的starter依赖包，就自动整合了。</li>
<li>SpringBoot默认只有一个.properties的配置文件，不推荐使用xml，后期会采用.java的文件去编写配置信息。</li>
<li>SpringBoot工程在部署时，采用的是jar包的方式，内部自动依赖Tomcat容器，提供了多环境的配置。</li>
<li>后期要学习的微服务框架SpringCloud需要建立在SpringBoot的基础上。</li>
</ul>
</li>
</ul>
<h2 id="二、SpringBoot快速入门"><a href="#二、SpringBoot快速入门" class="headerlink" title="二、SpringBoot快速入门"></a>二、SpringBoot快速入门</h2><h3 id="2-1-快速构建SpringBoot"><a href="#2-1-快速构建SpringBoot" class="headerlink" title="2.1 快速构建SpringBoot"></a>2.1 快速构建SpringBoot</h3><p>1、选择构建项目的类型<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/2021062113062423.png" alt="在这里插入图片描述"></p>
<p>2、项目的描述：<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210621130508422.png" alt="在这里插入图片描述"></p>
<p>3、指定SpringBoot版本和需要的依赖：<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210621130715311.png" alt="在这里插入图片描述"><br>第一次创建SpringBoot工程，下载大量依赖，保证，Maven已经配置了阿里云的私服。<br>4、需改pom.xml文件中的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--将cs项目修改成web项目--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br></pre></td></tr></table></figure>
<p>5、编写了Controller</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class TestController &#123;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/test&quot;)</span><br><span class="line">    public String test()&#123;</span><br><span class="line">        return &quot;Hello SpringBoot!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6、测试访问test方法<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210621131615260.png" alt="在这里插入图片描述"></p>
<h3 id="2-2-SpringBoot的目录结构"><a href="#2-2-SpringBoot的目录结构" class="headerlink" title="2.2 SpringBoot的目录结构"></a>2.2 SpringBoot的目录结构</h3><p><img src="https://img-blog.csdnimg.cn/20210621131728726.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk5OTE4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210621131939716.png" alt="在这里插入图片描述"></p>
<h3 id="2-3-SpringBoot三种启动方式"><a href="#2-3-SpringBoot三种启动方式" class="headerlink" title="2.3 SpringBoot三种启动方式"></a>2.3 SpringBoot三种启动方式</h3><p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210621132245503.png" alt="在这里插入图片描述"></p>
<h2 id="三、SpringBoot常用注解"><a href="#三、SpringBoot常用注解" class="headerlink" title="三、SpringBoot常用注解"></a>三、SpringBoot常用注解</h2><h3 id="3-1-Configuration和-Bean"><a href="#3-1-Configuration和-Bean" class="headerlink" title="3.1 @Configuration和@Bean"></a>3.1 @Configuration和@Bean</h3><ul>
<li>之前使用SSM去开发时，在xml文件中编写bean标签。</li>
<li>但是SpringBoot不推荐使用xml文件</li>
<li>@Configuration注解相当于beans标签</li>
<li>@Bean注解相当于bean标签<ul>
<li>id&#x3D;”方法名|注解中的name属性(优先级更高)”</li>
<li>class&#x3D;”方法的返回结果”</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;user1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>,<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*相当于：</span></span><br><span class="line"><span class="comment">    &lt;beans&gt;</span></span><br><span class="line"><span class="comment">        &lt;bean id=&quot;user1&quot; class=&quot;com.fq.firstspringboot.entity.User&quot;&gt;&lt;/bean&gt;</span></span><br><span class="line"><span class="comment">    &lt;/beans&gt;</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h3><ul>
<li>@SpringBootApplication就是一个组合注解<ul>
<li>1、@SpringBootConfiguration就是@Configuration注解，代表启动类就是一个配置类</li>
<li>2、@EnableAutoConfiguration帮你实现自动装配的，SpringBoot工程启动时，运行一个SpringFactoriesLoader的类，加载META-INF&#x2F;spring.factories配置类（已经开启的类），通过SpringFactoriesLoader中的load方法，以for循环的方式，一个一个加载。<ul>
<li>好处：无需编写大量的整合配置信息，只需要按照SpringBoot提供好了约定去整合即可。</li>
<li>坏处：如果说你导入一个starter依赖，那么你就需要填写他必要的配置信息。</li>
<li>手动关闭自动装配指定内容：@SpringBootApplication(exclude &#x3D; QuartzAutoConfiguration.class)</li>
</ul>
</li>
<li>3、@ComponentScan就相当于&lt;context:component-scan basePackage&#x3D;”包名” &#x2F;&gt;，帮助扫描注解的。</li>
</ul>
</li>
</ul>
<h2 id="四、SpringBoot常用配置"><a href="#四、SpringBoot常用配置" class="headerlink" title="四、SpringBoot常用配置"></a>四、SpringBoot常用配置</h2><h3 id="4-1-SpringBoot的配置文件格式"><a href="#4-1-SpringBoot的配置文件格式" class="headerlink" title="4.1 SpringBoot的配置文件格式"></a>4.1 SpringBoot的配置文件格式</h3><ul>
<li>SpringBoot的配置文件支持properties和yml，甚至它还支持json</li>
<li>更推荐使用yml文件格式：<ul>
<li>1、yml文件，会根据换行和缩进帮助咱们管理配置文件所在位置。</li>
<li>2、yml文件，相比properties更较量</li>
</ul>
</li>
<li>yml文件的劣势：<ul>
<li>1、严格遵循换行和缩进</li>
<li>2、在填写value时，一定要在:后面跟上空格</li>
</ul>
</li>
</ul>
<h3 id="4-2-多环境配置"><a href="#4-2-多环境配置" class="headerlink" title="4.2 多环境配置"></a>4.2 多环境配置</h3><p>注：SpringBoot打包，mvn clean package</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在application.yml文件中添加一个配置项：</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">环境名</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在resource目录下，创建多个application-环境名.yml文件即可。</li>
<li>在部署工程时，通过java -jar jar项目 –spring.profiles.active:环境名</li>
</ul>
<h3 id="4-3-引入外部配置文件信息"><a href="#4-3-引入外部配置文件信息" class="headerlink" title="4.3 引入外部配置文件信息"></a>4.3 引入外部配置文件信息</h3><p>和传统的SSM方式一样，通过@Value的注解取获取properties&#x2F;yml文件中的内容<br>如果在yml文件中需要编写大量的自定义配置，并且具有统一的前缀时，采用如下方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;aliyun&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliyunProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String xxx;</span><br><span class="line">    <span class="keyword">private</span> String yyy;</span><br><span class="line">    <span class="keyword">private</span> String zzz;</span><br><span class="line">    <span class="keyword">private</span> String bbb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># properties/yml文件</span></span><br><span class="line"><span class="attr">aliyun:</span></span><br><span class="line">  <span class="attr">xxx:</span> <span class="string">yyyy</span></span><br><span class="line">  <span class="attr">yyy:</span> <span class="string">xxxx</span></span><br><span class="line">  <span class="attr">zzz:</span> <span class="string">aaaa</span></span><br><span class="line">  <span class="attr">bbb:</span> <span class="string">dddd</span></span><br></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AliyunProperties aliyunProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/aliyun&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AliyunProperties <span class="title function_">aliyun</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> aliyunProperties;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-4-热加载"><a href="#4-4-热加载" class="headerlink" title="4.4 热加载"></a>4.4 热加载</h3><p>1、导入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--热加载--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、修改setting中的配置<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210622133454706.png" alt="在这里插入图片描述"></p>
<p>3、修改内容后，可以通过build重新构建工程<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210622220756130.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210622223829562.png" alt="在这里插入图片描述"></p>
<h2 id="五、SpringBoot整合Mybatis"><a href="#五、SpringBoot整合Mybatis" class="headerlink" title="五、SpringBoot整合Mybatis"></a>五、SpringBoot整合Mybatis</h2><h3 id="5-1-xml方式整合MyBatis"><a href="#5-1-xml方式整合MyBatis" class="headerlink" title="5.1 xml方式整合MyBatis"></a>5.1 xml方式整合MyBatis</h3><ul>
<li>1、导入依赖。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">       <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mysql驱动--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--druid的连接池--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--热加载--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>2、编写配置文件<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210623125025134.png" alt="在这里插入图片描述"></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2.1 准备实体类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Type</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">long</span> id;</span><br><span class="line">  <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> id;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> type;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setType</span><span class="params">(String type)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.type = type;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">long</span> id;</span><br><span class="line">  <span class="keyword">private</span> String typesId;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">long</span> age;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> id;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getTypesId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> typesId;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTypesId</span><span class="params">(String typesId)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.typesId = typesId;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">long</span> age)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.2 准备Mapper接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 在启动类中添加直接，扫描Mapper接口所在的包</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.example.demotest.mapper&quot;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--2.3 准备映射文件--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.demotest.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--List&lt;User&gt; findAll();--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        select *from `user`</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 添加yml文件配置信息</span><br><span class="line"># mybatis配置</span><br><span class="line">mybatis:</span><br><span class="line">  # 扫描映射文件</span><br><span class="line">  mapper-locations: classpath:mapper/*.xml</span><br><span class="line">  # 配置别名扫描的包</span><br><span class="line">  type-aliases-package: com.example.demotest.entity</span><br><span class="line">  configuration:</span><br><span class="line">    # 开启驼峰映射配置</span><br><span class="line">    map-underscore-to-camel-case: true</span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定连接数据库的信息</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/bus</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br></pre></td></tr></table></figure>

<ul>
<li>3、测试<br>在Mapper接口的位置，直接右键——&gt;goto——&gt;Test<br>会自动创建当前接口的测试类，在test目录下。<br>让当前测试类，继承DemotestApplicationTests（记得在父类前指定public）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserMapperTest</span> <span class="keyword">extends</span> <span class="title class_">DemotestApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;User&gt; users = userMapper.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-2-注解方式整合MyBatis"><a href="#5-2-注解方式整合MyBatis" class="headerlink" title="5.2 注解方式整合MyBatis"></a>5.2 注解方式整合MyBatis</h3><ul>
<li>1、创建Mapper接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GoodsMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    List&lt;Goods&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    Goods <span class="title function_">findOneById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>2、添加MyBatis的注解<br>针对增删改查：@Insert，@Delete,@Update，@Select<br>还是需要在启动类中添加@MapperScan注解</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GoodsMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select *from goods&quot;)</span></span><br><span class="line">    List&lt;Goods&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="meta">@Select(&quot;select *from goods where goodId=#&#123;id&#125;&quot;)</span></span><br><span class="line">    Goods <span class="title function_">findOneById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>3、测试，看到执行的sql语句</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.example.demotest.mapper:</span> <span class="string">debug</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GoodsMapperTest</span> <span class="keyword">extends</span> <span class="title class_">DemotestApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GoodsMapper goodsMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Goods&gt; all = goodsMapper.findAll();</span><br><span class="line">        <span class="keyword">for</span> (Goods goods : all) &#123;</span><br><span class="line">            System.out.println(goods);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">findOneById</span><span class="params">()</span> &#123;</span><br><span class="line">        goodsMapper.findOneById(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-SpringBoot整合分页助手"><a href="#5-3-SpringBoot整合分页助手" class="headerlink" title="5.3 SpringBoot整合分页助手"></a>5.3 SpringBoot整合分页助手</h3><ul>
<li>1、导入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--PageHelper依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>2、测试使用</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title function_">findByPage</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1、执行分页</span></span><br><span class="line">    PageHelper.startPage(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、执行查询</span></span><br><span class="line">    List&lt;User&gt; all = userMapper.findAll();</span><br><span class="line">    <span class="comment">//3、封装PageInfo对象</span></span><br><span class="line">    PageInfo&lt;User&gt; pageInfo=<span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(all);</span><br><span class="line">    <span class="comment">//4、输出</span></span><br><span class="line">    <span class="keyword">for</span> (User user : pageInfo.getList()) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六、SpringBoot整合JSP"><a href="#六、SpringBoot整合JSP" class="headerlink" title="六、SpringBoot整合JSP"></a>六、SpringBoot整合JSP</h2><ul>
<li>1、需要导入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--JSP核心引擎依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-jasper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--JSTL--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>2、创建webapp以及WEB-INF去存放JSP页面<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210624223206848.png" alt="在这里插入图片描述"></p>
</li>
<li><p>3、创建Controller·并指定view的前缀后后缀</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JspController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/index&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(Model model)</span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;战三&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="comment"># 视图的前缀和后缀</span></span><br><span class="line">    <span class="attr">view:</span></span><br><span class="line">      <span class="attr">prefix:</span> <span class="string">/WEB-INF/</span></span><br><span class="line">      <span class="attr">suffix:</span> <span class="string">.jsp</span></span><br></pre></td></tr></table></figure>
<h2 id="七、SpringBoot"><a href="#七、SpringBoot" class="headerlink" title="七、SpringBoot"></a>七、SpringBoot</h2><p><img src="https://img-blog.csdnimg.cn/20210624223704587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk5OTE4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ul>
<li><p>1、构建客户模块和搜索模块的SpringBoot工程</p>
</li>
<li><p>2、准备客户模块的静态资源（页面，实体类、数据库）</p>
</li>
<li><p>3、准备搜索模块的资源（ES中创建客户模块的索引）</p>
<ul>
<li>导入ES的依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ES--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>编写连接ES的config配置类<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.openapi.search.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClientBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticSearchConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;elasticsearch.host&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;elasticsearch.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestHighLevelClient <span class="title function_">client</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//创建HttpHost</span></span><br><span class="line">        <span class="type">HttpHost</span> <span class="variable">httpHost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHost</span>(host,port);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建RestClientBuilder</span></span><br><span class="line">        <span class="type">RestClientBuilder</span> <span class="variable">clientBuilder</span> <span class="operator">=</span> RestClient.builder(httpHost);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建RestHighLevelClient</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(clientBuilder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回</span></span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>导入实体类<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.openapi.search.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Customer</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1586034423739L</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 主键</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * isNullAble:0</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 公司名</span></span><br><span class="line"><span class="comment">    * isNullAble:1</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * isNullAble:1</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * isNullAble:1</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 金钱</span></span><br><span class="line"><span class="comment">    * isNullAble:1</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> Long money;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 地址</span></span><br><span class="line"><span class="comment">    * isNullAble:1</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 状态</span></span><br><span class="line"><span class="comment">    * isNullAble:1</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> Integer state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>运行测试文件<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.openapi.search;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.qf.openapi.search.entity.Customer;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.create.CreateIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.create.CreateIndexResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.settings.Settings;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentType;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.json.JsonXContent;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ElasticInitTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">index</span> <span class="operator">=</span> <span class="string">&quot;openapi_customer&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;customer&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1. 准备关于索引的settings</span></span><br><span class="line">        Settings.<span class="type">Builder</span> <span class="variable">settings</span> <span class="operator">=</span> Settings.builder()</span><br><span class="line">                .put(<span class="string">&quot;number_of_shards&quot;</span>, <span class="number">5</span>)</span><br><span class="line">                .put(<span class="string">&quot;number_of_replicas&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 准备关于索引的结构mappings</span></span><br><span class="line">        <span class="type">XContentBuilder</span> <span class="variable">mappings</span> <span class="operator">=</span> JsonXContent.contentBuilder()</span><br><span class="line">                .startObject()</span><br><span class="line">                .startObject(<span class="string">&quot;properties&quot;</span>)</span><br><span class="line">                .startObject(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;integer&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;keyword&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;keyword&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;nickname&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;text&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;money&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;long&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;address&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;text&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;state&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;integer&quot;</span>)</span><br><span class="line">                .endObject()</span><br><span class="line">                .endObject()</span><br><span class="line">                .endObject();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 将settings和mappings封装到一个Request对象</span></span><br><span class="line">        <span class="type">CreateIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateIndexRequest</span>(index)</span><br><span class="line">                .settings(settings)</span><br><span class="line">                .mapping(type,mappings);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 通过client对象去连接ES并执行创建索引</span></span><br><span class="line">        <span class="type">CreateIndexResponse</span> <span class="variable">resp</span> <span class="operator">=</span> client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 输出</span></span><br><span class="line">        System.out.println(<span class="string">&quot;resp:&quot;</span> + resp.toString());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bulkCreateDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1. 准备多个json数据</span></span><br><span class="line">        <span class="type">Customer</span> <span class="variable">c1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Customer</span>();</span><br><span class="line">        c1.setId(<span class="number">1</span>);</span><br><span class="line">        c1.setUsername(<span class="string">&quot;haier&quot;</span>);</span><br><span class="line">        c1.setPassword(<span class="string">&quot;111111&quot;</span>);</span><br><span class="line">        c1.setNickname(<span class="string">&quot;海尔集团&quot;</span>);</span><br><span class="line">        c1.setMoney(<span class="number">2000000L</span>);</span><br><span class="line">        c1.setAddress(<span class="string">&quot;青岛&quot;</span>);</span><br><span class="line">        c1.setState(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Customer</span> <span class="variable">c2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Customer</span>();</span><br><span class="line">        c2.setId(<span class="number">2</span>);</span><br><span class="line">        c2.setUsername(<span class="string">&quot;lianxiang&quot;</span>);</span><br><span class="line">        c2.setPassword(<span class="string">&quot;111111&quot;</span>);</span><br><span class="line">        c2.setNickname(<span class="string">&quot;联想&quot;</span>);</span><br><span class="line">        c2.setMoney(<span class="number">1000000L</span>);</span><br><span class="line">        c2.setAddress(<span class="string">&quot;联想&quot;</span>);</span><br><span class="line">        c2.setState(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Customer</span> <span class="variable">c3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Customer</span>();</span><br><span class="line">        c3.setId(<span class="number">3</span>);</span><br><span class="line">        c3.setUsername(<span class="string">&quot;google&quot;</span>);</span><br><span class="line">        c3.setPassword(<span class="string">&quot;111111&quot;</span>);</span><br><span class="line">        c3.setNickname(<span class="string">&quot;谷歌&quot;</span>);</span><br><span class="line">        c3.setMoney(<span class="number">1092L</span>);</span><br><span class="line">        c3.setAddress(<span class="string">&quot;没过&quot;</span>);</span><br><span class="line">        c3.setState(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">json1</span> <span class="operator">=</span> mapper.writeValueAsString(c1);</span><br><span class="line">        <span class="type">String</span> <span class="variable">json2</span> <span class="operator">=</span> mapper.writeValueAsString(c2);</span><br><span class="line">        <span class="type">String</span> <span class="variable">json3</span> <span class="operator">=</span> mapper.writeValueAsString(c3);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 创建Request，将准备好的数据封装进去</span></span><br><span class="line">        <span class="type">BulkRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line">        request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(index,type,c1.getId().toString()).source(json1, XContentType.JSON));</span><br><span class="line">        request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(index,type,c2.getId().toString()).source(json2,XContentType.JSON));</span><br><span class="line">        request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(index,type,c3.getId().toString()).source(json3,XContentType.JSON));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 用client执行</span></span><br><span class="line">        <span class="type">BulkResponse</span> <span class="variable">resp</span> <span class="operator">=</span> client.bulk(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 输出结果</span></span><br><span class="line">        System.out.println(resp.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>4、将客户模块运行起来（配置数据库连接信息和MyBatis的配置）<br><code>配置文件</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># tomcat信息</span><br><span class="line">server:</span><br><span class="line">  port: 80</span><br><span class="line"></span><br><span class="line"># 连接数据库信息</span><br><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    url: jdbc:mysql:///openapi-admin?serverTimezone=UTC</span><br><span class="line">    username: root</span><br><span class="line">    password: 123456</span><br><span class="line">    type: com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"></span><br><span class="line"># MyBatis的配置</span><br><span class="line">mybatis:</span><br><span class="line">  mapper-locations: classpath:mapper/*.xml</span><br><span class="line">  type-aliases-package: com.qf.openapi.customer.entity</span><br><span class="line">  configuration:</span><br><span class="line">    use-actual-param-name: true</span><br></pre></td></tr></table></figure>
<p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210625000113277.png" alt="在这里插入图片描述"></p>
</li>
</ul>
<h1 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h1><p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210609233039453.png" alt="在这里插入图片描述"></p>
<h2 id="一、RabbitMQ介绍"><a href="#一、RabbitMQ介绍" class="headerlink" title="一、RabbitMQ介绍"></a>一、RabbitMQ介绍</h2><h3 id="1-1引言-2"><a href="#1-1引言-2" class="headerlink" title="1.1引言"></a>1.1引言</h3><ul>
<li>1、模块之间的耦合度多高，导致一个模块宕机后，全部功能都不能用了。</li>
<li>2、同步通讯的成本问题<br><img src="https://img-blog.csdnimg.cn/20210609233716843.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk5OTE4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<h3 id="1-2RabbitMQ的介绍"><a href="#1-2RabbitMQ的介绍" class="headerlink" title="1.2RabbitMQ的介绍"></a>1.2RabbitMQ的介绍</h3><ul>
<li>市面上比较火爆的几款MQ：</li>
<li>ActiveMQ、RocketMQ、Kafka、RabbitMQ<br>1、语言的支持：ActiveMQ、RocketMQ、只支持Java语言，Kafla可以支持多语言，<br>2、效率方面：ActiveMQ、RocketMQ，Kafka效率都是毫秒级别，RabbitMQ是微妙级别的。<br>3、消息丢失，消息重复问题：RabbitMQ针对消息的持久化，和重复问题都有比较成熟的解决方案。<br>4、学习成本：RabbitMQ非常简单。<br>RabbitMQ是由RabbitMQ公司去研发和维护的，最终是在Pivotal。<br>RabbitMQ严格的遵循<strong>AMQP</strong>协议，高级消息队列协议，帮助我们在进程之间传递异步消息。</li>
</ul>
<h2 id="二、-RabbitMQ的安装"><a href="#二、-RabbitMQ的安装" class="headerlink" title="二、 RabbitMQ的安装"></a>二、 RabbitMQ的安装</h2><p>RabbitMQ的版本就好使用带management的，后面可能要使用它的图形化工具</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.1&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/rabbitmq:management</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rabbitmq</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">5672</span><span class="string">:5672</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">15672</span><span class="string">:15672</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/:/var/lib/rabbitmq</span></span><br></pre></td></tr></table></figure>
<p>测试：<br>默认账号、密码：guest<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210613143316122.png" alt="在这里插入图片描述"></p>
<h2 id="三、RabbitMQ的架构"><a href="#三、RabbitMQ的架构" class="headerlink" title="三、RabbitMQ的架构"></a>三、RabbitMQ的架构</h2><ul>
<li>1、Publisher  —— 生产者：发布消息到RabbitMQ中的Exchange</li>
<li>2、Consumer——消费者：监听RabbitMQ中的Queue中的消息</li>
<li>3、Exchange——交换机：和生产者建立连接并接收生产者的消息</li>
<li>4、Queue——队列：Exchange会将消息分布到指定的Queue，Queue和消费者进行交互</li>
<li>5、Routes——路由：交换机以什么样的策略将消息发布到Queue<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210613150102718.png" alt="在这里插入图片描述"></li>
</ul>
<h3 id="3-1-RabbitMQ的完整架构图"><a href="#3-1-RabbitMQ的完整架构图" class="headerlink" title="3.1  RabbitMQ的完整架构图"></a>3.1  RabbitMQ的完整架构图</h3><p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210613163737642.png" alt="在这里插入图片描述"></p>
<h3 id="3-2-查看图形化界面并创建一个Virtual-Host"><a href="#3-2-查看图形化界面并创建一个Virtual-Host" class="headerlink" title="3.2 查看图形化界面并创建一个Virtual Host"></a>3.2 查看图形化界面并创建一个Virtual Host</h3><ul>
<li>创建一个全新的用户和全新的Virtual Host，并且将test用户设置上可以操作&#x2F;test的权限<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210613164544116.png" alt="在这里插入图片描述"></li>
</ul>
<h2 id="四、RabbitMQ的使用"><a href="#四、RabbitMQ的使用" class="headerlink" title="四、RabbitMQ的使用"></a>四、RabbitMQ的使用</h2><h3 id="4-1-RabbitMQ的通信方式"><a href="#4-1-RabbitMQ的通信方式" class="headerlink" title="4.1 RabbitMQ的通信方式"></a>4.1 RabbitMQ的通信方式</h3><p><img src="https://img-blog.csdnimg.cn/2021061316510326.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk5OTE4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210613165213487.png" alt="在这里插入图片描述"></p>
<h3 id="4-2-Java连接RabbitMQ"><a href="#4-2-Java连接RabbitMQ" class="headerlink" title="4.2 Java连接RabbitMQ"></a>4.2 Java连接RabbitMQ</h3><p>1、创建Maven项目<br>2、导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.rabbitmq/amqp-client --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>Test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、创建工具类连接RabbitMQ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitMQClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//创建Connection工厂</span></span><br><span class="line">        ConnectionFactory factory=<span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        factory.setHost(<span class="string">&quot;192.168.1.191&quot;</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        factory.setVirtualHost(<span class="string">&quot;/test&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建Connection</span></span><br><span class="line">        Connection conn= <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = factory.newConnection();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (TimeoutException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回</span></span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> RabbitMQClient.getConnection();</span><br><span class="line"></span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210613171551641.png" alt="在这里插入图片描述"></p>
<h3 id="4-3-Hello-World"><a href="#4-3-Hello-World" class="headerlink" title="4.3 Hello World"></a>4.3 Hello World</h3><ul>
<li>一个生产者，一个默认的交换机，一个队列，一个消费者<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210613171940256.png" alt="在这里插入图片描述"><br>1、创建生产者，创建一个channel，发布消息到exchange，指定路由规则。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pubisher</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">publish</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1、获取Connection</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> RabbitMQClient.getConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、创建Channel</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、发布消息到exchange，同时指定路由的规则</span></span><br><span class="line">        String msg=<span class="string">&quot;Hello-World&quot;</span>;</span><br><span class="line">        <span class="comment">//参数1：指定exchange，使用&quot;&quot;</span></span><br><span class="line">        <span class="comment">//参数2：指定路由的规则，使用具体的队列名称</span></span><br><span class="line">        <span class="comment">//参数3：指定传递的消息所携带的properties</span></span><br><span class="line">        <span class="comment">//参数4：指定发布的具体消息，byte[]类型</span></span><br><span class="line">        channel.basicPublish(<span class="string">&quot;&quot;</span>,<span class="string">&quot;Helloworld&quot;</span>,<span class="literal">null</span>,msg.getBytes());</span><br><span class="line">        <span class="comment">//Ps:exchange是不会将消息持久化到本地的，Queue才会帮你持久化消息。</span></span><br><span class="line">        System.out.println(<span class="string">&quot;生产者发布消息成功！&quot;</span>);</span><br><span class="line">        <span class="comment">//4、释放资源</span></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、创建消费者，创建一个channel，创建一个队列，并且去消费当前队列</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consumer</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1、获取连接对象</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> RabbitMQClient.getConnection();</span><br><span class="line">        <span class="comment">//2、创建channel</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">//3、声明队列——HelloWorld</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * 参数1：queue：指定队列名称</span></span><br><span class="line"><span class="comment">        * 参数2：durable：当前队列是否需要持久化（true）</span></span><br><span class="line"><span class="comment">        * 参数3：exclusive：是否排外（conn。close() —— 当前队列会被自动删除，当前队列只能被一个消费者消费）</span></span><br><span class="line"><span class="comment">        * 参数4：autoDelete：如果这个队列没有消费者在消费，队列自动删除</span></span><br><span class="line"><span class="comment">        * 参数5：arguments：指定当前队列的其他信息</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        channel.queueDeclare(<span class="string">&quot;Helloworld&quot;</span>,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、开启监听Queue</span></span><br><span class="line">        DefaultConsumer consumer=<span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;接收到消息：&quot;</span>+<span class="keyword">new</span> <span class="title class_">String</span>(body,<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 参数1：queue：指定消费那个队列</span></span><br><span class="line"><span class="comment">         * 参数2：deliverCallback：指定是否自动ACK（true，接收到消息后，会立即告诉RabbitMQ）</span></span><br><span class="line"><span class="comment">         * 参数3：CancelCallback：指定消费回调</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        channel.basicConsume(<span class="string">&quot;Helloworld&quot;</span>,<span class="literal">true</span>,consumer);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;消费者开始监听队列&quot;</span>);</span><br><span class="line">        <span class="comment">//System.in.read;</span></span><br><span class="line">        System.in.read();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5、释放资源</span></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-4-Work"><a href="#4-4-Work" class="headerlink" title="4.4 Work"></a>4.4 Work</h3><ul>
<li>一个生产者，一个默认的交换机，一个队列，两个消费者</li>
</ul>
<p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210613180414965.png" alt="在这里插入图片描述"><br>只需要在消费者端，添加Qos能力以及更改为手动ack即可让消费者，根据自己的能力消费指定的消息，而不是默认情况由RabbitMQ平均分配了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、 指定当前消费者，一次消费多少消息</span></span><br><span class="line">channel.basicQos(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2、开启监听Queue</span></span><br><span class="line">DefaultConsumer consumer=<span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel)&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">200</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者2号接收到消息：&quot;</span>+<span class="keyword">new</span> <span class="title class_">String</span>(body,<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        <span class="comment">//手动ACK</span></span><br><span class="line">        channel.basicAck(envelope.getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//3、手动指定ack</span></span><br><span class="line">channel.basicConsume(<span class="string">&quot;Work&quot;</span>,<span class="literal">false</span>,consumer);</span><br></pre></td></tr></table></figure>
<h3 id="4-5-Publish-Subscribe"><a href="#4-5-Publish-Subscribe" class="headerlink" title="4.5 Publish&#x2F;Subscribe"></a>4.5 Publish&#x2F;Subscribe</h3><ul>
<li>一个生产者，一个交换机，两个队列，两个消费者<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210613194338149.png" alt="在这里插入图片描述"><br>声明一个Fanout类型的exchange，并且将exchange和queue绑定在一起，绑定的方式就是直接绑定。<br>1、让生产者创建一个exchange并且指定类型，和一个或多个队列绑定到一起。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3、创建exchange - 绑定某一个队列</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 参数1：exchange的名称</span></span><br><span class="line"><span class="comment">* 参数2：指定exchange的类型    FANOUT-pubsub , DIRECT - Routing , TOPIC- Topics</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">&quot;pubsub-exchange&quot;</span>, BuiltinExchangeType.FANOUT);</span><br><span class="line">channel.queueBind(<span class="string">&quot;pubsub-queue1&quot;</span>,<span class="string">&quot;pubsub-exchange&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">channel.queueBind(<span class="string">&quot;pubsub-queue2&quot;</span>,<span class="string">&quot;pubsub-exchange&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4、发布消息到exchange，同时指定路由的规则</span></span><br><span class="line">String msg=<span class="string">&quot;Hello-World&quot;</span>;</span><br><span class="line"><span class="comment">//参数1：指定exchange，使用&quot;&quot;</span></span><br><span class="line"><span class="comment">//参数2：指定路由的规则，使用具体的队列名称</span></span><br><span class="line"><span class="comment">//参数3：指定传递的消息所携带的properties</span></span><br><span class="line"><span class="comment">//参数4：指定发布的具体消息，byte[]类型</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    msg = <span class="string">&quot;Hello-World&quot;</span> + i;</span><br><span class="line">    channel.basicPublish(<span class="string">&quot;pubsub-exchange&quot;</span>,<span class="string">&quot;Work&quot;</span>,<span class="literal">null</span>,msg.getBytes());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、消费者还是正常的监听某一个队列即可。</p>
<h3 id="4-6-Routing"><a href="#4-6-Routing" class="headerlink" title="4.6 Routing"></a>4.6 Routing</h3><ul>
<li>一个生产者，一个交换机，两个队列，两个消费者</li>
</ul>
<p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210613202837889.png" alt="在这里插入图片描述"><br>创建一个DIRECT类型的exchange，并且去根据RoutingKey 去绑定指定的队列。</p>
<ul>
<li>1、生产者在创建DIRECT类型的exchange后，去绑定响应的队列，并且在发送信息时，指定消息的具体RoutingKey即可。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3、创建exchange - 绑定某一个队列</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">&quot;routing-exchange&quot;</span>, BuiltinExchangeType.DIRECT);</span><br><span class="line">channel.queueBind(<span class="string">&quot;routing-queue-error&quot;</span>,<span class="string">&quot;routing-exchange&quot;</span>,<span class="string">&quot;ERROR&quot;</span>);</span><br><span class="line">channel.queueBind(<span class="string">&quot;routing-queue-info&quot;</span>,<span class="string">&quot;routing-exchange&quot;</span>,<span class="string">&quot;INFO&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4、发布消息到exchange，同时指定路由的规则</span></span><br><span class="line">channel.basicPublish(<span class="string">&quot;routing-exchange&quot;</span>,<span class="string">&quot;ERROR&quot;</span>,<span class="literal">null</span>,<span class="string">&quot;ERROR&quot;</span>.getBytes());</span><br><span class="line">channel.basicPublish(<span class="string">&quot;routing-exchange&quot;</span>,<span class="string">&quot;INFO&quot;</span>,<span class="literal">null</span>,<span class="string">&quot;INFO1&quot;</span>.getBytes());</span><br><span class="line">channel.basicPublish(<span class="string">&quot;routing-exchange&quot;</span>,<span class="string">&quot;INFO&quot;</span>,<span class="literal">null</span>,<span class="string">&quot;INFO2&quot;</span>.getBytes());</span><br><span class="line">channel.basicPublish(<span class="string">&quot;routing-exchange&quot;</span>,<span class="string">&quot;INFO&quot;</span>,<span class="literal">null</span>,<span class="string">&quot;INFO3&quot;</span>.getBytes());</span><br></pre></td></tr></table></figure>
<ul>
<li>2、消费者基本没有变化</li>
</ul>
<h3 id="4-7-Topic"><a href="#4-7-Topic" class="headerlink" title="4.7 Topic"></a>4.7 Topic</h3><ul>
<li>一个生产者，一个交换机，两个队列，两个消费者<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210613235038499.png" alt="在这里插入图片描述"></li>
<li>1、生产者创建Topic的exchange并且绑定到队列中，这次绑定可以通过*和#关键字，对指定RoutKey内容，编写时注意格式XXX.XXX.XXX去编写， * ——》一个XXX， 而#——》表示多个XXX.XXX，在发送消息时，指定具体的RoutingKey到底是什么。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3、创建exchange - 绑定某一个队列 topic-queue-1  topic-queue-2</span></span><br><span class="line"><span class="comment">//动物的信息 &lt;speed&gt; &lt;color&gt; &lt;what&gt;</span></span><br><span class="line"><span class="comment">//*.red.*       -&gt;*占位符</span></span><br><span class="line"><span class="comment">//fast.#        -&gt;#通配符</span></span><br><span class="line"><span class="comment">//*.*.rabbit</span></span><br><span class="line">channel.exchangeDeclare(<span class="string">&quot;topic-exchange&quot;</span>, BuiltinExchangeType.TOPIC);</span><br><span class="line">channel.queueBind(<span class="string">&quot;topic-queue-1&quot;</span>,<span class="string">&quot;topic-exchange&quot;</span>,<span class="string">&quot;*.red.*&quot;</span>);</span><br><span class="line">channel.queueBind(<span class="string">&quot;topic-queue-2&quot;</span>,<span class="string">&quot;topic-exchange&quot;</span>,<span class="string">&quot;fast.#&quot;</span>);</span><br><span class="line">channel.queueBind(<span class="string">&quot;topic-queue-2&quot;</span>,<span class="string">&quot;topic-exchange&quot;</span>,<span class="string">&quot;*.*.rabbit&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4、发布消息到exchange，同时指定路由的规则</span></span><br><span class="line">channel.basicPublish(<span class="string">&quot;topic-exchange&quot;</span>,<span class="string">&quot;fast.red.monkey&quot;</span>,<span class="literal">null</span>,<span class="string">&quot;红快猴子&quot;</span>.getBytes());</span><br><span class="line">channel.basicPublish(<span class="string">&quot;topic-exchange&quot;</span>,<span class="string">&quot;slow.block.dog&quot;</span>,<span class="literal">null</span>,<span class="string">&quot;黑慢狗&quot;</span>.getBytes());</span><br><span class="line">channel.basicPublish(<span class="string">&quot;topic-exchange&quot;</span>,<span class="string">&quot;fast.white.cat&quot;</span>,<span class="literal">null</span>,<span class="string">&quot;快白猫&quot;</span>.getBytes());</span><br></pre></td></tr></table></figure>
<ul>
<li>2、消费者基本没有变化</li>
</ul>
<h2 id="五、整合SpringBoot"><a href="#五、整合SpringBoot" class="headerlink" title="五、整合SpringBoot"></a>五、整合SpringBoot</h2><h3 id="5-1-SpringBoot整合RabbitMQ"><a href="#5-1-SpringBoot整合RabbitMQ" class="headerlink" title="5.1 SpringBoot整合RabbitMQ"></a>5.1 SpringBoot整合RabbitMQ</h3><p>1、创建SpringBoot工程<br>2、导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--rabbitmq--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、编写配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.191</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">test</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">test</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/test</span></span><br></pre></td></tr></table></figure>
<p>4、编写配置类，声明exchange和queue，并且绑定到一起</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitMQConfig</span> &#123;</span><br><span class="line">    <span class="comment">//1、创建exchange - topic</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TopicExchange <span class="title function_">getTopicExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TopicExchange</span>(<span class="string">&quot;boot-topic-exchange&quot;</span>,<span class="literal">true</span>,<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、创建queue</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">getQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;boot-queue&quot;</span>,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3、绑定在一起</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">getBinding</span><span class="params">(TopicExchange topicExchange,Queue queue)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(topicExchange).with(<span class="string">&quot;*.red.*&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5、发布消息到RabbitMQ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;boot-topic-exchange&quot;</span>,<span class="string">&quot;solw.red.dog&quot;</span>,<span class="string">&quot;红色的大狼狗！！！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6、创建消费者监听消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;boot-queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMessage</span><span class="params">(Object message)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;接收到消息：&quot;</span>+message);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-2-手动Ack"><a href="#5-2-手动Ack" class="headerlink" title="5.2 手动Ack"></a>5.2 手动Ack</h3><p>1、添加配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">acknowledge-mode:</span> <span class="string">manual</span></span><br></pre></td></tr></table></figure>

<p>2、在消费信息的位置，修改方法，再手动ack</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;boot-queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMessage</span><span class="params">(String msg, Channel channel, Message message)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;接收到消息：&quot;</span>+msg);</span><br><span class="line">    <span class="comment">//手动Ack</span></span><br><span class="line">    channel.basicAck(message.getMessageProperties().getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六、RabbitMQ的其他操作"><a href="#六、RabbitMQ的其他操作" class="headerlink" title="六、RabbitMQ的其他操作"></a>六、RabbitMQ的其他操作</h2><h3 id="6-1-消息的可靠性"><a href="#6-1-消息的可靠性" class="headerlink" title="6.1 消息的可靠性"></a>6.1 消息的可靠性</h3><ul>
<li>RabbitMQ的事务：事务可以保证消息100%传递，可以通过事务的回滚记录日志，后面定时再次发送当前消息。事务的操作，效率太低，加了事务后，他比平时操作的效率要慢100倍。</li>
</ul>
<h4 id="6-1-1-Confirm机制"><a href="#6-1-1-Confirm机制" class="headerlink" title="6.1.1 Confirm机制"></a>6.1.1 Confirm机制</h4><ul>
<li><p>RabbitMQ除了事务，还提供了Confirm的确认机制，这个效率比事务高很多。</p>
<ul>
<li>1、普通Confirm方式<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.1开启Confirm</span></span><br><span class="line">channel.confirmSelect();</span><br><span class="line"><span class="comment">//发送消息</span></span><br><span class="line"><span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;Hello-World&quot;</span> ;</span><br><span class="line">channel.basicPublish(<span class="string">&quot;&quot;</span>,<span class="string">&quot;HelloWorld&quot;</span>,<span class="literal">null</span>,msg.getBytes());</span><br><span class="line"><span class="comment">//判断消息是否发送成功</span></span><br><span class="line"><span class="keyword">if</span> (channel.waitForConfirms()) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消息发送成功&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消息发送失败&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>2、批量Confirm方式。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.1开启Confirm</span></span><br><span class="line">channel.confirmSelect();</span><br><span class="line"><span class="comment">//发送消息</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;Hello-World&quot;</span> +i;</span><br><span class="line">    channel.basicPublish(<span class="string">&quot;&quot;</span>,<span class="string">&quot;HelloWorld&quot;</span>,<span class="literal">null</span>,msg.getBytes());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//确定批量操作是否成功</span></span><br><span class="line">channel.waitForConfirmsOrDie();     <span class="comment">//当你发送的全部消息 ，有一个失败的时候，就直接全部失败，抛出异常</span></span><br></pre></td></tr></table></figure></li>
<li>3、异步Confirm方式。（推荐和常用的一种）<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.1开启Confirm</span></span><br><span class="line">        channel.confirmSelect();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;Hello-World&quot;</span> +i;</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>,<span class="string">&quot;HelloWorld&quot;</span>,<span class="literal">null</span>,msg.getBytes());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        channel.addConfirmListener(<span class="keyword">new</span> <span class="title class_">ConfirmListener</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleAck</span><span class="params">(<span class="type">long</span> l, <span class="type">boolean</span> b)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;消息发送成功，标识：&quot;</span>+l+<span class="string">&quot;，是否是批量：&quot;</span>+b);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleNack</span><span class="params">(<span class="type">long</span> l, <span class="type">boolean</span> b)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;消息发送失败，标识：&quot;</span>+l+<span class="string">&quot;，是否是批量：&quot;</span>+b);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><img src="https://img-blog.csdnimg.cn/20210614132040430.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk5OTE4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
</ul>
<h4 id="6-1-2-Return机制"><a href="#6-1-2-Return机制" class="headerlink" title="6.1.2 Return机制"></a>6.1.2 Return机制</h4><ul>
<li>Confirm只能保证消息到达exchange，无法保证消息可以被exchange分发到指定queue。</li>
<li>而且exchange是不能持久化消息的，queue是可以持久化消息。</li>
<li>采用Return机制来监听消息是否从exchange送到了指定的queue中</li>
</ul>
<p>	</p>
<p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210614135137755.png" alt="在这里插入图片描述"><br>1、开启Return机制</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">        <span class="comment">//开启return机制</span></span><br><span class="line">        channel.addReturnListener(<span class="keyword">new</span> <span class="title class_">ReturnListener</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleReturn</span><span class="params">(<span class="type">int</span> i, String s, String s1, String s2, AMQP.BasicProperties basicProperties, <span class="type">byte</span>[] bytes)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="comment">//当消息没有传递到queue时，才会执行。</span></span><br><span class="line">                System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes,<span class="string">&quot;UTF-8&quot;</span>)+<span class="string">&quot;没有传达到Queue中&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"><span class="comment">//再送发消息时，指定mandatory参数为true</span></span><br><span class="line">channel.basicPublish(<span class="string">&quot;&quot;</span>,<span class="string">&quot;HelloWorld&quot;</span>,<span class="literal">true</span>,<span class="literal">null</span>,msg.getBytes());</span><br></pre></td></tr></table></figure>
<h4 id="6-1-3-SpringBoot实现Confirm以及Return"><a href="#6-1-3-SpringBoot实现Confirm以及Return" class="headerlink" title="6.1.3 SpringBoot实现Confirm以及Return"></a>6.1.3 SpringBoot实现Confirm以及Return</h4><p>1、编写配置文件，开启Confirm以及Return机制</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">publisher-confirm-type:</span> <span class="string">simple</span></span><br><span class="line">    <span class="attr">publisher-returns:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>2、指定RabbitTemplate对象，开启Confirm和Return，并且编写了回调方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PublisherConfirmAndReturnConfig</span> <span class="keyword">implements</span> <span class="title class_">RabbitTemplate</span>.ConfirmCallback,RabbitTemplate.ReturnCallback &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span>  <span class="comment">//ini-method</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">iniMethod</span><span class="params">()</span>&#123;</span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="built_in">this</span>);</span><br><span class="line">        rabbitTemplate.setReturnCallback(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(CorrelationData correlationData, <span class="type">boolean</span> b, String s)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (b)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;消息已经送达到了ack&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;消息没有送达Exchange&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnedMessage</span><span class="params">(Message message, <span class="type">int</span> i, String s, String s1, String s2)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消息没有送达到Queue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="6-2-消息重复消费"><a href="#6-2-消息重复消费" class="headerlink" title="6.2 消息重复消费"></a>6.2 消息重复消费</h3><ul>
<li><p>重复消费信息，会对非幂等次操作造成问题</p>
</li>
<li><p>重复消费消息的原因是，消费者没有给RabbitMQ一个ack	<br><img src="https://img-blog.csdnimg.cn/20210614142324461.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk5OTE4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p>为了解决消息重复消费的问题，可以采用Redis，在消费者消费消息之前，现将信息的id放到Redis中，</p>
</li>
<li><p>id-0（正在执行业务）</p>
</li>
<li><p>id-1（执行业务成功）</p>
</li>
<li><p>如果ack失败，在RabbitMQ将消息交给其他的消费者时，先执行setnx，如果key已经存在，获取他的值，如果是0，当前消费者就什么都不做，如果是1，直接ack。</p>
</li>
<li><p>极端情况：第一个消费者在执行业务时，出现了死锁，在setnx的基础上，再给key设置一个生存时间。</p>
</li>
<li><p>1、生产者，发送消息时，指定messageId</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AMQP.BasicProperties properties=<span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties().builder()</span><br><span class="line">        .deliveryMode(<span class="number">1</span>) <span class="comment">//指定信息是否需要持久化 1-需要持久化  2- 不需要持久化</span></span><br><span class="line">        .messageId(UUID.randomUUID().toString())</span><br><span class="line">        .build();</span><br><span class="line"><span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;Hello-World&quot;</span> ;</span><br><span class="line">channel.basicPublish(<span class="string">&quot;&quot;</span>,<span class="string">&quot;HelloWorld&quot;</span>,<span class="literal">true</span>,properties,msg.getBytes());</span><br></pre></td></tr></table></figure>

<ul>
<li>2、消费者，在消费信息时，根据具体业务逻辑去操作redis</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">DefaultConsumer consumer=<span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel)&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.31.240&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">messageId</span> <span class="operator">=</span> properties.getMessageId();</span><br><span class="line">        <span class="comment">//1、setnx到Redis中，默认指定value-0</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">nx</span> <span class="operator">=</span> jedis.set(messageId, <span class="string">&quot;0&quot;</span>, <span class="string">&quot;NX&quot;</span>, <span class="string">&quot;EX&quot;</span>,<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">if</span> (nx!=<span class="literal">null</span>&amp;&amp;nx.equalsIgnoreCase(<span class="string">&quot;OK&quot;</span>))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;接收到消息：&quot;</span>+<span class="keyword">new</span> <span class="title class_">String</span>(body,<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            <span class="comment">//2、消费成功，set messageId 1</span></span><br><span class="line">            jedis.set(messageId,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">            channel.basicAck(envelope.getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//3、如果1中的setnx失败，获取key对应的value，如果是0，return，如果是1</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> jedis.get(messageId);</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;1&quot;</span>.equalsIgnoreCase(s))&#123;</span><br><span class="line">                channel.basicAck(envelope.getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="6-2-2-SpringBoot如果实现"><a href="#6-2-2-SpringBoot如果实现" class="headerlink" title="6.2.2 SpringBoot如果实现"></a>6.2.2 SpringBoot如果实现</h4><p>1、导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--导入Redis--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--rabbitmq--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>2、编写配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.31</span><span class="number">.240</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">test</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">test</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/test</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">acknowledge-mode:</span> <span class="string">manual</span></span><br><span class="line">    <span class="attr">publisher-confirm-type:</span> <span class="string">simple</span></span><br><span class="line">    <span class="attr">publisher-returns:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.31</span><span class="number">.240</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>3、修改生产者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">CorrelationData</span> <span class="variable">messageId</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(UUID.randomUUID().toString());</span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;boot-topic-exchange&quot;</span>,<span class="string">&quot;solw.red.dog&quot;</span>,<span class="string">&quot;红色的大狼狗！！！&quot;</span>,messageId);</span><br><span class="line">    System.in.read();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、修改消费者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;boot-queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMessage</span><span class="params">(String msg, Channel channel, Message message)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//0、获取messageId</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">messageId</span> <span class="operator">=</span> message.getMessageProperties().getHeader(<span class="string">&quot;spring_returned_message_correlation&quot;</span>);</span><br><span class="line">        <span class="comment">//1、设置key到Redis</span></span><br><span class="line">        <span class="keyword">if</span> (redisTemplate.opsForValue().setIfAbsent(messageId,<span class="string">&quot;0&quot;</span>,<span class="number">10</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2、消费信息</span></span><br><span class="line">            System.out.println(<span class="string">&quot;接收到消息：&quot;</span>+msg);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3、设置key的value为1</span></span><br><span class="line">            redisTemplate.opsForValue().set(messageId,<span class="string">&quot;1&quot;</span>,<span class="number">10</span>,TimeUnit.SECONDS);</span><br><span class="line">            <span class="comment">//4、手动ack</span></span><br><span class="line">            channel.basicAck(message.getMessageProperties().getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//5、获取Redis中的value即可，如果1，手动ack</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;1&quot;</span>.equalsIgnoreCase(redisTemplate.opsForValue().get(messageId))) &#123;</span><br><span class="line">                channel.basicAck(message.getMessageProperties().getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="七、-RabbitMQ应用（需要学习最后一集）"><a href="#七、-RabbitMQ应用（需要学习最后一集）" class="headerlink" title="七、 RabbitMQ应用（需要学习最后一集）"></a>七、 RabbitMQ应用（需要学习最后一集）</h2><ul>
<li>客户模块</li>
<li>1、导入依赖</li>
<li>2、编写配置文件</li>
<li>3、编写配置类</li>
<li>4、修改Service</li>
<li></li>
</ul>
<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="二、Redis安装"><a href="#二、Redis安装" class="headerlink" title="二、Redis安装"></a>二、Redis安装</h2><h3 id="2-1-安装Redis"><a href="#2-1-安装Redis" class="headerlink" title="2.1 安装Redis"></a>2.1 安装Redis</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">6379</span><span class="string">:6379</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-安装Redis"><a href="#2-2-安装Redis" class="headerlink" title="2.2 安装Redis"></a>2.2 安装Redis</h3><p>进去Redis容器的内部<br>docker exec -it 容器id bash<br>在容器内部，使用redis-cli连接<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210614162938872.png" alt="在这里插入图片描述"></p>
<h3 id="2-3-使用图形化界面连接Redis"><a href="#2-3-使用图形化界面连接Redis" class="headerlink" title="2.3 使用图形化界面连接Redis"></a>2.3 使用图形化界面连接Redis</h3><p>下载地址：<a target="_blank" rel="noopener" href="https://gihub.com/lework/RedisDesktopManager-Windows/releases/download/2019.5/redis-desktop-manager-2019.5.zip">https://gihub.com/lework/RedisDesktopManager-Windows/releases/download/2019.5/redis-desktop-manager-2019.5.zip</a></p>
<h2 id="三、Redis常用命令"><a href="#三、Redis常用命令" class="headerlink" title="三、Redis常用命令"></a>三、Redis常用命令</h2><h3 id="3-1-Redis存储数据的结构"><a href="#3-1-Redis存储数据的结构" class="headerlink" title="3.1 Redis存储数据的结构"></a>3.1 Redis存储数据的结构</h3><p>常用的5种</p>
<ul>
<li>key-string：一个key对应一个值</li>
<li>key-hash：一个key对应一个Map</li>
<li>key-list：一个key 对应一个列表</li>
<li>key-set：一个key对应一个集合</li>
<li>key-zset：一个key对应一个有序集合。<br>另外三种数据结构：</li>
<li>HyperLogLog：计算近似值</li>
<li>GEO：地理位置</li>
<li>BIT ：一般存储的也是一个字符串，存储的是一个byte[]</li>
</ul>
<p><code>五种常用的存储数据结构图</code><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210614174656735.png" alt="在这里插入图片描述"></p>
<ul>
<li>key-string：最常用的，一般用于存储一个值</li>
<li>key-hash：存储一个对象数据的。</li>
<li>key-list：使用list结构实现栈和队列结构。</li>
<li>key-set：交集，差集和并集的操作。</li>
<li>key-zset：排行榜，积分存储等操作。</li>
</ul>
<h3 id="3-2-Redis常用命令"><a href="#3-2-Redis常用命令" class="headerlink" title="3.2 Redis常用命令"></a>3.2 Redis常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. 添加值</span></span><br><span class="line">set key value</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. 取值</span></span><br><span class="line">get key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. 批量操作</span></span><br><span class="line">mset key value [key value...]</span><br><span class="line">mset key [key...]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4.自增命令（自增1）</span></span><br><span class="line">incr key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5.自减命令（自增1）</span></span><br><span class="line">decr key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">6. 自增或自减指定数量</span></span><br><span class="line">incrby key increment</span><br><span class="line">decrby key increment</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">7.设置值的同时，指定生存时间（每次向Redis中添加数据时，尽量都设置上生存时间）</span></span><br><span class="line">setex key second value</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">8.设置值，如果当前key不存在的话（如果这个key存在，什么事都不做，如果这个key不存在，和<span class="built_in">set</span>命令一样）</span></span><br><span class="line">setnx key value</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">9.在key对应的value后，追加内容</span></span><br><span class="line">append key value</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">10.查看value字符串的长度</span></span><br><span class="line">strlen key</span><br></pre></td></tr></table></figure>
<h3 id="3-3-hash常用命令"><a href="#3-3-hash常用命令" class="headerlink" title="3.3 hash常用命令"></a>3.3 hash常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1.存储数据</span></span><br><span class="line">hset key field value</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2.获取数据</span></span><br><span class="line">hget key field</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3.批量操作</span></span><br><span class="line">hmset key field value [field value...]</span><br><span class="line">hmget key field [field...]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4. 自增(指定自增的值)</span></span><br><span class="line">hincrby key field increment</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5. 设置值（如果key-field 不存在，那么就正常添加，如果存在，什么事多不做）</span></span><br><span class="line">hsetnx key field value</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">6.检查field是否存在</span></span><br><span class="line">hexisis key field</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">7. 删除key 对应的某一个field，可以删除多个</span></span><br><span class="line">hdel key field [field...]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">8. 获取当前<span class="built_in">hash</span>结构中的全部field和value</span></span><br><span class="line">hgetall key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">9. 获取当前<span class="built_in">hash</span>结构中的全部field</span></span><br><span class="line">hkeys key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">10. 获取当前<span class="built_in">hash</span>结构中的全部value</span></span><br><span class="line">havls key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">11.获取当前<span class="built_in">hash</span>结构中field的数量</span></span><br><span class="line">hlen key</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-4-list常用命令"><a href="#3-4-list常用命令" class="headerlink" title="3.4 list常用命令"></a>3.4 list常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1.存储数据（从左侧插入数据）</span></span><br><span class="line">lpush key value [value...]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">存储数据（从右侧插入数据）</span></span><br><span class="line">rpush key value [value...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2.存储数据（如果key不存在，什么事多不做，如果key存在，但是不是list结构，什么都不做）</span></span><br><span class="line">lpushx key value</span><br><span class="line">rpushx key value</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3.修改数据（在存储数据时，指定好你的索引位置，覆盖之前索引位置的数据，index超出整个列表的长度，也会失败）</span></span><br><span class="line">lset key index value</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4.弹栈方式获取数据（左侧弹出数据，从右侧弹出数据）</span></span><br><span class="line">lpop  key</span><br><span class="line">rpop key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5.获取指定索引范围的数据（start从0开始，stop 输入-1 ，代表最后一个，-2代表倒数第二个）</span></span><br><span class="line">lrange key start stop</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">6. 获取指定索引位置的数据</span></span><br><span class="line">lindex key index</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">7.获取整个列表的长度</span></span><br><span class="line">llen key</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">8.删除列表中的数据（他是删除当前列表中的count个value值，count &gt; 0从左侧向右侧删除，count &lt; 0从右侧向左侧删除，count=0 删除列表中全部的value）</span></span><br><span class="line">lrem key count value</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">9.保留列表中的数据（保留你指定索引范围的数据，超过整个索引范围的被移除掉）</span></span><br><span class="line">ltrim key start stop</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">10.将一个列表中最后的一个数据，插入到另一个列表的头部位置</span></span><br><span class="line">rpoplpush list1 list2</span><br></pre></td></tr></table></figure>
<h3 id="3-5-set常用命令"><a href="#3-5-set常用命令" class="headerlink" title="3.5 set常用命令"></a>3.5 set常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1.存储数据</span></span><br><span class="line">sadd key member [member...]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 1. 获取数据（获取全部数据）</span><br><span class="line">smembers key </span><br><span class="line"></span><br><span class="line">#3. 随机获取一个数据（获取的同时，移除数据，count默认为1，代表弹出数据的数量）</span><br><span class="line">spop key	[count]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4. 交集（取多个<span class="built_in">set</span>集合交集）</span></span><br><span class="line">sinter set1 set2 ....</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5.并集（获取全部集合 中的数据 ）</span></span><br><span class="line">sunion set1 set2 ...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">6.差集（获多个集合中不一样的数据）</span></span><br><span class="line">sdiff set1 set2 ...</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">7.删除数据</span></span><br><span class="line">srem key member [member...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">8.查看当前的<span class="built_in">set</span>集合中是否包含这个值</span></span><br><span class="line">sismember key member</span><br></pre></td></tr></table></figure>
<h3 id="3-6-zset的常用命令"><a href="#3-6-zset的常用命令" class="headerlink" title="3.6 zset的常用命令"></a>3.6 zset的常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. 添加数据(score必须是一个数值，member不允许重复的)</span></span><br><span class="line">zadd key score member [score member...]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. 修改member的分数(如果member是存在于key中的，正常增加分数，如果member不存在，这个命令就相当于zadd)</span></span><br><span class="line">zincrby key increment member</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3.查看指定的member的分数</span></span><br><span class="line">zscore key member</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4. 获取zset中数据的数量</span></span><br><span class="line">zcard key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5.根据score的范围查看member数量</span></span><br><span class="line">zcount key min max</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">6.删除zset中的成员</span></span><br><span class="line">zrem key member [member...]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">7. 根据分数从小到大排序，获取指定范围内数据（withscore如果添加这个参数，那么会返回member对应的分数）</span></span><br><span class="line">zrange key start stoop [withscore]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">8.根据分数从大到小排序，获取指定范围内数据（withscore如果添加这个参数，那么会返回member对应的分数）</span></span><br><span class="line">zrevrange key start stoop [withscore]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">9.根据分数的范围去获取数据(withscore代表同时返回score，添加<span class="built_in">limit</span>，就和MySQL中一样，如果不希望等于min或者max的值被查询出来可以采用“(分数” 相当于 &lt; 但是不等于的方式，最大值和最小值使用+inf和-inf来标识)</span></span><br><span class="line">zrangebyscore key min max [withscore] [limit offset count]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">10.根据分数的返回去获取member（withscore代表同时返回score，添加<span class="built_in">limit</span>，就和MySQL中一样）</span></span><br><span class="line">zrevrangebyscore key max  min [withscore] [limit offset count]</span><br></pre></td></tr></table></figure>

<h3 id="3-7-key常用命令"><a href="#3-7-key常用命令" class="headerlink" title="3.7 key常用命令"></a>3.7 key常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1.查看Redis中的全部的key (pattern: * , xxx* , *xxx)</span></span><br><span class="line">keys pattern</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2.查看某一个key是否存在（1 —— 可以存在，0 —— 可以不存在）</span></span><br><span class="line">exists key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3.删除key</span></span><br><span class="line">del key [key...]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4.设置key的存在时间，单位为秒，单位为毫秒，设置还能活多久</span></span><br><span class="line">expire key second</span><br><span class="line">pexpire key milliseconds</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5.设置key的生存时间，单位为秒，单位为毫秒，设置能活到什么时间点</span></span><br><span class="line">expireat key timestamp</span><br><span class="line">pexpireat key milliseonds</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">6.查看key 的剩余生存时间，单位为秒，单位为毫秒（-2 —— 当前key不存在，-1 —— 当前key没有设置生存时间，具体剩余的生存时间）</span></span><br><span class="line">ttl key</span><br><span class="line">pttl key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">7.移除key的生存时间（1——移除成功，0——key不存在生存时间，key不存在）</span></span><br><span class="line">persist key</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">8.选择操作的库</span></span><br><span class="line">select 0~15</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">9.移动key到另外一个库中</span></span><br><span class="line">move key db</span><br></pre></td></tr></table></figure>
<h3 id="3-8库的常用命令"><a href="#3-8库的常用命令" class="headerlink" title="3.8库的常用命令"></a>3.8库的常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1.清空当前所在的数据库</span></span><br><span class="line">flushdb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2.清空全部数据库</span></span><br><span class="line">flushall</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3.查看当前数据库中有多少个key</span></span><br><span class="line">dbsize</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看最后一次操作的时间</span></span><br><span class="line">lastsave</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5. 实时监控Redis 服务接收到的目录</span></span><br><span class="line">monitor</span><br></pre></td></tr></table></figure>
<h2 id="四、Java连接Redis"><a href="#四、Java连接Redis" class="headerlink" title="四、Java连接Redis"></a>四、Java连接Redis</h2><ul>
<li>Jedis连接Redis，Lettuce连接Redis</li>
</ul>
<h3 id="4-1-Jedis连接Redis"><a href="#4-1-Jedis连接Redis" class="headerlink" title="4.1 Jedis连接Redis"></a>4.1 Jedis连接Redis</h3><ul>
<li>1.创建Maven项目</li>
<li>2.导入需要的依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1、Jedis--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--2、Junit--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--3、Lombok--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>3.测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1、连接Redis</span></span><br><span class="line">    Jedis jedis=<span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.0.127&quot;</span>,<span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、操作Redis——因为Redis的命令是什么，Jedis的方法就是什么</span></span><br><span class="line">    jedis.set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;李四&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3、释放资源</span></span><br><span class="line">    jedis.close();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">get</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1、连接Redis</span></span><br><span class="line">    Jedis jedis=<span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.0.127&quot;</span>,<span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、操作Redis——因为Redis的命令是什么，Jedis的方法就是什么</span></span><br><span class="line">    System.out.println(jedis.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3、释放资源</span></span><br><span class="line">    jedis.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-Jedis如何以数组存储一个对象到Redis"><a href="#4-2-Jedis如何以数组存储一个对象到Redis" class="headerlink" title="4.2 Jedis如何以数组存储一个对象到Redis"></a>4.2 Jedis如何以数组存储一个对象到Redis</h3><p>1、准备一个User实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、导入spring-context依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--<span class="number">4</span>、导入Spring-context--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">4.3</span><span class="number">.18</span>.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>3、创建Demo测试类，编写内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//存储对象——对byte[]形式存储在Redis中</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setByteArray</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1、连接Redis服务</span></span><br><span class="line">    <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.0.127&quot;</span>,<span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.1、准备key（String）-value（User）</span></span><br><span class="line">    String key=<span class="string">&quot;user&quot;</span>;</span><br><span class="line">    <span class="type">User</span> <span class="variable">value</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>, <span class="string">&quot;张三&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="comment">//2.2、将key和value转换为byte[]</span></span><br><span class="line">    <span class="type">byte</span>[] serialize = SerializationUtils.serialize(key);</span><br><span class="line">    <span class="type">byte</span>[] serialize1 = SerializationUtils.serialize(value);</span><br><span class="line">    <span class="comment">//2.3、将key和value存储到Redis</span></span><br><span class="line">    jedis.set(serialize,serialize1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3、释放资源</span></span><br><span class="line">    jedis.close();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取对象——对byte[]形式存储在Redis中</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getByteArray</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1、连接Redis服务</span></span><br><span class="line">    <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.0.127&quot;</span>,<span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.1、准备key（String）-value（User）</span></span><br><span class="line">    String key=<span class="string">&quot;user&quot;</span>;</span><br><span class="line">    <span class="type">User</span> <span class="variable">value</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>, <span class="string">&quot;张三&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="comment">//2.2、将key和value转换为byte[]</span></span><br><span class="line">    <span class="type">byte</span>[] serialize = SerializationUtils.serialize(key);</span><br><span class="line">    <span class="type">byte</span>[] serialize1 = SerializationUtils.serialize(value);</span><br><span class="line">    <span class="comment">//2.3、将key和value存储到Redis</span></span><br><span class="line">    <span class="type">byte</span>[] bytes = jedis.get(serialize);</span><br><span class="line">    <span class="comment">//2.4 反序列化</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">deserialize</span> <span class="operator">=</span> SerializationUtils.deserialize(bytes);</span><br><span class="line">    System.out.println(deserialize);</span><br><span class="line">    <span class="comment">//3、释放资源</span></span><br><span class="line">    jedis.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、String转换byte需要用到spring-context的jar包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--4 、导入Spring-Context--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-Jedis如何以String存储一个对象到Redis"><a href="#4-3-Jedis如何以String存储一个对象到Redis" class="headerlink" title="4.3 Jedis如何以String存储一个对象到Redis"></a>4.3 Jedis如何以String存储一个对象到Redis</h3><ul>
<li>导入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--JSON与String之间的转换--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dmeo3</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//以String-key存储</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setString</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1、连接Redis</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="comment">//2.1 准备Key（String）——value（User）</span></span><br><span class="line">        String key=<span class="string">&quot;stringkey&quot;</span>;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">2</span>, <span class="string">&quot;李四&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.2 使用fastJSON将value装化为json字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> JSON.toJSONString(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.3存储到Redis中</span></span><br><span class="line">        jedis.set(key,s);</span><br><span class="line">        <span class="comment">//3、释放资源</span></span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//读取</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getString</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1、连接Redis</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="comment">//2.1 准备Key（String）——value（User）</span></span><br><span class="line">        String key=<span class="string">&quot;stringkey&quot;</span>;</span><br><span class="line">        <span class="comment">//2.3取出到Redis中</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> jedis.get(key);</span><br><span class="line">        <span class="comment">//2.2 使用fastJSON将value装化为User对象</span></span><br><span class="line">        User user=JSON.parseObject(s1,User.class);</span><br><span class="line">        System.out.println(user.toString());</span><br><span class="line">        <span class="comment">//3、释放资源</span></span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-4-Jedis连接池的操作"><a href="#4-4-Jedis连接池的操作" class="headerlink" title="4.4 Jedis连接池的操作"></a>4.4 Jedis连接池的操作</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pool2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1、创建指定连接池的配置信息</span></span><br><span class="line">    <span class="type">GenericObjectPoolConfig</span> <span class="variable">poolConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericObjectPoolConfig</span>();</span><br><span class="line">    poolConfig.setMaxTotal(<span class="number">100</span>);   <span class="comment">//连接池中最大的活跃数</span></span><br><span class="line">    poolConfig.setMaxIdle(<span class="number">10</span>);    <span class="comment">//最大空闲数</span></span><br><span class="line">    poolConfig.setMinIdle(<span class="number">5</span>);    <span class="comment">//最小空闲数</span></span><br><span class="line">    poolConfig.setMaxWaitMillis(<span class="number">3000</span>);  <span class="comment">//当连接池空了之后，多久没获取到Jedis对象，就超时</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、创建连接池</span></span><br><span class="line">    JedisPool pool=<span class="keyword">new</span> <span class="title class_">JedisPool</span>(poolConfig,<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3、通过连接池获取jedis对象</span></span><br><span class="line">    <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> pool.getResource();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4、操作</span></span><br><span class="line">    System.out.println(jedis.get(<span class="string">&quot;stringkey&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5、释放资源</span></span><br><span class="line">    jedis.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-5-Redis的管道操作"><a href="#4-5-Redis的管道操作" class="headerlink" title="4.5 Redis的管道操作"></a>4.5 Redis的管道操作</h3><ul>
<li>因为在操作Redis的时候，执行一个命令需要先发送请求到Redis服务器，这个过程需要经历网络的延迟，Redis还需要给客户端一个响应。</li>
<li>如果我需要一次性执行很多命令，上述的方式效率很低，可以通过Redis的管道，先将命令放到客户端的一个Pipeline中，之后一次性的将全部命令都发送到Redis服务，Redis服务一次性的将全部的放回结果响应给客户端。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">    //Redis管道操作</span><br><span class="line">    @Test</span><br><span class="line">    public void pipeline()&#123;</span><br><span class="line">        //1、创建连接池</span><br><span class="line">        JedisPool pool = new JedisPool(&quot;127.0.0.1&quot;, 6379);</span><br><span class="line">        long x = System.currentTimeMillis();</span><br><span class="line">        System.out.println(x);</span><br><span class="line">/*        //2、获取一个连接对象</span><br><span class="line">        Jedis jedis = pool.getResource();</span><br><span class="line"></span><br><span class="line">        //3、执行incr - 100000次</span><br><span class="line">        for (int i = 0; i &lt; 100000; i++) &#123;</span><br><span class="line">            jedis.incr(&quot;pp&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //4、释放资源</span><br><span class="line">        jedis.close();*/</span><br><span class="line"></span><br><span class="line">        //=================</span><br><span class="line">        //2、获取一个连接对象</span><br><span class="line">        Jedis jedis1 = pool.getResource();</span><br><span class="line">        //3、创建管道</span><br><span class="line">        Pipeline pipeline=jedis1.pipelined();</span><br><span class="line"></span><br><span class="line">        //4、执行incr - 100000次放到管道中</span><br><span class="line">        for (int i = 0; i &lt; 100000; i++) &#123;</span><br><span class="line">            pipeline.incr(&quot;qq&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        //5、执行命令</span><br><span class="line">        pipeline.syncAndReturnAll();</span><br><span class="line"></span><br><span class="line">        //6、释放资源</span><br><span class="line">        jedis1.close();</span><br><span class="line"></span><br><span class="line">        long x1 = System.currentTimeMillis();</span><br><span class="line">        System.out.println(x1-x);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="五、Redis其他配置及集群"><a href="#五、Redis其他配置及集群" class="headerlink" title="五、Redis其他配置及集群"></a>五、Redis其他配置及集群</h2><ul>
<li>修改yml文件，以方便后期修改Redis配置信息<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">6379</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/redis.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command::</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br></pre></td></tr></table></figure>
注：command：加载文件</li>
</ul>
<h3 id="5-1-Redis的AUTH"><a href="#5-1-Redis的AUTH" class="headerlink" title="5.1 Redis的AUTH"></a>5.1 Redis的AUTH</h3><ul>
<li>方式一：通过修改Redis的配置文件，实现Redis的密码校验</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis.conf</span></span><br><span class="line"><span class="string">requirepass</span> <span class="string">密码</span></span><br></pre></td></tr></table></figure>
<ul>
<li>三种客户端的连接方式<ul>
<li><ol>
<li>redis-cli：在输入正常命令之前，先输入auth指定密码即可</li>
</ol>
</li>
<li><ol start="2">
<li>图形化界面：在连接Redis的信息中添加上验证的密码。</li>
</ol>
</li>
<li><ol start="3">
<li>Jedis客户端：</li>
</ol>
<ul>
<li>第一种：jedis.auth(password);</li>
<li>第二种：public JedisPool(GenericObjectPoolConfig poolConfig, String host, int port, int timeout, String password) { }</li>
</ul>
</li>
</ul>
</li>
<li>方式二：在不修改redis.conf文件的前提下，在第一次链接Redis时，输入命令：config set requirepass 密码  ，后续向再次操作Redis时，需要先AUTH一下验证（单Redis重启后失效）</li>
</ul>
<h3 id="Redis的事务"><a href="#Redis的事务" class="headerlink" title="Redis的事务"></a>Redis的事务</h3><p>注：Redis允许同时开启RDB和AOF</p>
<ul>
<li>Redis的事务：一次事务操作，该成功的成功，该失败的失败。</li>
<li>先开启事务，执行一些列的命令，但是密码不会立即执行，会被放在一个队列中，如果你执行事务，那么这个队列的命令全部执行，如果取消了事务，一个队列中的命令全部作废。<ul>
<li>1、开启事务：multi</li>
<li>2、输入要执行的命令：被放入到一个队列中</li>
<li>3、执行事务：exec</li>
<li>4、取消实物：discard<br>  Redis的事务想发挥功能，需要配置watch监听机制<br>  在开启事务之前，先通过watch命令去监听一个或多个key，在开启事务之后，如果其他客户端修改了我监听的key，事务会自动取消。<br>  如果执行了事务，或者取消了事务，watch监听自动消除，一般不需要手动执行unwatch</li>
</ul>
</li>
</ul>
<h3 id="5-3-Redis持久化"><a href="#5-3-Redis持久化" class="headerlink" title="5.3 Redis持久化"></a>5.3 Redis持久化</h3><ul>
<li><p>RDB是Redis默认的持久化机制</p>
<ul>
<li>1、RDB持久化文件，速度比较快，而且存储的是一个二进制的文件，传输起来很方便。</li>
<li>2、RDB持久化的时机：<ul>
<li>save 900 1：在900秒内，有1个key改变，就执行RDB持久化。</li>
<li>save 300 10：在300秒内，有10个key改变，就执行RDB持久化。</li>
<li>save 60 10000：在60秒内，有10000个key改变，就执行RDB持久化。</li>
</ul>
</li>
<li>3、RDB无法保证数据的绝对安全。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Redis的AUTH密码</span><br><span class="line"># requirepass xxxx</span><br><span class="line"># 900秒之内，有一个key改变了，就执行RDB持久化</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"># 开启RBD持久化的压缩</span><br><span class="line">rdbcompression yes</span><br><span class="line"># RDB持久化文件的名称</span><br><span class="line">dbfilename dump.rdb</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>AOF持久化策略（默认是关闭的，Redis推荐同时开启RDB和AOF持久化，更安全，避免数据丢失）</p>
<ul>
<li>1、AOF持久化的速度，相对RDB比较慢，存储的是一个文本文件，到了后期文件会比较大，传输困难</li>
<li>2、AOF持久化时机：<ul>
<li>appendfsync always：每执行一次操作，立即执行到AOF文件中，性能比较低</li>
<li>appendfsync everysec：每秒执行一次持久化</li>
<li>appendfsync no：会根据你的系统不同，环境的不同，在一定时间内执行一次持久化。</li>
<li>3、AOF相对RDB更安全，推荐同事开启AOF和RDB。</li>
</ul>
</li>
</ul>
</li>
<li><p>关于同时开启RDB和AOF的注意事项： </p>
<ul>
<li>如果同时开启了AOF和RDB持久化，南无在Redis宕机重启之后，需要加载一个持久化文件，优先选择AOF文件</li>
<li>如果先开启了RDB，再开启AOF，如果RDB执行了持久化，那么RDB文件中的内容会被AOF覆盖掉。<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># AOF持久化策略</span></span><br><span class="line"><span class="comment"># yes代表开启AOF持久化</span></span><br><span class="line"><span class="string">appendonly</span> <span class="literal">yes</span></span><br><span class="line"><span class="comment"># AOF文件的名称</span></span><br><span class="line"><span class="string">appendfilename</span> <span class="string">&quot;appendonly.aof&quot;</span></span><br><span class="line"><span class="comment"># AOF持久化执行的时机</span></span><br><span class="line"><span class="comment"># appendfsync always</span></span><br><span class="line"><span class="string">appendfsync</span> <span class="string">everysec</span></span><br><span class="line"><span class="comment"># appendfsync no</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="5-4-Redis的主从架构"><a href="#5-4-Redis的主从架构" class="headerlink" title="5.4 Redis的主从架构"></a>5.4 Redis的主从架构</h3><ul>
<li>单机版Redis存在读写瓶颈的问题<br><img src="https://img-blog.csdnimg.cn/20210617231902162.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk5OTE4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis1</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7001</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/redis1.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis2</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7002</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/redis2.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis1:master</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis3</span></span><br><span class="line">    <span class="attr">environment:</span> </span><br><span class="line">       <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7003</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/redis3.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis1:master</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加从节点的配置(redis2和redis3的配置)</span></span><br><span class="line"><span class="string">replicaof</span> <span class="string">master</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure>
<h3 id="5-5-哨兵"><a href="#5-5-哨兵" class="headerlink" title="5.5 哨兵"></a>5.5 哨兵</h3><ul>
<li>哨兵可以帮助我们解决主从架构中的单点故障问题<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/2021061810381849.png" alt="在这里插入图片描述"></li>
<li>修改一下docker-compose.yml，为了可以在容器内部使用哨兵的配置</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis1</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7001</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/redis1.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/sentinel1.conf:/usr/local/redis/redis.conf</span>  <span class="comment"># 添加的内容</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis2</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7002</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/redis2.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/sentinel2.conf:/usr/local/redis/redis.conf</span>  <span class="comment"># 添加的内容</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis1:master</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis3</span></span><br><span class="line">    <span class="attr">environment:</span> </span><br><span class="line">       <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7003</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/redis3.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/sentinel3.conf:/usr/local/redis/redis.conf</span> <span class="comment"># 添加的内容</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis1:master</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>准备哨兵的配置文件，并且在容器内部手动启动哨兵即可。<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 哨兵需要后台启动</span></span><br><span class="line"><span class="string">daemonize</span> <span class="literal">yes</span></span><br><span class="line"><span class="comment"># 指定Master节点的ip和端口号（主）</span></span><br><span class="line"><span class="string">sentinel</span> <span class="string">monitor</span> <span class="string">master</span> <span class="string">localhost</span> <span class="number">6379 </span><span class="number">2</span></span><br><span class="line"><span class="comment"># 指定Master节点的ip和端口号（从）</span></span><br><span class="line"><span class="string">sentinel</span> <span class="string">monitor</span> <span class="string">master</span> <span class="string">master</span> <span class="number">6379 </span><span class="number">2</span></span><br><span class="line"><span class="comment"># 哨兵每隔多久监听一次redis架构</span></span><br><span class="line"><span class="string">sentinel</span> <span class="string">down-after-milliseconds</span> <span class="string">master</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure></li>
<li>在Redis容器内部启动sentinel即可</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-sentinel sentinel.conf</span><br></pre></td></tr></table></figure>
<p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210618113334987.png" alt="在这里插入图片描述"></p>
<h3 id="5-6-Redis的集群"><a href="#5-6-Redis的集群" class="headerlink" title="5.6 Redis的集群"></a>5.6 Redis的集群</h3><ul>
<li>Redis集群在保证主从加哨兵的基本功能之外，还能够提升Redis存储数据的能力。<br><code>Redis集群架构图</code><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/2021061812332668.png" alt="在这里插入图片描述"></li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis1:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis1</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7001</span><span class="string">:7001</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">17001</span><span class="string">:17001</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/redis1.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis2:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis2</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7002</span><span class="string">:7002</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">17002</span><span class="string">:17002</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/redis2.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis3:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis3</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7003</span><span class="string">:7003</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">17003</span><span class="string">:17003</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/redis3.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis4:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis4</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7004</span><span class="string">:7004</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">17004</span><span class="string">:17004</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/redis4.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis5:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis5</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7005</span><span class="string">:7005</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">17005</span><span class="string">:17005</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/redis5.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis6:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis6</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7006</span><span class="string">:7006</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">17006</span><span class="string">:17006</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf/redis6.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis.conf</span></span><br><span class="line"><span class="comment"># 指定Redis的端口号</span></span><br><span class="line"><span class="string">port</span> <span class="number">6379</span></span><br><span class="line"><span class="comment"># 开启Redis集群</span></span><br><span class="line"><span class="string">cluster-enabled</span> <span class="literal">yes</span></span><br><span class="line"><span class="comment"># 集群信息的文件</span></span><br><span class="line"><span class="string">cluster-config-file</span> <span class="string">nodes-7001.conf</span></span><br><span class="line"><span class="comment"># 集群的对外ip地址</span></span><br><span class="line"><span class="string">cluster-announce-ip</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.140</span></span><br><span class="line"><span class="comment"># 集群的对外端口号</span></span><br><span class="line"><span class="string">cluster-announce-port</span> <span class="number">7001</span></span><br><span class="line"><span class="comment"># 集群的总线端口</span></span><br><span class="line"><span class="string">cluster-announce-bus-port</span> <span class="number">17001</span></span><br></pre></td></tr></table></figure>
<ul>
<li>启动了6个Redis的节点</li>
<li>随便跳转到一个容器内部，使用redis-cli管理集群</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动</span></span><br><span class="line">redis-cli --cluster create 192.168.0.140:7001 192.168.0.140:7002 192.168.0.140:700</span><br><span class="line">3 192.168.0.140:7004 192.168.0.140:7005 192.168.0.140:7006 --cluster-replicas 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">随便跳转到一个容器内部，使用redis-cli管理集群，进入那个节点</span></span><br><span class="line">redis-cli -h 192.168.0.140 -p 7001</span><br></pre></td></tr></table></figure>
<h3 id="5-7-Java链接Redis集群"><a href="#5-7-Java链接Redis集群" class="headerlink" title="5.7 Java链接Redis集群"></a>5.7 Java链接Redis集群</h3><ul>
<li>使用JedisCluster对象连接Redis集群</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//创建Set&lt;HostAndPort&gt;</span></span><br><span class="line">    Set&lt;HostAndPort&gt; hostAndPorts = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">        hostAndPorts.add(<span class="keyword">new</span> <span class="title class_">HostAndPort</span>(<span class="string">&quot;192.168.0.140&quot;</span>,<span class="number">7001</span>+i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建JedisCluster对象</span></span><br><span class="line">    <span class="type">JedisCluster</span> <span class="variable">cluster</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisCluster</span>(hostAndPorts);</span><br><span class="line">    <span class="comment">//操作</span></span><br><span class="line">    System.out.println(cluster.get(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="六、Redis常见问题"><a href="#六、Redis常见问题" class="headerlink" title="六、Redis常见问题"></a>六、Redis常见问题</h2><h3 id="6-1-key的生存时间到了，Redis会立即删除吗？"><a href="#6-1-key的生存时间到了，Redis会立即删除吗？" class="headerlink" title="6.1 key的生存时间到了，Redis会立即删除吗？"></a>6.1 key的生存时间到了，Redis会立即删除吗？</h3><ul>
<li>不会立即删除<ul>
<li>1、定期删除：<ul>
<li>Redis每隔一段时间就去查看Redis设置了过期时间的key，会再100ms的间隔中默认查看3个key。</li>
</ul>
</li>
<li>2、惰性删除：<ul>
<li>如果当你去查询一个已经过期的key时，Redis会先查看当前key的生存时间，是否已经到了，直接删除当前key，并且给用户返回空值。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="6-2-Redis的淘汰机制"><a href="#6-2-Redis的淘汰机制" class="headerlink" title="6.2 Redis的淘汰机制"></a>6.2 Redis的淘汰机制</h3><ul>
<li>在Redis内存已经满的时候，添加了一个新的数据，执行淘汰机制。<ul>
<li><ol>
<li>volatile-lru：</li>
</ol>
<ul>
<li>在内存不足时，Redis会再设置过了生存时间的key中干掉一个最近最少使用的key。</li>
</ul>
</li>
<li><ol start="2">
<li>allkeys-lru：</li>
</ol>
<ul>
<li>在内存不足时，Redis会再全部的key中干掉一个最近最少使用的key。</li>
</ul>
</li>
<li><ol start="3">
<li>volatile-lfu：</li>
</ol>
<ul>
<li>在内存不足时，Redis会再设置过了生存时间的key中干掉一个最近最少频次使用的key。</li>
</ul>
</li>
<li><ol start="4">
<li>allkeys-lfu：</li>
</ol>
<ul>
<li>在内存不足时，Redis会再全部的key中干掉一个最近最少频次使用的key。</li>
</ul>
</li>
<li><ol start="5">
<li>volatile-random：</li>
</ol>
<ul>
<li>在内存不足时，Redis会再设置过了生存时间的key中随机干掉一个。</li>
</ul>
</li>
<li><ol start="6">
<li>allkeys-random：</li>
</ol>
<ul>
<li>在内存不足时，Redis会再全部的key中随机干掉一个。</li>
</ul>
</li>
<li><ol start="7">
<li>volatile-ttl：</li>
</ol>
<ul>
<li>在内存不足时，Redis会再设置过了生存时间的key中干掉一个剩余时间最短的一个。</li>
</ul>
</li>
<li><ol start="8">
<li>noeviction：</li>
</ol>
<ul>
<li>在内存不足时，直接报错。<br>  指定淘汰机制的方式：maxmemory-policy具体策略</li>
</ul>
</li>
</ul>
</li>
<li>设置Redis的最大内存：maxmemory <bytes></li>
</ul>
<h3 id="6-3-缓存的常见问题"><a href="#6-3-缓存的常见问题" class="headerlink" title="6.3 缓存的常见问题"></a>6.3 缓存的常见问题</h3><ul>
<li>缓存穿透<br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/202106181338092.png" alt="在这里插入图片描述"></li>
<li>缓存击穿<br><img src="https://img-blog.csdnimg.cn/20210618134115539.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk5OTE4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li>缓存雪崩<br><img src="https://img-blog.csdnimg.cn/20210618134300668.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk5OTE4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li>缓存倾斜<br><img src="https://img-blog.csdnimg.cn/20210618134519776.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk5OTE4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<h1 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h1><p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210709124341726.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210710120633690.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk5OTE4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="一、Zookeeper介绍"><a href="#一、Zookeeper介绍" class="headerlink" title="一、Zookeeper介绍"></a>一、Zookeeper介绍</h2><h3 id="1-1-引言-1"><a href="#1-1-引言-1" class="headerlink" title="1.1 引言"></a>1.1 引言</h3><p>1、注册中心<br>2、配置集群管理<br>3、集群管理<br>4、分布式锁，分布式任务<br>5、队列的管理	</p>
<h3 id="1-2-Zookeeper介绍"><a href="#1-2-Zookeeper介绍" class="headerlink" title="1.2 Zookeeper介绍"></a>1.2 Zookeeper介绍</h3><ul>
<li>Zookeeper本身是Hadoop生态园的中一个组件，Zookeeper强大的功能，在Java分布式架构中，也会频繁的使用到Zookeeper。<br><img src="https://img-blog.csdnimg.cn/2021070912491578.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk5OTE4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li>Zookeeper就是一个文件系统+监听通知机制</li>
</ul>
<h2 id="二、Zookeeper安装"><a href="#二、Zookeeper安装" class="headerlink" title="二、Zookeeper安装"></a>二、Zookeeper安装</h2><p>1、Docker-compose.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.1&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">zk:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/daocloud/zookeeper:latest</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zk</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2181</span><span class="string">:2181</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h2 id="三、Zookeeper架构"><a href="#三、Zookeeper架构" class="headerlink" title="三、Zookeeper架构"></a>三、Zookeeper架构</h2><h3 id="3-1-Zookeeper的架构图"><a href="#3-1-Zookeeper的架构图" class="headerlink" title="3.1 Zookeeper的架构图"></a>3.1 Zookeeper的架构图</h3><ul>
<li>每一个加点都被称为znode</li>
<li>每一个znode中都可以存储数据</li>
<li>节点名称是不允许重复的<br><img src="https://img-blog.csdnimg.cn/20210709130841712.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk5OTE4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<h3 id="3-2-znode类型"><a href="#3-2-znode类型" class="headerlink" title="3.2 znode类型"></a>3.2 znode类型</h3><p>四种Znode：<br>1、持久节点<br>    永久的保存在你的Zookeeper<br>2、持久有序节点<br>    永久的保存在你的Zookeeper，他会给节点添加一个有序的序号。	&#x2F;xx -&gt; &#x2F;xx0000001<br>3、临时节点<br>    当存储的客户端和Zookeeper服务断开连接时，这个临时节点自动删除<br>4、临时有序节点<br>    当存储的客户端和Zookeeper服务断开连接时，这个临时节点自动删除，他会给节点一个有序的序号		&#x2F;xx -&gt; &#x2F;xx0000001</p>
<h3 id="3-3-Zookeeper的监听通知机制"><a href="#3-3-Zookeeper的监听通知机制" class="headerlink" title="3.3 Zookeeper的监听通知机制"></a>3.3 Zookeeper的监听通知机制</h3><ul>
<li>客户端可以去监听Zookeeper中的znode节点</li>
<li>Znode改变时，会通知监听当前Znode的客服端<br><img src="https://img-blog.csdnimg.cn/2021070913205519.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk5OTE4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<h2 id="四、Zookeeper常用命令"><a href="#四、Zookeeper常用命令" class="headerlink" title="四、Zookeeper常用命令"></a>四、Zookeeper常用命令</h2><ul>
<li>1、查询：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询当前节点下的全部子节点</span></span><br><span class="line">ls 节点名称</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">例子 <span class="built_in">ls</span> /</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询当前节点下的数据</span></span><br><span class="line">get 节点名称</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">例子 get /</span></span><br></pre></td></tr></table></figure>
<p>2、创建节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create [-s] [-e] znode 名称 znode数据</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-s ：sequence，有序节点</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-e ：ephemeral，临时节点</span></span><br><span class="line">```shell</span><br><span class="line">3、修改节点数据</span><br><span class="line">```shell</span><br><span class="line">set znode名称 新数据</span><br></pre></td></tr></table></figure>
<p>3、删除节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delete znode名称    		# 没有子节点的znode</span><br><span class="line">deleteall znode名称 		# 删除当前节点和全部的子节点，有些版本可能是rmr删除</span><br></pre></td></tr></table></figure>
<h2 id="五、Zookeeper集群"><a href="#五、Zookeeper集群" class="headerlink" title="五、Zookeeper集群"></a>五、Zookeeper集群</h2><h3 id="5-1-Zookeeper集群架构图"><a href="#5-1-Zookeeper集群架构图" class="headerlink" title="5.1 Zookeeper集群架构图"></a>5.1 Zookeeper集群架构图</h3><p><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210710125910381.png" alt="在这里插入图片描述"></p>
<h3 id="5-2-Zookeeper集群中节点的角色"><a href="#5-2-Zookeeper集群中节点的角色" class="headerlink" title="5.2 Zookeeper集群中节点的角色"></a>5.2 Zookeeper集群中节点的角色</h3><p>1、Leader<br>Master主节点<br>2、Follower（默认的从节点）<br>从节点，参与选举全新的Leader<br>3、Observer<br>从节点，不参与报票<br>4、Looking<br>正在找Leader节点</p>
<h3 id="5-3-Zookeeper投票策略"><a href="#5-3-Zookeeper投票策略" class="headerlink" title="5.3 Zookeeper投票策略"></a>5.3 Zookeeper投票策略</h3><p>1、每一个Zookeeper服务都会被分配一个全局唯一的myid，myid是一个数字。<br>2、Zookeeper在执行数据时，每一个节点都有一个自己的FIFO的队列。保证写每一个数据的时候，顺序是不会乱的，Zookeeper还会给每一个数据分配一个全局唯一额zxid，数据越新zxid就越大。</p>
<p>选举Leader：<br>    1、选举出zxid最大的节点作为Leader<br>    2、在zxid相同的节点中，选举出一个myid最大的节点，作为Leader。</p>
<h3 id="5-4-搭建Zookeeper集群"><a href="#5-4-搭建Zookeeper集群" class="headerlink" title="5.4 搭建Zookeeper集群"></a>5.4 搭建Zookeeper集群</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.1&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">zk1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zk1</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2181</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zk1:2888:3888;2181</span> <span class="string">server.2=zk2:2888:3888;2181</span> <span class="string">server.3=zk3:2888:3888;2181</span></span><br><span class="line">  <span class="attr">zk2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zk2</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2182</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">2</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zk1:2888:3888;2181</span> <span class="string">server.2=zk2:2888:3888;2181</span> <span class="string">server.3=zk3:2888:3888;2181</span></span><br><span class="line">  <span class="attr">zk3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zk3</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2183</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zk1:2888:3888;2181</span> <span class="string">server.2=zk2:2888:3888;2181</span> <span class="string">server.3=zk3:2888:3888;2181</span></span><br></pre></td></tr></table></figure>

<h2 id="六、Java操作Zookeeper"><a href="#六、Java操作Zookeeper" class="headerlink" title="六、Java操作Zookeeper"></a>六、Java操作Zookeeper</h2><h3 id="6-1-Java连接Zookeeper"><a href="#6-1-Java连接Zookeeper" class="headerlink" title="6.1 Java连接Zookeeper"></a>6.1 Java连接Zookeeper</h3><p>1、创建Maven工程<br>2、导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3、编写连接Zookeeper集群的工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.curator.RetryPolicy;</span><br><span class="line"><span class="keyword">import</span> org.apache.curator.framework.CuratorFramework;</span><br><span class="line"><span class="keyword">import</span> org.apache.curator.framework.CuratorFrameworkFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.curator.retry.ExponentialBackoffRetry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZKUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CuratorFramework <span class="title function_">cf</span><span class="params">()</span>&#123;</span><br><span class="line">        RetryPolicy retrypolicy=<span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">3000</span>,<span class="number">2</span>);</span><br><span class="line">        CuratorFramework cf= CuratorFrameworkFactory.builder()</span><br><span class="line">                .connectString(<span class="string">&quot;192.168.31.240:2181,192.168.31.240:2182,192.168.31.240:2183&quot;</span>)</span><br><span class="line">                .retryPolicy(retrypolicy)</span><br><span class="line">                .build();</span><br><span class="line">        cf.start();</span><br><span class="line">        <span class="keyword">return</span> cf;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4、测试（不报错就可以了）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CuratorFramework</span> <span class="variable">cf</span> <span class="operator">=</span> ZKUtil.cf();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-Java操作Znode节点"><a href="#6-2-Java操作Znode节点" class="headerlink" title="6.2 Java操作Znode节点"></a>6.2 Java操作Znode节点</h3><p>1、查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CuratorFramework</span> <span class="variable">cf</span> <span class="operator">=</span> ZKUtil.cf();</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectZnode</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    List&lt;String&gt; strings = cf.getChildren().forPath(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (String string : strings) &#123;</span><br><span class="line">        System.out.println(string);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getData</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">byte</span>[] bytes = cf.getData().forPath(<span class="string">&quot;/qf&quot;</span>);</span><br><span class="line">    System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes,<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">create</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    cf.create().withMode(CreateMode.PERSISTENT).forPath(<span class="string">&quot;/qf2&quot;</span>,<span class="string">&quot;uuuu&quot;</span>.getBytes());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    cf.setData().forPath(<span class="string">&quot;/qf2&quot;</span>,<span class="string">&quot;oooo&quot;</span>.getBytes());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    cf.delete().deletingChildrenIfNeeded().forPath(<span class="string">&quot;/qf2&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、查看znode的状态</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">status</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Stat</span> <span class="variable">stat</span> <span class="operator">=</span> cf.checkExists().forPath(<span class="string">&quot;/qf&quot;</span>);</span><br><span class="line">    System.out.println(stat);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-监听Znode节点"><a href="#6-3-监听Znode节点" class="headerlink" title="6.3 监听Znode节点"></a>6.3 监听Znode节点</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CuratorFramework</span> <span class="variable">cf</span> <span class="operator">=</span> ZKUtil.cf();</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listen</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//1、创建NodeCache对象，指定要监听的znode</span></span><br><span class="line">    <span class="keyword">final</span> NodeCache nodeCache=<span class="keyword">new</span> <span class="title class_">NodeCache</span>(cf,<span class="string">&quot;/qf&quot;</span>);</span><br><span class="line">    nodeCache.start();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、添加一个监听器</span></span><br><span class="line">    nodeCache.getListenable().addListener(<span class="keyword">new</span> <span class="title class_">NodeCacheListener</span>() &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">nodeChanged</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            <span class="type">byte</span>[] data = nodeCache.getCurrentData().getData();</span><br><span class="line">            <span class="type">Stat</span> <span class="variable">stat</span> <span class="operator">=</span> nodeCache.getCurrentData().getStat();</span><br><span class="line">            <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> nodeCache.getCurrentData().getPath();</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;监听的节点是：&quot;</span>+path);</span><br><span class="line">            System.out.println(<span class="string">&quot;节点现在的数据是：&quot;</span>+<span class="keyword">new</span> <span class="title class_">String</span>(data,<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;节点状态是：&quot;</span>+stat);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(<span class="string">&quot;开始启动&quot;</span>);</span><br><span class="line">    <span class="comment">//3、System.in.read();</span></span><br><span class="line">    System.in.read();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="分布式处理方案"><a href="#分布式处理方案" class="headerlink" title="分布式处理方案"></a>分布式处理方案</h1><p> <img src="https://img-blog.csdnimg.cn/20210712123730468.png" alt="在这里插入图片描述"><br><img src="http://blog-bucketend.oss-cn-beijing.aliyuncs.com/img/blog/20210711152816726.png" alt="在这里插入图片描述"></p>
<h2 id="一、分布式锁介绍"><a href="#一、分布式锁介绍" class="headerlink" title="一、分布式锁介绍"></a>一、分布式锁介绍</h2><ul>
<li>由于传统的锁是基于Tomcat服务器内部的，搭建了集群之后，导致锁失效</li>
<li>使用分布式锁来处理<br><img src="https://img-blog.csdnimg.cn/20210712124413956.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk5OTE4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<h2 id="二、分布式锁解决方案"><a href="#二、分布式锁解决方案" class="headerlink" title="二、分布式锁解决方案"></a>二、分布式锁解决方案</h2><h3 id="2-1-搭建环境"><a href="#2-1-搭建环境" class="headerlink" title="2.1 搭建环境"></a>2.1 搭建环境</h3><p>1、创建SpringBoot工程<br>2、编写抢购业务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecondKillController</span> &#123;</span><br><span class="line">    <span class="comment">//1、准备商品的库存</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,Integer&gt; itemStock=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、准备商品的订单</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,Integer&gt; itemOrder=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        itemStock.put(<span class="string">&quot;牙刷&quot;</span>,<span class="number">10000</span>);</span><br><span class="line">        itemOrder.put(<span class="string">&quot;牙刷&quot;</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/kill&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">kill</span><span class="params">(String item)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//1、减库存</span></span><br><span class="line">        Integer stock=itemStock.get(item);</span><br><span class="line">        <span class="keyword">if</span> (stock&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;商品库存不足！！！&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        itemStock.put(<span class="string">&quot;牙刷&quot;</span>,stock-<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//2、创建订单</span></span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        itemOrder.put(item,itemOrder.get(item)+<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、返回信息</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;抢购成功！！！&quot;</span>+item+<span class="string">&quot;：剩余库存数为 - &quot;</span>+itemStock.get(item)+<span class="string">&quot;，订单数为：&quot;</span>+itemOrder.get(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、下载ab压力测试<br>下载地址：<a target="_blank" rel="noopener" href="https://www.apachehaus.com/cgi-bin/download.plx?dli=QZsZEaTtWQ41ERBJjSI5UWZNlVUNlVSZ0SsZERhdFO">https://www.apachehaus.com/cgi-bin/download.plx?dli=QZsZEaTtWQ41ERBJjSI5UWZNlVUNlVSZ0SsZERhdFO</a><br>使用方式：<br>    cmd打开到bin目录，命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab -n </span><br></pre></td></tr></table></figure>

<p>4、测试</p>
<h2 id="三、分布式任务介绍"><a href="#三、分布式任务介绍" class="headerlink" title="三、分布式任务介绍"></a>三、分布式任务介绍</h2><h2 id="四、分布式任务解决方案"><a href="#四、分布式任务解决方案" class="headerlink" title="四、分布式任务解决方案"></a>四、分布式任务解决方案</h2><h2 id="五、分布式事务介绍"><a href="#五、分布式事务介绍" class="headerlink" title="五、分布式事务介绍"></a>五、分布式事务介绍</h2><h2 id="六、分布式事务解决方案"><a href="#六、分布式事务解决方案" class="headerlink" title="六、分布式事务解决方案"></a>六、分布式事务解决方案</h2></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Docker</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/11/26/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/">http://example.com/2023/11/26/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/Java%E6%A1%86%E6%9E%B6/">Java框架</a><a class="post-meta__tags" href="/tags/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/">Java微服务</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2023/11/26/HttpURLConnection%E5%92%8COKHTTP%E7%9A%84%E4%BD%BF%E7%94%A8/" title="HttpURLConnection和OKHTTP的使用"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">HttpURLConnection和OKHTTP的使用</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/11/26/Spring-Boot%E6%A1%86%E6%9E%B6/" title="Spring Boot框架"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-26</div><div class="title">Spring Boot框架</div></div></a></div><div><a href="/2023/11/26/Spring%E6%A1%86%E6%9E%B6/" title="Spring框架"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-26</div><div class="title">Spring框架</div></div></a></div><div><a href="/2023/11/26/Spring-MVC/" title="Spring MVC"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-26</div><div class="title">Spring MVC</div></div></a></div><div><a href="/2023/11/26/Android%E6%9D%83%E9%99%90%E4%BB%A3%E7%A0%81/" title="Android权限代码"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-26</div><div class="title">Android权限代码</div></div></a></div><div><a href="/2023/11/26/Android%E4%B9%8BContentProvite%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8/" title="Android之ContentProvite组件的使用"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-26</div><div class="title">Android之ContentProvite组件的使用</div></div></a></div><div><a href="/2023/11/26/Android%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/" title="Android消息机制"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-26</div><div class="title">Android消息机制</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Docker</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/liuwenzhensunniwell"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/liuwenzhensunniwell" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">架构演进：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83-%E7%94%9F%E6%88%90%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.</span> <span class="toc-text">一、开发环境&amp;生成环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.1.</span> <span class="toc-text">1. 开发环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%94%9F%E6%88%90%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.2.</span> <span class="toc-text">2. 生成环境</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81WEB1-0-WEB2-0%E9%98%B6%E6%AE%B5"><span class="toc-number">1.2.</span> <span class="toc-text">二、WEB1.0&amp;WEB2.0阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1web1-0%E6%97%B6%E6%9C%9F"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1web1.0时期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-WEB2-0%E6%97%B6%E6%9C%9F"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.WEB2.0时期</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%9E%82%E7%9B%B4%E6%9E%B6%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">三、垂直架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84"><span class="toc-number">1.4.</span> <span class="toc-text">四、分布式架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%E9%A1%B9%E7%9B%AE%E8%BF%AD%E4%BB%A3"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1项目迭代</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">1.5.</span> <span class="toc-text">五、分布式架构常见问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1%E6%9C%8D%E5%8A%A1%E4%B9%8B%E9%97%B4%E7%9A%84%E5%BC%82%E6%AD%A5%E9%80%9A%E8%AE%AF"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1服务之间的异步通讯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2%E6%9C%8D%E5%8A%A1%E4%B9%8B%E9%97%B4%E9%80%9A%E8%AE%AF%E5%9C%B0%E5%9D%80%E7%9A%84%E7%BB%B4%E6%8A%A4"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2服务之间通讯地址的维护</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3服务降级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE"><span class="toc-number">1.5.4.</span> <span class="toc-text">海量数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="toc-number">1.6.</span> <span class="toc-text">六、微服务架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2%E6%A8%A1%E5%9D%97%E8%BF%87%E5%A4%9A%EF%BC%8C%E8%BF%90%E7%BB%B4%E6%88%90%E6%9C%AC%E5%A2%9E%E5%8A%A0"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.2模块过多，运维成本增加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E4%B8%8B%E7%9A%84%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.3分布式架构下的其他问题</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Linux%E4%BB%8B%E7%BB%8D"><span class="toc-number"></span> <span class="toc-text">Linux介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Linux%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">一、Linux介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E5%BC%95%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">1.1引言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">1.2.</span> <span class="toc-text">Linux介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3Linux%E7%9A%84%E7%89%88%E6%9C%AC"><span class="toc-number">1.3.</span> <span class="toc-text">1.3Linux的版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4Linux%E5%92%8CWindows%E5%8C%BA%E5%88%AB"><span class="toc-number">1.4.</span> <span class="toc-text">1.4Linux和Windows区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Linux%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">二、Linux安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E5%AE%89%E8%A3%85VMware"><span class="toc-number">2.1.</span> <span class="toc-text">2.1安装VMware</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E5%AE%89%E8%A3%85Xterm"><span class="toc-number">2.2.</span> <span class="toc-text">2.2安装Xterm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3%E5%9C%A8Vmware%E5%AE%89%E8%A3%85Linux"><span class="toc-number">2.3.</span> <span class="toc-text">2.3在Vmware安装Linux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4%E4%BD%BF%E7%94%A8Xterm%E8%BF%9E%E6%8E%A5Linux"><span class="toc-number">2.4.</span> <span class="toc-text">2.4使用Xterm连接Linux</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Linux%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">3.</span> <span class="toc-text">三、Linux基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%E8%8E%B7%E5%8F%96Linux%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="toc-number">3.1.</span> <span class="toc-text">3.2获取Linux中的信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Linux%E5%91%BD%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">四、Linux命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%E7%9B%AE%E5%BD%95%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">4.1.</span> <span class="toc-text">4.1目录的命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E5%88%87%E6%8D%A2%E7%9B%AE%E5%BD%95"><span class="toc-number">4.2.</span> <span class="toc-text">4.2切换目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E6%96%87%E4%BB%B6%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">4.3.</span> <span class="toc-text">4.2文件的命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%E9%92%88%E5%AF%B9%E5%8E%8B%E7%BC%A9%E5%8C%85%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">4.4.</span> <span class="toc-text">4.3针对压缩包的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1%E9%92%88%E5%AF%B9tar%E5%91%BD%E4%BB%A4"><span class="toc-number">4.4.1.</span> <span class="toc-text">4.3.1针对tar命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-2%E9%92%88%E5%AF%B9zip%E5%8E%8B%E7%BC%A9%E5%8C%85"><span class="toc-number">4.4.2.</span> <span class="toc-text">4.3.2针对zip压缩包</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4%E7%94%A8%E6%88%B7-%E7%94%A8%E6%88%B7%E7%BB%84%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">4.5.</span> <span class="toc-text">4.4用户&amp;用户组的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-1-%E7%94%A8%E6%88%B7%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">4.5.1.</span> <span class="toc-text">4.4.1 用户的操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-2%E7%94%A8%E6%88%B7%E7%BB%84%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">4.6.</span> <span class="toc-text">4.4.2用户组的操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="toc-number">4.7.</span> <span class="toc-text">4.5文件权限的修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-1%E5%AF%B9%E6%96%87%E4%BB%B6%E7%9A%84%E6%9D%83%E9%99%90%E4%BF%AE%E6%94%B9"><span class="toc-number">4.8.</span> <span class="toc-text">4.5.1对文件的权限修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-2%E5%AF%B9%E6%96%87%E4%BB%B6%E7%9A%84%E6%8B%A5%E6%9C%89%E8%80%85%E5%92%8C%E6%89%80%E5%B1%9E%E7%BB%84%E4%BF%AE%E6%94%B9"><span class="toc-number">4.9.</span> <span class="toc-text">4.5.2对文件的拥有者和所属组修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6Linux%E7%9A%84%E5%85%B6%E4%BB%96%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">4.10.</span> <span class="toc-text">4.6Linux的其他操作命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-Linux%E4%B8%8B%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6"><span class="toc-number">5.</span> <span class="toc-text">五.Linux下安装软件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%E5%AE%89%E8%A3%85JDK"><span class="toc-number">5.1.</span> <span class="toc-text">5.1安装JDK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2%E5%AE%89%E8%A3%85MySQL"><span class="toc-number">5.2.</span> <span class="toc-text">5.2安装MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3%E5%AE%89%E8%A3%85Tomcat"><span class="toc-number">5.3.</span> <span class="toc-text">5.3安装Tomcat</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E9%83%A8%E7%BD%B2SSM%E5%B7%A5%E7%A8%8B"><span class="toc-number">6.</span> <span class="toc-text">六、部署SSM工程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker"><span class="toc-number"></span> <span class="toc-text">Docker</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Docker%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">一、Docker介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E5%BC%95%E8%A8%80-1"><span class="toc-number">1.1.</span> <span class="toc-text">1.1引言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2Docker%E7%9A%84%E7%94%B1%E6%9D%A5"><span class="toc-number">1.2.</span> <span class="toc-text">1.2Docker的由来</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4Docker%E7%9A%84%E6%80%9D%E6%83%B3"><span class="toc-number">1.3.</span> <span class="toc-text">1.4Docker的思想</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">2.</span> <span class="toc-text">二、Docker的基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2Docker%E7%9A%84%E4%B8%AD%E5%A4%AE%E4%BB%93%E5%BA%93"><span class="toc-number">2.1.</span> <span class="toc-text">2.2Docker的中央仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3%E9%95%9C%E5%83%8F%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.</span> <span class="toc-text">2.3镜像的操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%AE%B9%E5%99%A8%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">2.3.</span> <span class="toc-text">2.4 容器的操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Docker%E5%BA%94%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">三、Docker应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E5%87%86%E5%A4%87SSM%E5%B7%A5%E7%A8%8B"><span class="toc-number">3.1.</span> <span class="toc-text">3.1准备SSM工程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%E5%87%86%E5%A4%87MySQL%E5%AE%B9%E5%99%A8"><span class="toc-number">3.2.</span> <span class="toc-text">3.2准备MySQL容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3%E5%87%86%E5%A4%87Tomcat%E5%AE%B9%E5%99%A8"><span class="toc-number">3.3.</span> <span class="toc-text">3.3准备Tomcat容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 数据库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Dcker%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8F"><span class="toc-number">4.</span> <span class="toc-text">四、Dcker自定义镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81Dockers-Compose"><span class="toc-number">5.</span> <span class="toc-text">六、Dockers-Compose</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1%E4%B8%8B%E8%BD%BDDocker-Compose"><span class="toc-number">5.1.</span> <span class="toc-text">6.1下载Docker-Compose</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2Docker-compose%E7%AE%A1%E7%90%86MySQL%E5%92%8CTomcat%E5%AE%B9%E5%99%A8"><span class="toc-number">5.2.</span> <span class="toc-text">6.2Docker-compose管理MySQL和Tomcat容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3%E4%BD%BF%E7%94%A8docker-compose%E5%91%BD%E4%BB%A4%E7%AE%A1%E7%90%86%E5%AE%B9%E5%99%A8"><span class="toc-number">5.3.</span> <span class="toc-text">6.3使用docker-compose命令管理容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81Docker-DI%E3%80%81CD"><span class="toc-number">6.</span> <span class="toc-text">七、Docker DI、CD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2"><span class="toc-number">6.1.</span> <span class="toc-text">7.1项目部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2CI%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.2.</span> <span class="toc-text">7.2CI介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3%E5%AE%9E%E7%8E%B0%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90"><span class="toc-number">6.3.</span> <span class="toc-text">7.3实现持续集成</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-1%E6%90%AD%E5%BB%BAGitlab%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">6.3.1.</span> <span class="toc-text">7.3.1搭建Gitlab服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-2%E6%90%AD%E5%BB%BAGit-ab-Runner"><span class="toc-number">6.3.2.</span> <span class="toc-text">7.3.2搭建Git.ab-Runner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-3%E6%95%B4%E5%90%88%E9%A1%B9%E7%9B%AE%E5%85%A5%E9%97%A8%E6%B5%8B%E8%AF%95"><span class="toc-number">6.3.3.</span> <span class="toc-text">7.3.3整合项目入门测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%AE%89%E8%A3%85Jenkins"><span class="toc-number">7.</span> <span class="toc-text">八、安装Jenkins</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E5%AE%89%E8%A3%85Jenkins"><span class="toc-number">7.1.</span> <span class="toc-text">8.1 安装Jenkins</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-1-%E8%AE%BF%E9%97%AEhttp-ip-8888"><span class="toc-number">7.1.1.</span> <span class="toc-text">8.1.1 访问http:&#x2F;&#x2F;ip:8888</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97%EF%BC%8C%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%E7%99%BB%E9%99%86Jenkins%EF%BC%9A"><span class="toc-number">7.1.2.</span> <span class="toc-text">8.1.2 查看日志，输入密码登陆Jenkins：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-3-%E6%89%8B%E5%8A%A8%E6%8C%87%E5%AE%9A%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85%EF%BC%9A"><span class="toc-number">7.1.3.</span> <span class="toc-text">8.1.3 手动指定插件安装：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-4-%E7%AD%89%E5%BE%85%E5%AE%89%E8%A3%85%E5%AE%8C%E6%88%90%EF%BC%8C%E6%8C%87%E5%AE%9A%E4%B8%8B%E5%88%97%E6%8F%92%E4%BB%B6%E5%8D%B3%E5%8F%AF%EF%BC%9A"><span class="toc-number">7.1.4.</span> <span class="toc-text">8.1.4 等待安装完成，指定下列插件即可：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-5-%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F%E5%90%8E%EF%BC%8C%E9%9C%80%E8%A6%81%E6%8C%87%E5%AE%9A%E4%B8%8A%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81"><span class="toc-number">7.1.5.</span> <span class="toc-text">8.1.5 安装成功后，需要指定上用户名和密码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E9%85%8D%E7%BD%AE%E7%9B%AE%E6%A0%87%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%8AGitLab%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95"><span class="toc-number">7.2.</span> <span class="toc-text">8.2 配置目标服务器及GitLab免密登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E9%85%8D%E7%BD%AEGitLab%E5%85%8D%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95%EF%BC%88%E5%90%8E%E6%9C%9F%E4%BD%BF%E7%94%A8%E5%90%8E%E8%A1%A5%E5%85%85%E7%AC%94%E8%AE%B0%EF%BC%89"><span class="toc-number">7.3.</span> <span class="toc-text">8.3 配置GitLab免密码登录（后期使用后补充笔记）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Nginx"><span class="toc-number"></span> <span class="toc-text">Nginx</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81-Nginx%E4%BB%8B%E7%BB%8D"><span class="toc-number">0.1.</span> <span class="toc-text">一、 Nginx介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-Nginx%E4%BB%8B%E7%BB%8D"><span class="toc-number">0.1.1.</span> <span class="toc-text">1.1 Nginx介绍</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81Nginx%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">0.2.</span> <span class="toc-text">一、Nginx的安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E5%AE%89%E8%A3%85Nginx"><span class="toc-number">0.2.1.</span> <span class="toc-text">2.1安装Nginx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2Nginx%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">0.2.2.</span> <span class="toc-text">2.2Nginx的配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%E4%BF%AE%E6%94%B9docker-compose%E6%96%87%E4%BB%B6"><span class="toc-number">0.2.3.</span> <span class="toc-text">2.3修改docker-compose文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81Nginx%E7%9A%84%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">0.3.</span> <span class="toc-text">一、Nginx的反向代理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">0.3.1.</span> <span class="toc-text">1.1正向代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">0.3.2.</span> <span class="toc-text">1.2反向代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%E5%9F%BA%E4%BA%8ENginx%E5%AE%9E%E7%8E%B0%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">0.3.3.</span> <span class="toc-text">1.3基于Nginx实现反向代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4%E5%85%B3%E4%BA%8ENginx%E7%9A%84location%E8%B7%AF%E5%BE%84%E6%98%A0%E5%B0%84"><span class="toc-number">0.3.4.</span> <span class="toc-text">1.4关于Nginx的location路径映射</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">0.4.</span> <span class="toc-text">二、Nginx负载均衡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%BD%AE%E8%AF%A2"><span class="toc-number">0.4.1.</span> <span class="toc-text">2.1 轮询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E6%9D%83%E9%87%8D"><span class="toc-number">0.4.2.</span> <span class="toc-text">2.2 权重</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-ip-hash"><span class="toc-number">0.4.3.</span> <span class="toc-text">2.3 ip_hash</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81Nginx%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB"><span class="toc-number">0.5.</span> <span class="toc-text">三、Nginx动静分离</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%E5%8A%A8%E6%80%81%E8%B5%84%E6%BA%90%E4%BB%A3%E7%90%86"><span class="toc-number">0.5.1.</span> <span class="toc-text">3.1动态资源代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%E5%8A%A8%E6%80%81%E8%B5%84%E6%BA%90%E4%BB%A3%E7%90%86"><span class="toc-number">0.5.2.</span> <span class="toc-text">3.2动态资源代理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Nginx%E9%9B%86%E7%BE%A4"><span class="toc-number">0.6.</span> <span class="toc-text">四、Nginx集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E5%BC%95%E8%A8%80"><span class="toc-number">0.6.1.</span> <span class="toc-text">4.1 引言</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E6%90%AD%E5%BB%BANginx%E9%9B%86%E7%BE%A4"><span class="toc-number">0.6.2.</span> <span class="toc-text">4.2 搭建Nginx集群</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ES"><span class="toc-number"></span> <span class="toc-text">ES</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-ES%E5%BC%95%E8%A8%80"><span class="toc-number">0.1.</span> <span class="toc-text">1.2 ES引言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-ES%E7%9A%84%E7%94%B1%E6%9D%A5"><span class="toc-number">0.2.</span> <span class="toc-text">1.3 ES的由来</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-ES%E5%92%8CSlor"><span class="toc-number">0.3.</span> <span class="toc-text">1.4 ES和Slor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-number">0.4.</span> <span class="toc-text">1.5 倒排索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81ElasticSearch%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">二、ElasticSearch安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%AE%89%E8%A3%85ES-Kibana"><span class="toc-number">1.1.</span> <span class="toc-text">2.1 安装ES&amp;Kibana</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%AE%89%E8%A3%85IK%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">1.2.</span> <span class="toc-text">2.2. 安装IK分词器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81ElasticSearch%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">2.</span> <span class="toc-text">三、ElasticSearch基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-ES%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.</span> <span class="toc-text">3.1 ES的结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E7%B4%A2%E5%BC%95-Index%EF%BC%8C%E5%88%86%E7%89%87%E5%92%8C%E5%A4%87%E4%BB%BD"><span class="toc-number">2.1.1.</span> <span class="toc-text">3.1.1 索引 Index，分片和备份</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-%E7%B1%BB%E5%9E%8B-Type"><span class="toc-number">2.1.2.</span> <span class="toc-text">3.1.2 类型 Type</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-%E6%96%87%E6%A1%A3-Doc"><span class="toc-number">2.1.3.</span> <span class="toc-text">3.1.3 文档 Doc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-4-%E5%B1%9E%E6%80%A7-FieId"><span class="toc-number">2.1.4.</span> <span class="toc-text">3.1.4 属性 FieId</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%93%8D%E4%BD%9CES%E7%9A%84RESTful%E8%AF%AD%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">3.2 操作ES的RESTful语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3%E7%B4%A2%E5%BC%95%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">2.3.</span> <span class="toc-text">3.3索引的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%B4%A2%E5%BC%95"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.3.1 创建一个索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95%E4%BF%A1%E6%81%AF"><span class="toc-number">2.3.2.</span> <span class="toc-text">3.3.2 查看索引信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">2.3.3.</span> <span class="toc-text">3.3.3 删除索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-ES%E4%B8%ADfield%E5%8F%AF%E4%BB%A5%E6%8C%87%E5%AE%9A%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.4.</span> <span class="toc-text">3.4 ES中field可以指定的类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E5%B9%B6%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">2.5.</span> <span class="toc-text">3.5 创建索引并指定数据结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-%E6%96%87%E6%A1%A3%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">2.6.</span> <span class="toc-text">3.6 文档的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-1-%E6%96%B0%E5%BB%BA%E6%96%87%E6%A1%A3"><span class="toc-number">2.6.1.</span> <span class="toc-text">3.6.1 新建文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-2-%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3"><span class="toc-number">2.6.2.</span> <span class="toc-text">3.6.2 修改文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-3-%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">2.6.3.</span> <span class="toc-text">3.6.3 删除文档</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Java%E6%93%8D%E4%BD%9CElasticSearch"><span class="toc-number">3.</span> <span class="toc-text">四、Java操作ElasticSearch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-Java%E8%BF%9E%E6%8E%A5ES"><span class="toc-number">3.1.</span> <span class="toc-text">4.1 Java连接ES</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2Java%E6%93%8D%E4%BD%9C%E7%B4%A2%E5%BC%95"><span class="toc-number">3.2.</span> <span class="toc-text">4.2Java操作索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-Java%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">3.3.</span> <span class="toc-text">4.2.1 Java创建索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">3.4.</span> <span class="toc-text">4.2.2 创建索引是否存在，删除索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">3.5.</span> <span class="toc-text">4.2.3 删除索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-Java%E6%93%8D%E4%BD%9C%E6%96%87%E6%A1%A3"><span class="toc-number">3.6.</span> <span class="toc-text">4.3 Java操作文档</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1-%E6%B7%BB%E5%8A%A0%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C"><span class="toc-number">3.6.1.</span> <span class="toc-text">4.3.1 添加文档操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1-%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3"><span class="toc-number">3.6.2.</span> <span class="toc-text">4.3.1 修改文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1-%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">3.6.3.</span> <span class="toc-text">4.3.1 删除文档</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-Java%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C%E6%96%87%E6%A1%A3"><span class="toc-number">3.7.</span> <span class="toc-text">4.4 Java批量操作文档</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-1-%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0%E6%96%87%E6%A1%A3"><span class="toc-number">3.7.1.</span> <span class="toc-text">4.4.1 批量添加文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-2-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">3.7.2.</span> <span class="toc-text">4.4.2 批量删除文档</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81ElasticSearch%E7%BB%83%E4%B9%A0"><span class="toc-number">4.</span> <span class="toc-text">五、ElasticSearch练习</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81ElasticSearch%E7%9A%84%E5%90%84%E4%B8%AD%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.</span> <span class="toc-text">六、ElasticSearch的各中查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-term-terms%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.1.</span> <span class="toc-text">6.1 term&amp;terms查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-1-term%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.1.1.</span> <span class="toc-text">6.1.1 term查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-2-terms%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.1.2.</span> <span class="toc-text">6.1.2 terms查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-match%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.</span> <span class="toc-text">6.2 match查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-match-all%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.1.</span> <span class="toc-text">6.2.1 match_all查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-match%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.2.</span> <span class="toc-text">6.2.2 match查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-3-%E5%B8%83%E5%B0%94match%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.3.</span> <span class="toc-text">6.2.3 布尔match查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-4-multi-match%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.4.</span> <span class="toc-text">6.2.4 multi_match查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E5%85%B6%E4%BB%96%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.3.</span> <span class="toc-text">6.3 其他查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-1-id%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.3.1.</span> <span class="toc-text">6.3.1 id查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-2-ids%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.3.2.</span> <span class="toc-text">6.3.2 ids查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-3-prefix%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.3.3.</span> <span class="toc-text">6.3.3 prefix查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-4-fuzzy%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.3.4.</span> <span class="toc-text">6.3.4 fuzzy查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-5-wildcard%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.3.5.</span> <span class="toc-text">6.3.5 wildcard查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-6-range%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.3.6.</span> <span class="toc-text">6.3.6 range查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-7-regexp%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.3.7.</span> <span class="toc-text">6.3.7 regexp查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E6%B7%B1%E5%88%86%E9%A1%B5Scroll"><span class="toc-number">5.4.</span> <span class="toc-text">6.4 深分页Scroll</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot"><span class="toc-number"></span> <span class="toc-text">SpringBoot</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81SpringBoot%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">一、SpringBoot介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%BC%95%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 引言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-SpringBoot%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 SpringBoot介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81SpringBoot%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">2.</span> <span class="toc-text">二、SpringBoot快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BASpringBoot"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 快速构建SpringBoot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-SpringBoot%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 SpringBoot的目录结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-SpringBoot%E4%B8%89%E7%A7%8D%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 SpringBoot三种启动方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81SpringBoot%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">3.</span> <span class="toc-text">三、SpringBoot常用注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-Configuration%E5%92%8C-Bean"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 @Configuration和@Bean</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringBootApplication"><span class="toc-number">3.2.</span> <span class="toc-text">@SpringBootApplication</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81SpringBoot%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">4.</span> <span class="toc-text">四、SpringBoot常用配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-SpringBoot%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 SpringBoot的配置文件格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 多环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%BC%95%E5%85%A5%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BF%A1%E6%81%AF"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 引入外部配置文件信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E7%83%AD%E5%8A%A0%E8%BD%BD"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 热加载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81SpringBoot%E6%95%B4%E5%90%88Mybatis"><span class="toc-number">5.</span> <span class="toc-text">五、SpringBoot整合Mybatis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-xml%E6%96%B9%E5%BC%8F%E6%95%B4%E5%90%88MyBatis"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 xml方式整合MyBatis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F%E6%95%B4%E5%90%88MyBatis"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 注解方式整合MyBatis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-SpringBoot%E6%95%B4%E5%90%88%E5%88%86%E9%A1%B5%E5%8A%A9%E6%89%8B"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 SpringBoot整合分页助手</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81SpringBoot%E6%95%B4%E5%90%88JSP"><span class="toc-number">6.</span> <span class="toc-text">六、SpringBoot整合JSP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81SpringBoot"><span class="toc-number">7.</span> <span class="toc-text">七、SpringBoot</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RabbitMQ"><span class="toc-number"></span> <span class="toc-text">RabbitMQ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81RabbitMQ%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">一、RabbitMQ介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E5%BC%95%E8%A8%80-2"><span class="toc-number">1.1.</span> <span class="toc-text">1.1引言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2RabbitMQ%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">1.2RabbitMQ的介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-RabbitMQ%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">二、 RabbitMQ的安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81RabbitMQ%E7%9A%84%E6%9E%B6%E6%9E%84"><span class="toc-number">3.</span> <span class="toc-text">三、RabbitMQ的架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-RabbitMQ%E7%9A%84%E5%AE%8C%E6%95%B4%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="toc-number">3.1.</span> <span class="toc-text">3.1  RabbitMQ的完整架构图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%9F%A5%E7%9C%8B%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E5%B9%B6%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAVirtual-Host"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 查看图形化界面并创建一个Virtual Host</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81RabbitMQ%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">四、RabbitMQ的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-RabbitMQ%E7%9A%84%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 RabbitMQ的通信方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-Java%E8%BF%9E%E6%8E%A5RabbitMQ"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 Java连接RabbitMQ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-Hello-World"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 Hello World</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-Work"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 Work</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-Publish-Subscribe"><span class="toc-number">4.5.</span> <span class="toc-text">4.5 Publish&#x2F;Subscribe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-Routing"><span class="toc-number">4.6.</span> <span class="toc-text">4.6 Routing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-Topic"><span class="toc-number">4.7.</span> <span class="toc-text">4.7 Topic</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%95%B4%E5%90%88SpringBoot"><span class="toc-number">5.</span> <span class="toc-text">五、整合SpringBoot</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-SpringBoot%E6%95%B4%E5%90%88RabbitMQ"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 SpringBoot整合RabbitMQ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E6%89%8B%E5%8A%A8Ack"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 手动Ack</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81RabbitMQ%E7%9A%84%E5%85%B6%E4%BB%96%E6%93%8D%E4%BD%9C"><span class="toc-number">6.</span> <span class="toc-text">六、RabbitMQ的其他操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E6%B6%88%E6%81%AF%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 消息的可靠性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-1-Confirm%E6%9C%BA%E5%88%B6"><span class="toc-number">6.1.1.</span> <span class="toc-text">6.1.1 Confirm机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-2-Return%E6%9C%BA%E5%88%B6"><span class="toc-number">6.1.2.</span> <span class="toc-text">6.1.2 Return机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-3-SpringBoot%E5%AE%9E%E7%8E%B0Confirm%E4%BB%A5%E5%8F%8AReturn"><span class="toc-number">6.1.3.</span> <span class="toc-text">6.1.3 SpringBoot实现Confirm以及Return</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E6%B6%88%E6%81%AF%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 消息重复消费</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-SpringBoot%E5%A6%82%E6%9E%9C%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.2.1.</span> <span class="toc-text">6.2.2 SpringBoot如果实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81-RabbitMQ%E5%BA%94%E7%94%A8%EF%BC%88%E9%9C%80%E8%A6%81%E5%AD%A6%E4%B9%A0%E6%9C%80%E5%90%8E%E4%B8%80%E9%9B%86%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">七、 RabbitMQ应用（需要学习最后一集）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis"><span class="toc-number"></span> <span class="toc-text">Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Redis%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">二、Redis安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%AE%89%E8%A3%85Redis"><span class="toc-number">1.1.</span> <span class="toc-text">2.1 安装Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%AE%89%E8%A3%85Redis"><span class="toc-number">1.2.</span> <span class="toc-text">2.2 安装Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E8%BF%9E%E6%8E%A5Redis"><span class="toc-number">1.3.</span> <span class="toc-text">2.3 使用图形化界面连接Redis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Redis%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">三、Redis常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-Redis%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.</span> <span class="toc-text">3.1 Redis存储数据的结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-Redis%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.2.</span> <span class="toc-text">3.2 Redis常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-hash%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.</span> <span class="toc-text">3.3 hash常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-list%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.4.</span> <span class="toc-text">3.4 list常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-set%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.5.</span> <span class="toc-text">3.5 set常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-zset%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.6.</span> <span class="toc-text">3.6 zset的常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-key%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.7.</span> <span class="toc-text">3.7 key常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8%E5%BA%93%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.8.</span> <span class="toc-text">3.8库的常用命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Java%E8%BF%9E%E6%8E%A5Redis"><span class="toc-number">3.</span> <span class="toc-text">四、Java连接Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-Jedis%E8%BF%9E%E6%8E%A5Redis"><span class="toc-number">3.1.</span> <span class="toc-text">4.1 Jedis连接Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-Jedis%E5%A6%82%E4%BD%95%E4%BB%A5%E6%95%B0%E7%BB%84%E5%AD%98%E5%82%A8%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E5%88%B0Redis"><span class="toc-number">3.2.</span> <span class="toc-text">4.2 Jedis如何以数组存储一个对象到Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-Jedis%E5%A6%82%E4%BD%95%E4%BB%A5String%E5%AD%98%E5%82%A8%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E5%88%B0Redis"><span class="toc-number">3.3.</span> <span class="toc-text">4.3 Jedis如何以String存储一个对象到Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-Jedis%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">3.4.</span> <span class="toc-text">4.4 Jedis连接池的操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-Redis%E7%9A%84%E7%AE%A1%E9%81%93%E6%93%8D%E4%BD%9C"><span class="toc-number">3.5.</span> <span class="toc-text">4.5 Redis的管道操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Redis%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE%E5%8F%8A%E9%9B%86%E7%BE%A4"><span class="toc-number">4.</span> <span class="toc-text">五、Redis其他配置及集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-Redis%E7%9A%84AUTH"><span class="toc-number">4.1.</span> <span class="toc-text">5.1 Redis的AUTH</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E7%9A%84%E4%BA%8B%E5%8A%A1"><span class="toc-number">4.2.</span> <span class="toc-text">Redis的事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-Redis%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">4.3.</span> <span class="toc-text">5.3 Redis持久化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-Redis%E7%9A%84%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84"><span class="toc-number">4.4.</span> <span class="toc-text">5.4 Redis的主从架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E5%93%A8%E5%85%B5"><span class="toc-number">4.5.</span> <span class="toc-text">5.5 哨兵</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-Redis%E7%9A%84%E9%9B%86%E7%BE%A4"><span class="toc-number">4.6.</span> <span class="toc-text">5.6 Redis的集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-Java%E9%93%BE%E6%8E%A5Redis%E9%9B%86%E7%BE%A4"><span class="toc-number">4.7.</span> <span class="toc-text">5.7 Java链接Redis集群</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81Redis%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">六、Redis常见问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-key%E7%9A%84%E7%94%9F%E5%AD%98%E6%97%B6%E9%97%B4%E5%88%B0%E4%BA%86%EF%BC%8CRedis%E4%BC%9A%E7%AB%8B%E5%8D%B3%E5%88%A0%E9%99%A4%E5%90%97%EF%BC%9F"><span class="toc-number">5.1.</span> <span class="toc-text">6.1 key的生存时间到了，Redis会立即删除吗？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-Redis%E7%9A%84%E6%B7%98%E6%B1%B0%E6%9C%BA%E5%88%B6"><span class="toc-number">5.2.</span> <span class="toc-text">6.2 Redis的淘汰机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E7%BC%93%E5%AD%98%E7%9A%84%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">5.3.</span> <span class="toc-text">6.3 缓存的常见问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Zookeeper"><span class="toc-number"></span> <span class="toc-text">Zookeeper</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Zookeeper%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">一、Zookeeper介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%BC%95%E8%A8%80-1"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 引言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Zookeeper%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 Zookeeper介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Zookeeper%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">二、Zookeeper安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Zookeeper%E6%9E%B6%E6%9E%84"><span class="toc-number">3.</span> <span class="toc-text">三、Zookeeper架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-Zookeeper%E7%9A%84%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 Zookeeper的架构图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-znode%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 znode类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-Zookeeper%E7%9A%84%E7%9B%91%E5%90%AC%E9%80%9A%E7%9F%A5%E6%9C%BA%E5%88%B6"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 Zookeeper的监听通知机制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Zookeeper%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">四、Zookeeper常用命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Zookeeper%E9%9B%86%E7%BE%A4"><span class="toc-number">5.</span> <span class="toc-text">五、Zookeeper集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-Zookeeper%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 Zookeeper集群架构图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-Zookeeper%E9%9B%86%E7%BE%A4%E4%B8%AD%E8%8A%82%E7%82%B9%E7%9A%84%E8%A7%92%E8%89%B2"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 Zookeeper集群中节点的角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-Zookeeper%E6%8A%95%E7%A5%A8%E7%AD%96%E7%95%A5"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 Zookeeper投票策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E6%90%AD%E5%BB%BAZookeeper%E9%9B%86%E7%BE%A4"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 搭建Zookeeper集群</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81Java%E6%93%8D%E4%BD%9CZookeeper"><span class="toc-number">6.</span> <span class="toc-text">六、Java操作Zookeeper</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-Java%E8%BF%9E%E6%8E%A5Zookeeper"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 Java连接Zookeeper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-Java%E6%93%8D%E4%BD%9CZnode%E8%8A%82%E7%82%B9"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 Java操作Znode节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E7%9B%91%E5%90%ACZnode%E8%8A%82%E7%82%B9"><span class="toc-number">6.3.</span> <span class="toc-text">6.3 监听Znode节点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88"><span class="toc-number"></span> <span class="toc-text">分布式处理方案</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">一、分布式锁介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">2.</span> <span class="toc-text">二、分布式锁解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 搭建环境</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E4%BB%BB%E5%8A%A1%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.</span> <span class="toc-text">三、分布式任务介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E4%BB%BB%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">4.</span> <span class="toc-text">四、分布式任务解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.</span> <span class="toc-text">五、分布式事务介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">6.</span> <span class="toc-text">六、分布式事务解决方案</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/26/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/" title="Java微服务">Java微服务</a><time datetime="2023-11-26T12:23:18.000Z" title="发表于 2023-11-26 20:23:18">2023-11-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/26/HttpURLConnection%E5%92%8COKHTTP%E7%9A%84%E4%BD%BF%E7%94%A8/" title="HttpURLConnection和OKHTTP的使用">HttpURLConnection和OKHTTP的使用</a><time datetime="2023-11-26T12:20:00.000Z" title="发表于 2023-11-26 20:20:00">2023-11-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/26/Service%E7%BB%84%E4%BB%B6/" title="Service组件">Service组件</a><time datetime="2023-11-26T12:19:04.000Z" title="发表于 2023-11-26 20:19:04">2023-11-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/26/Android%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/" title="Android消息机制">Android消息机制</a><time datetime="2023-11-26T12:08:01.000Z" title="发表于 2023-11-26 20:08:01">2023-11-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/26/JavaScript/" title="JavaScript">JavaScript</a><time datetime="2023-11-26T11:50:33.000Z" title="发表于 2023-11-26 19:50:33">2023-11-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Docker</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>